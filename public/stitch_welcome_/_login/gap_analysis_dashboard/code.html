<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>EduAI - Gap Analysis</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
    :root {
      --primary-color: #3b82f6;--red-accent: #ef4444;--white-accent: #ffffff;--dark-bg: #030712;--dark-surface: #111827;--dark-border: #1f2937;--text-primary: #ffffff;
      --text-secondary: #9ca3af;
    }
    body {
      font-family: 'Space Grotesk', sans-serif;
      background-color: var(--dark-bg);
      color: var(--text-primary);
    }
    .glow-effect-blue {
      box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color), 0 0 30px var(--primary-color);
    }
    .glow-effect-red {
       box-shadow: 0 0 8px var(--red-accent), 0 0 15px var(--red-accent), 0 0 20px var(--red-accent);
    }
    .active-nav {
        color: var(--primary-color);
        position: relative;
    }
    .active-nav::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: -6px;
        width: 100%;
        height: 2px;
        background-color: var(--primary-color);
        box-shadow: 0 0 8px var(--primary-color);
    }
    @keyframes radar-scan {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .radar-scanner {
        animation: radar-scan 8s linear infinite;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.7; transform: scale(1.05); }
    }
    .radar-point {
        animation: pulse 2s infinite;
    }
    .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255,255,255,.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .generated-topic {
        background-color: rgba(34, 197, 94, 0.1);
        border-color: #22c55e;
    }
    .generated-topic .generate-btn {
        background-color: #22c55e;
        box-shadow: 0 0 15px rgba(34, 197, 94, 0.4);
    }
    .analyzing {
        animation: analyze-pulse 2s infinite;
    }
    @keyframes analyze-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; transform: scale(1.02); }
    }
  </style>
</head>
<body class="bg-[var(--dark-bg)] text-[var(--text-primary)]">
<div class="relative flex size-full min-h-screen flex-col overflow-x-hidden">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[var(--dark-border)] px-10 py-4 sticky top-0 bg-[var(--dark-bg)]/80 backdrop-blur-sm z-50">
<div class="flex items-center gap-4">
<svg class="text-[var(--primary-color)] h-8 w-8" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M4 42.4379C4 42.4379 14.0962 36.0744 24 41.1692C35.0664 46.8624 44 42.2078 44 42.2078L44 7.01134C44 7.01134 35.068 11.6577 24.0031 5.96913C14.0971 0.876274 4 7.27094 4 7.27094L4 42.4379Z" fill="currentColor"></path>
</svg>
<h1 class="text-xl font-bold tracking-[-0.015em] text-white">EduAI</h1>
</div>
<nav class="flex items-center gap-8 text-sm font-medium">
<a class="text-[var(--text-secondary)] hover:text-[var(--white-accent)] transition-colors cursor-pointer" onclick="navigateToDashboard()">Dashboard</a>
<a class="text-[var(--text-secondary)] hover:text-[var(--white-accent)] transition-colors cursor-pointer" onclick="navigateToContent()">Content</a>
<a class="active-nav text-white" href="#">Gap Analysis</a>
<a class="text-[var(--text-secondary)] hover:text-[var(--white-accent)] transition-colors cursor-pointer" onclick="navigateToPerformance()">Performance</a>
<a class="text-[var(--text-secondary)] hover:text-[var(--white-accent)] transition-colors cursor-pointer" onclick="navigateToSettings()">Settings</a>
</nav>
<div class="flex items-center gap-4">
<button class="relative">
<span class="material-symbols-outlined text-2xl text-[var(--text-secondary)] hover:text-[var(--white-accent)] transition-colors">notifications</span>
<span class="absolute top-0 right-0 flex h-2 w-2">
<span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[var(--red-accent)] opacity-75"></span>
<span class="relative inline-flex rounded-full h-2 w-2 bg-[var(--red-accent)]"></span>
</span>
</button>
<img alt="User avatar" class="size-10 rounded-full border-2 border-[var(--primary-color)]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuA-miPWZlrIrmhHB8SlvAijfFmMrmiXpvFo5rMLVnieMKKP9sNuQ_Bfukn2AX8b-FqY70PIaZmDpd9F8vJqBpVJgeIZM_iud0kaVzOTOiGSMCZ894R4WXCwXAET_tqjNi4xkuGyVFy2r18GsiS4yapWspPqkWsG6VORrSD30pNdM_iasTpTdosWdbTaUXL-D66Fzuv6dsfLD72zNby9SMfPcVUqU-r6RpF8p6IoS4xc5UPyh9kXX_blNOOtYruNd2Pklgx_fO6Z2HY"/>
</div>
</header>
<main class="flex-1 px-10 md:px-20 lg:px-40 py-12">
<div class="max-w-7xl mx-auto">
<div class="mb-12">
<h2 class="text-4xl font-bold mb-2 text-white">Gap Analysis Dashboard</h2>
<p class="text-[var(--text-secondary)] text-lg">Identify and address discrepancies between current content and ideal learning outcomes.</p>
<p id="content-summary" class="text-[var(--primary-color)] text-sm mt-2 font-medium">Analyzing your uploaded content...</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
<!-- Content Coverage Radar -->
<div class="lg:col-span-1 bg-[var(--dark-surface)] p-6 rounded-2xl border border-[var(--dark-border)]">
<h3 class="text-xl font-bold mb-6 text-center text-white">Content Coverage</h3>
<div class="relative w-64 h-64 mx-auto">
<div class="absolute inset-0">
<div class="w-full h-full border-[1.5px] border-[var(--dark-border)] rounded-full opacity-50"></div>
<div class="absolute inset-[25%] w-1/2 h-1/2 border-[1.5px] border-[var(--dark-border)] rounded-full opacity-50"></div>
<div class="absolute top-1/2 left-0 w-full h-[1.5px] bg-[var(--dark-border)] opacity-50 -translate-y-1/2"></div>
<div class="absolute top-0 left-1/2 w-[1.5px] h-full bg-[var(--dark-border)] opacity-50 -translate-x-1/2"></div>
</div>
<div class="absolute inset-0 radar-scanner">
<div class="w-full h-full bg-gradient-to-t from-transparent to-[var(--primary-color)]/30" style="clip-path: polygon(50% 0%, 100% 100%, 0% 100%); transform: rotate(120deg)"></div>
</div>
<div class="absolute inset-0">
<svg class="w-full h-full" fill="none" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<polygon class="glow-effect-blue opacity-50" points="50,5 95,37.5 80,90 20,90 5,37.5" stroke="var(--primary-color)" stroke-width="1.5"></polygon>
<polygon class="glow-effect-red opacity-60" points="50,15 85,42.5 72.5,80 27.5,80 15,42.5" stroke="var(--red-accent)" stroke-width="1" style="animation-delay: 0.5s;"></polygon>
</svg>
</div>
<div class="absolute inset-0 flex items-center justify-center">
<div class="w-40 h-40 bg-[var(--dark-bg)] rounded-full flex flex-col items-center justify-center shadow-[0_0_20px_rgba(0,0,0,0.5)]">
<span id="coverage-percentage" class="text-5xl font-bold text-white">--</span>
<span class="text-lg text-[var(--text-secondary)]">Coverage</span>
</div>
</div>
</div>
</div>

<!-- AI Insights Panel -->
<div class="lg:col-span-2 bg-[var(--dark-surface)] p-8 rounded-2xl border border-[var(--dark-border)] flex flex-col justify-center">
<h3 class="text-2xl font-bold mb-6 text-white">AI-Powered Insights</h3>
<div class="space-y-6">
<div class="flex items-start gap-4 p-4 rounded-lg bg-blue-500/10 border border-blue-500/20">
<span class="material-symbols-outlined text-3xl text-[var(--primary-color)] mt-1 glow-effect-blue" style="text-shadow: 0 0 10px var(--primary-color);">lightbulb</span>
<div>
<h4 class="font-bold text-white">Priority Topics Identified</h4>
<p id="priority-topics-text" class="text-[var(--text-secondary)]">Analyzing your content to identify missing topics...</p>
</div>
</div>
<div class="flex items-start gap-4 p-4 rounded-lg bg-red-500/10 border border-red-500/20">
<span class="material-symbols-outlined text-3xl text-[var(--red-accent)] mt-1 glow-effect-red" style="text-shadow: 0 0 10px var(--red-accent);">trending_up</span>
<div>
<h4 class="font-bold text-white">Engagement Boost Potential</h4>
<p id="engagement-text" class="text-[var(--text-secondary)]">Calculating potential improvements...</p>
</div>
</div>
</div>
</div>
</div>

<!-- Missing Topics Table -->
<div class="bg-[var(--dark-surface)] rounded-2xl border border-[var(--dark-border)] overflow-hidden">
<div class="p-6">
<h3 class="text-2xl font-bold text-white">Missing Topics &amp; AI Suggestions</h3>
<p class="text-[var(--text-secondary)] mt-1">Review the missing topics based on your uploaded content and use AI to generate content.</p>
</div>
<div class="overflow-x-auto">
<table class="w-full text-left">
<thead class="bg-gray-900/50">
<tr>
<th class="px-6 py-4 text-sm font-semibold uppercase tracking-wider text-white">Topic</th>
<th class="px-6 py-4 text-sm font-semibold uppercase tracking-wider text-white">AI Suggestion</th>
<th class="px-6 py-4 text-sm font-semibold uppercase tracking-wider text-white text-center">Action</th>
</tr>
</thead>
<tbody id="missing-topics-table" class="divide-y divide-[var(--dark-border)]">
<!-- Dynamic content will be inserted here -->
<tr class="analyzing">
<td colspan="3" class="px-6 py-8 text-center">
<div class="flex items-center justify-center gap-3">
<div class="loading"></div>
<span class="text-[var(--text-secondary)]">Analyzing your content with ChatGPT-4...</span>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Completion Panel (Hidden Initially) -->
<div id="completion-panel" class="hidden mt-8 bg-green-900/20 border border-green-400 rounded-2xl p-8 text-center">
<div class="mb-4">
<span class="material-symbols-outlined text-6xl text-green-400">check_circle</span>
</div>
<h3 class="text-2xl font-bold text-white mb-2">Gap Analysis Complete!</h3>
<p class="text-[var(--text-secondary)] mb-6">All identified gaps have been addressed with AI-generated content.</p>
<button id="proceed-final-report" class="bg-[var(--primary-color)] hover:bg-blue-500 transition-all duration-300 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-[0_0_20px_rgba(59,130,246,0.4)] hover:shadow-[0_0_30px_rgba(59,130,246,0.6)]" onclick="proceedToFinalReport()">
View Enhanced Final Report
</button>
</div>
</div>
</main>
</div>

<script>
// Global variables
let uploadedFiles = [];
let gapAnalysisData = {};
let missingTopics = [];
let generatedTopics = [];
let contentCoverage = 0;
let isAnalyzing = false;

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    console.log('Gap Analysis Dashboard loaded');
    initializePage();
});

// Initialize page with data from previous steps
function initializePage() {
    // Load uploaded files and previous analysis data
    const uploadedFilesData = localStorage.getItem('uploadedFiles');
    const contentAnalysisData = localStorage.getItem('contentAnalysisData');
    const brandAnalysisData = localStorage.getItem('brandAnalysisResults');
    const smeResults = localStorage.getItem('smeInterviewResults');
    
    if (uploadedFilesData) {
        uploadedFiles = JSON.parse(uploadedFilesData);
        console.log('Loaded uploaded files:', uploadedFiles);
    }
    
    // Update content summary
    updateContentSummary();
    
    // Start gap analysis with ChatGPT-4
    performGapAnalysis();
    
    console.log('Page initialized successfully');
}

// Update content summary display
function updateContentSummary() {
    const summaryElement = document.getElementById('content-summary');
    
    if (uploadedFiles && uploadedFiles.length > 0) {
        const fileTypes = uploadedFiles.map(file => getFileType(file.name));
        const uniqueTypes = [...new Set(fileTypes)];
        
        summaryElement.textContent = `Analyzing ${uploadedFiles.length} uploaded file(s): ${uniqueTypes.join(', ')} content`;
    } else {
        summaryElement.textContent = 'No content uploaded - using default analysis';
    }
}

// Get file type from filename
function getFileType(filename) {
    const extension = filename.toLowerCase().split('.').pop();
    if (['pdf'].includes(extension)) return 'PDF';
    if (['ppt', 'pptx'].includes(extension)) return 'Presentation';
    if (['doc', 'docx'].includes(extension)) return 'Document';
    if (['mp4', 'mov'].includes(extension)) return 'Video';
    if (['mp3', 'wav'].includes(extension)) return 'Audio';
    return 'Document';
}

// Perform gap analysis using ChatGPT-4
function performGapAnalysis() {
    console.log('Performing gap analysis with ChatGPT-4...');
    isAnalyzing = true;
    
    // Create analysis context based on uploaded files
    const analysisContext = {
        uploadedFiles: uploadedFiles,
        fileTypes: uploadedFiles.map(file => getFileType(file.name)),
        totalFiles: uploadedFiles.length,
        contentTypes: uploadedFiles.length > 0 ? getContentTypes() : ['general']
    };
    
    // Simulate analysis process (replace with actual ChatGPT-4 API call)
    setTimeout(() => {
        generateContextualGapAnalysis(analysisContext);
    }, 3000);
    
    // TODO: Replace with actual ChatGPT-4 API integration
    /*
    fetch('/api/gap-analysis', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            uploadedFiles: uploadedFiles,
            analysisContext: analysisContext,
            model: 'gpt-4',
            analysisType: 'comprehensive_gap_analysis'
        })
    })
    .then(response => response.json())
    .then(data => {
        gapAnalysisData = data;
        updateGapAnalysisDisplay(data);
    })
    .catch(error => {
        console.error('Gap analysis failed:', error);
        generateContextualGapAnalysis(analysisContext); // Fallback
    });
    */
}

// Get content types from uploaded files
function getContentTypes() {
    if (!uploadedFiles || uploadedFiles.length === 0) return ['general'];
    
    const types = uploadedFiles.map(file => {
        const extension = file.name.toLowerCase().split('.').pop();
        if (['ppt', 'pptx'].includes(extension)) return 'presentation';
        if (['pdf', 'doc', 'docx'].includes(extension)) return 'document';
        if (['mp4', 'mov'].includes(extension)) return 'video';
        if (['mp3', 'wav'].includes(extension)) return 'audio';
        return 'document';
    });
    
    return [...new Set(types)];
}

// Generate contextual gap analysis based on uploaded content
function generateContextualGapAnalysis(context) {
    console.log('Generating contextual gap analysis...');
    
    // Determine content coverage based on uploaded files
    contentCoverage = calculateContentCoverage(context);
    
    // Generate missing topics based on content type
    missingTopics = generateMissingTopics(context);
    
    // Update display
    updateGapAnalysisDisplay({
        coverage: contentCoverage,
        missingTopics: missingTopics,
        priorityTopics: missingTopics.filter(t => t.priority === 'High').length,
        engagementBoost: calculateEngagementBoost(missingTopics)
    });
    
    isAnalyzing = false;
    
    console.log('Gap analysis completed:', { coverage: contentCoverage, topics: missingTopics.length });
}

// Calculate content coverage based on uploaded files
function calculateContentCoverage(context) {
    // Base coverage on file types and quantity
    let coverage = 45; // Base coverage
    
    if (context.totalFiles > 0) {
        coverage += Math.min(context.totalFiles * 8, 30); // Up to 30% boost for multiple files
        
        // Bonus for different content types
        if (context.contentTypes.includes('presentation')) coverage += 10;
        if (context.contentTypes.includes('document')) coverage += 8;
        if (context.contentTypes.includes('video')) coverage += 12;
        if (context.contentTypes.includes('audio')) coverage += 7;
    }
    
    return Math.min(Math.max(coverage, 35), 85); // Keep between 35-85%
}

// Generate missing topics based on content context
function generateMissingTopics(context) {
    const baseTopics = [
        {
            id: 'advanced_concepts',
            name: 'Advanced Concepts',
            priority: 'High',
            suggestion: 'Enhance your content with advanced concepts to deepen understanding.'
        },
        {
            id: 'practical_examples',
            name: 'Practical Examples',
            priority: 'High',
            suggestion: 'Add real-world examples to improve practical application.'
        },
        {
            id: 'interactive_elements',
            name: 'Interactive Elements',
            priority: 'Medium',
            suggestion: 'Include interactive components to boost engagement.'
        }
    ];
    
    // Customize based on uploaded content
    if (context.contentTypes.includes('presentation')) {
        baseTopics[0] = {
            id: 'presentation_advanced',
            name: 'Advanced Slide Content',
            priority: 'High',
            suggestion: 'Your presentation needs additional advanced concepts and detailed explanations to enhance depth.'
        };
        baseTopics[1] = {
            id: 'presentation_examples',
            name: 'Visual Examples',
            priority: 'High',
            suggestion: 'Add more visual examples and case studies to your presentation slides for better comprehension.'
        };
    }
    
    if (context.contentTypes.includes('document')) {
        baseTopics[0] = {
            id: 'document_depth',
            name: 'Content Depth Enhancement',
            priority: 'High',
            suggestion: 'Your document content needs expansion with more detailed explanations and comprehensive coverage.'
        };
        baseTopics[2] = {
            id: 'document_structure',
            name: 'Structured Learning Path',
            priority: 'Medium',
            suggestion: 'Improve document structure with clear learning progression and better organization.'
        };
    }
    
    if (context.contentTypes.includes('video')) {
        baseTopics[1] = {
            id: 'video_supplement',
            name: 'Video Supplementary Content',
            priority: 'High',
            suggestion: 'Create additional video segments to cover topics not addressed in your current video content.'
        };
    }
    
    return baseTopics;
}

// Calculate engagement boost potential
function calculateEngagementBoost(topics) {
    const highPriorityCount = topics.filter(t => t.priority === 'High').length;
    const mediumPriorityCount = topics.filter(t => t.priority === 'Medium').length;
    
    return (highPriorityCount * 8) + (mediumPriorityCount * 4) + 3; // Estimated boost percentage
}

// Update gap analysis display
function updateGapAnalysisDisplay(data) {
    // Update coverage percentage
    document.getElementById('coverage-percentage').textContent = `${data.coverage}%`;
    
    // Update insights
    document.getElementById('priority-topics-text').innerHTML = 
        `Our AI has identified <strong class="text-white">${data.priorityTopics} high-priority topics</strong> missing from your uploaded content.`;
    
    document.getElementById('engagement-text').innerHTML = 
        `Addressing these gaps could increase learner engagement by an estimated <strong class="text-white">${data.engagementBoost}%</strong>.`;
    
    // Update missing topics table
    updateMissingTopicsTable(data.missingTopics);
    
    // Store analysis results
    localStorage.setItem('gapAnalysisResults', JSON.stringify(data));
}

// Update missing topics table
function updateMissingTopicsTable(topics) {
    const tableBody = document.getElementById('missing-topics-table');
    tableBody.innerHTML = '';
    
    topics.forEach((topic, index) => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-800/50 transition-colors duration-300';
        row.id = `topic-row-${topic.id}`;
        
        const priorityColor = topic.priority === 'High' ? 'text-[var(--red-accent)]' : 'text-yellow-400';
        
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="font-medium text-white text-base">${topic.name}</div>
                <div class="text-sm ${priorityColor} font-bold">${topic.priority} Priority</div>
            </td>
            <td class="px-6 py-4 text-[var(--text-secondary)] max-w-md">
                ${topic.suggestion}
            </td>
            <td class="px-6 py-4 text-center">
                <button id="generate-btn-${topic.id}" class="generate-btn flex items-center justify-center gap-2 bg-[var(--primary-color)] hover:bg-blue-500 transition-all duration-300 text-white font-bold py-2.5 px-5 rounded-lg text-sm shadow-[0_0_15px_rgba(59,130,246,0.4)] hover:shadow-[0_0_25px_rgba(59,130,246,0.6)]" onclick="generateTopicContent('${topic.id}', '${topic.name}')">
                    <span class="material-symbols-outlined text-base">auto_awesome</span>
                    <span class="btn-text">Generate</span>
                </button>
            </td>
        `;
        
        tableBody.appendChild(row);
    });
}

// Generate content for missing topic using ChatGPT-4
function generateTopicContent(topicId, topicName) {
    console.log(`Generating content for: ${topicName} (${topicId})`);
    
    const button = document.getElementById(`generate-btn-${topicId}`);
    const buttonText = button.querySelector('.btn-text');
    const row = document.getElementById(`topic-row-${topicId}`);
    
    // Show loading state
    button.disabled = true;
    button.classList.add('opacity-80', 'cursor-not-allowed');
    buttonText.innerHTML = '<div class="loading mr-1"></div>Generating...';
    
    // Simulate content generation with ChatGPT-4
    setTimeout(() => {
        // Mark as generated
        row.classList.add('generated-topic');
        button.classList.remove('bg-[var(--primary-color)]', 'hover:bg-blue-500');
        button.classList.add('bg-green-600', 'cursor-default');
        button.querySelector('.material-symbols-outlined').textContent = 'check';
        buttonText.textContent = 'Generated ✓';
        
        // Track generated topics
        generatedTopics.push(topicId);
        
        // Check if all topics are generated
        checkCompletionStatus();
        
        console.log(`Content generated for: ${topicName}`);
        
        // Store generation result
        localStorage.setItem('generatedTopics', JSON.stringify(generatedTopics));
        
        // TODO: Integrate with ChatGPT-4 API for actual content generation
        /*
        fetch('/api/generate-topic-content', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                topicId: topicId,
                topicName: topicName,
                context: gapAnalysisData,
                uploadedFiles: uploadedFiles,
                model: 'gpt-4'
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log(`Generated content:`, data);
        })
        .catch(error => {
            console.error(`Content generation failed:`, error);
        });
        */
        
    }, 3000 + Math.random() * 2000); // Randomize generation time
}

// Check if all topics have been generated
function checkCompletionStatus() {
    if (generatedTopics.length >= missingTopics.length) {
        // All topics generated - show completion panel
        document.getElementById('completion-panel').classList.remove('hidden');
        
        // Update coverage to 100%
        document.getElementById('coverage-percentage').textContent = '100%';
        
        // Store completion
        localStorage.setItem('gapAnalysisCompleted', 'true');
        localStorage.setItem('gapCompletionTime', new Date().toISOString());
        
        console.log('Gap analysis completed - all topics generated');
    }
}

// Proceed to Enhanced Final Report
function proceedToFinalReport() {
    console.log('Proceeding to Enhanced Final Report...');
    
    // Store final data
    const finalGapData = {
        coverage: 100,
        originalCoverage: contentCoverage,
        missingTopics: missingTopics,
        generatedTopics: generatedTopics,
        completedAt: new Date().toISOString()
    };
    
    localStorage.setItem('finalGapAnalysisResults', JSON.stringify(finalGapData));
    
    // Navigate to enhanced final report
    navigateToEnhancedFinalReport();
}

// Navigate to enhanced final report
function navigateToEnhancedFinalReport() {
    const targetPath = '../enhanced_final_report/code.html';
    
    try {
        console.log(`Navigating to: ${targetPath}`);
        window.location.href = targetPath;
        
        // Fallback navigation
        setTimeout(() => {
            if (window.location.href.indexOf('enhanced_final_report') === -1) {
                console.warn('Navigation may have failed, trying alternative method');
                window.location.replace(targetPath);
            }
        }, 2000);
        
    } catch (error) {
        console.error('Navigation failed:', error);
        alert(`Navigation failed. Please manually navigate to: ${targetPath}\n\nError: ${error.message}`);
    }
}

// Header navigation functions
function navigateToDashboard() {
    window.location.href = '../Dashboard_Landing_Pages/code.html';
}

function navigateToContent() {
    window.location.href = '../content_upload_and_processing/code.html';
}

function navigateToPerformance() {
    window.location.href = '../performance/code.html';
}

function navigateToSettings() {
    window.location.href = '../settings/code.html';
}

// Handle page unload
window.addEventListener('beforeunload', function(event) {
    if (isAnalyzing) {
        console.log('Page is being unloaded during analysis');
    }
});

// Error handling
window.addEventListener('error', function(event) {
    console.error('Uncaught error:', event.error);
});

console.log('Gap Analysis Dashboard script loaded successfully');
</script>

<!-- Add Universal Comment Widget - Expert can click anywhere to add feedback -->
<script>
window.commentWidgetConfig = {
    apiBase: "https://clamshell-backend-7k0m8s74c-mohammed-asrafs-projects.vercel.app",
    position: "top-right"
};
</script>
<script src="./comment-widget-hybrid.js"></script>

</body></html>