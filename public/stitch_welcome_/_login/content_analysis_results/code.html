<!DOCTYPE html>
<html><head>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<title>Stitch Design</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// Inline Professional Analysis Display Functions
console.log('üéì Professional Analysis Results Display Loaded');

// Helper function to display professional analysis with justifications
function displayProfessionalAnalysisWithJustifications(analysisData) {
    if (!analysisData || !analysisData.professionalAnalysis) return;

    const analysis = analysisData.professionalAnalysis;
    console.log('üìä Displaying professional analysis with justifications:', analysis);

    // Update quality metrics with justifications
    if (analysis.qualityAssessment) {
        // Update clarity with justification
        const clarityScore = document.getElementById('clarity-score');
        const clarityBar = document.getElementById('clarity-bar');
        const clarityParent = clarityBar?.closest('.flex.items-center.justify-between');

        if (clarityScore && clarityBar) {
            clarityScore.textContent = analysis.qualityAssessment.clarityScore + '%';
            clarityBar.style.width = analysis.qualityAssessment.clarityScore + '%';

            // Add justification if not already present
            if (clarityParent && !clarityParent.nextElementSibling?.classList.contains('professional-justification')) {
                const justificationHTML = `
                    <div class="professional-justification bg-[#0D0F15] p-3 rounded-lg border border-[#3b4354] mt-2 col-span-3">
                        <p class="text-xs text-neutral-300">
                            <span class="font-bold text-[var(--primary-color)]">Dr. Sarah's Professional Assessment:</span>
                            ${analysis.qualityAssessment.clarityJustification || 'Professional clarity assessment completed.'}
                        </p>
                    </div>
                `;
                clarityParent.insertAdjacentHTML('afterend', justificationHTML);
            }
        }

        // Update engagement with justification
        const engagementScore = document.getElementById('engagement-score');
        const engagementBar = document.getElementById('engagement-bar');
        const engagementParent = engagementBar?.closest('.flex.items-center.justify-between');

        if (engagementScore && engagementBar) {
            engagementScore.textContent = analysis.qualityAssessment.engagementScore + '%';
            engagementBar.style.width = analysis.qualityAssessment.engagementScore + '%';

            // Add justification if not already present
            if (engagementParent && !engagementParent.nextElementSibling?.classList.contains('professional-justification')) {
                const justificationHTML = `
                    <div class="professional-justification bg-[#0D0F15] p-3 rounded-lg border border-[#3b4354] mt-2 col-span-3">
                        <p class="text-xs text-neutral-300">
                            <span class="font-bold text-[var(--primary-color)]">Dr. Sarah's Professional Assessment:</span>
                            ${analysis.qualityAssessment.engagementJustification || 'Professional engagement assessment completed.'}
                        </p>
                    </div>
                `;
                engagementParent.insertAdjacentHTML('afterend', justificationHTML);
            }
        }

        // Update overall quality metrics
        qualityMetrics = {
            clarity: analysis.qualityAssessment.clarityScore,
            engagement: analysis.qualityAssessment.engagementScore,
            redundancy: Math.max(0, 100 - analysis.qualityAssessment.completenessScore),
            overall: analysis.qualityAssessment.overallScore
        };
    }

    // Display domain classification
    displayDomainClassification(analysis.domainClassification);

    // Display complexity assessment
    displayComplexityAssessment(analysis.complexityAssessment);

    // Display suitability assessment
    displaySuitabilityAssessment(analysis.suitabilityAssessment);

    // Display gap analysis
    displayGapAnalysis(analysis.gapAnalysis);

    // Display SME questions
    displaySMEQuestions(analysisData.contentSpecificSMEQuestions);
}

// Display functions for professional analysis sections
function displayDomainClassification(domainData) {
    if (!domainData) return;

    const domainElement = document.getElementById('domain-classification');
    if (domainElement) {
        const confidenceColor = domainData.confidence >= 85 ? 'text-green-400' :
                               domainData.confidence >= 70 ? 'text-yellow-400' : 'text-red-400';

        domainElement.innerHTML = `
            <div class="bg-[#111318] rounded-xl border border-[#282e39] p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 text-white">üìä Professional Domain Classification</h3>
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h4 class="text-2xl font-bold text-white">${domainData.primaryDomain}</h4>
                        <p class="text-sm text-neutral-400">Sub-domain: ${domainData.subDomain || 'General'}</p>
                    </div>
                    <div class="text-center">
                        <span class="text-3xl font-bold ${confidenceColor}">${domainData.confidence}%</span>
                        <p class="text-xs text-neutral-400">Confidence</p>
                    </div>
                </div>
                <div class="bg-[#0D0F15] p-4 rounded-lg border border-[#3b4354]">
                    <p class="text-sm text-neutral-300">
                        <span class="font-bold text-[var(--primary-color)]">Dr. Sarah's Evidence-Based Analysis:</span>
                        ${domainData.reasoning || 'Professional domain classification completed based on content analysis.'}
                    </p>
                </div>
            </div>
        `;
    }
}

function displayComplexityAssessment(complexityData) {
    if (!complexityData) return;

    const complexityElement = document.getElementById('complexity-assessment');
    if (complexityElement) {
        const levelColors = {
            'Beginner': 'bg-green-600',
            'Intermediate': 'bg-yellow-600',
            'Advanced': 'bg-red-600'
        };

        const levelColor = levelColors[complexityData.level] || 'bg-gray-600';

        complexityElement.innerHTML = `
            <div class="bg-[#111318] rounded-xl border border-[#282e39] p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 text-white">üéØ Professional Complexity Assessment</h3>
                <div class="flex items-center gap-4 mb-4">
                    <div class="${levelColor} px-6 py-3 rounded-xl">
                        <span class="text-xl font-bold text-white">${complexityData.level}</span>
                    </div>
                    <div>
                        <p class="text-sm text-neutral-400">Professional Assessment</p>
                    </div>
                </div>
                <div class="bg-[#0D0F15] p-4 rounded-lg border border-[#3b4354]">
                    <p class="text-sm text-neutral-300">
                        <span class="font-bold text-[var(--primary-color)]">Dr. Sarah's Expert Justification:</span>
                        ${complexityData.reasoning || 'Professional complexity assessment based on content structure and cognitive requirements.'}
                    </p>
                </div>
            </div>
        `;
    }
}

function displaySuitabilityAssessment(suitabilityData) {
    if (!suitabilityData) return;

    const suitabilityElement = document.getElementById('suitability-assessment');
    if (suitabilityElement) {
        const colorClasses = {
            'GREEN': 'bg-green-600 border-green-400 text-green-100',
            'YELLOW': 'bg-yellow-600 border-yellow-400 text-yellow-100',
            'RED': 'bg-red-600 border-red-400 text-red-100'
        };

        const colorClass = colorClasses[suitabilityData.colorCode] || 'bg-gray-600 border-gray-400 text-gray-100';
        const icon = suitabilityData.colorCode === 'GREEN' ? '‚úÖ' :
                    suitabilityData.colorCode === 'YELLOW' ? '‚ö†Ô∏è' : '‚ùå';

        suitabilityElement.innerHTML = `
            <div class="bg-[#111318] rounded-xl border border-[#282e39] p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 text-white">üéØ Professional Suitability Assessment</h3>
                <div class="${colorClass} p-6 rounded-xl border-2 mb-4">
                    <div class="flex items-center gap-4 mb-3">
                        <span class="text-4xl">${icon}</span>
                        <div>
                            <h4 class="text-2xl font-bold">${suitabilityData.level}</h4>
                            <p class="text-lg opacity-90">${suitabilityData.score}% Professional Suitability Score</p>
                        </div>
                    </div>
                    <p class="text-lg font-medium">${suitabilityData.recommendation}</p>
                </div>
                <div class="bg-[#0D0F15] p-4 rounded-lg border border-[#3b4354]">
                    <p class="text-sm text-neutral-300">
                        <span class="font-bold text-[var(--primary-color)]">Dr. Sarah's Professional Reasoning:</span>
                        ${suitabilityData.reasoning || 'Professional suitability assessment completed.'}
                    </p>
                </div>
            </div>
        `;
    }
}

function displayGapAnalysis(gapData) {
    if (!gapData) return;

    const gapElement = document.getElementById('gap-analysis');
    if (gapElement) {
        const gaps = gapData.identifiedGaps || [];

        const gapsHTML = gaps.length > 0 ? gaps.map(gap => `
            <div class="bg-[#1f232e] p-4 rounded-lg border border-[#282e39] mb-3">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-bold text-white">${gap.type} Gap</h4>
                    <span class="px-3 py-1 rounded-full text-xs font-bold bg-yellow-600">${gap.severity || 'Medium'}</span>
                </div>
                <p class="text-sm text-neutral-300 mb-3">${gap.description || 'Gap identified by professional analysis'}</p>
                <div class="bg-[#0D0F15] p-3 rounded-lg border border-[#3b4354]">
                    <p class="text-sm text-neutral-300">
                        <span class="font-bold text-[var(--primary-color)]">Dr. Sarah's Recommendation:</span>
                        ${gap.recommendation || 'Professional recommendation for addressing this gap.'}
                    </p>
                </div>
            </div>
        `).join('') : '<p class="text-center text-green-400 py-8">‚úÖ No significant gaps identified by Dr. Sarah Mitchell.</p>';

        gapElement.innerHTML = `
            <div class="bg-[#111318] rounded-xl border border-[#282e39] p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 text-white">üîç Professional Gap Analysis</h3>
                <div class="mb-4 text-center">
                    <span class="text-2xl font-bold text-white">${gaps.length}</span>
                    <p class="text-sm text-neutral-400">Instructional Gaps Identified</p>
                </div>
                ${gapsHTML}
            </div>
        `;
    }
}

function displaySMEQuestions(questions) {
    if (!questions) return;

    const questionsElement = document.getElementById('sme-questions');
    if (questionsElement) {
        const questionsHTML = questions.length > 0 ? questions.map((q, index) => `
            <div class="bg-[#1f232e] p-4 rounded-lg border border-[#282e39] mb-3">
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-lg font-bold text-white">${index + 1}.</span>
                    <span class="px-3 py-1 rounded-full text-xs font-bold bg-blue-600 text-white">${q.category || 'general'}</span>
                </div>
                <p class="text-white font-medium">${q.question}</p>
            </div>
        `).join('') : '<p class="text-center text-neutral-400 py-8">No content-specific SME questions generated.</p>';

        questionsElement.innerHTML = `
            <div class="bg-[#111318] rounded-xl border border-[#282e39] p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 text-white">‚ùì Content-Specific SME Questions</h3>
                <p class="text-sm text-neutral-400 mb-6">Dr. Sarah Mitchell generated these questions based on your specific content:</p>
                ${questionsHTML}
                ${questions.length > 0 ? '<button class="w-full mt-4 bg-[var(--primary-color)] text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-600 transition-colors" onclick="proceedToSMEInterview()">Use These Questions for SME Interview</button>' : ''}
            </div>
        `;
    }
}

// Proceed to SME interview function
function proceedToSMEInterview() {
    console.log('Proceeding to SME Interview with real backend data');
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('sessionId') || urlParams.get('session');
    window.location.href = `../brand_checklist_&_sme_interview/code.html?sessionId=${sessionId}&from=analysis`;
}
</script>
<style type="text/tailwindcss">
      :root {
        --primary-color: #135bec;
        --secondary-color: #ff3b5f;
      }
      .glowing-metric {
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.2), 0 0 10px rgba(19, 91, 236, 0.3), 0 0 15px rgba(19, 91, 236, 0.2);
      }
      .glowing-chart-bar-blue {
        box-shadow: 0 0 8px var(--primary-color), 0 0 12px var(--primary-color);
        animation: pulse-blue 2s infinite;
      }
      .glowing-chart-bar-red {
        box-shadow: 0 0 8px var(--secondary-color), 0 0 12px var(--secondary-color);
         animation: pulse-red 2.5s infinite;
      }
      .glowing-chart-bar-white {
        box-shadow: 0 0 8px #ffffff, 0 0 12px #ffffff;
         animation: pulse-white 2.2s infinite;
      }
      .glowing-border-red {
        border-color: var(--secondary-color);
        box-shadow: 0 0 5px var(--secondary-color), 0 0 10px var(--secondary-color);
        animation: pulse-red-border 2.5s infinite;
      }
      @keyframes pulse-blue {
        0%, 100% { box-shadow: 0 0 6px var(--primary-color), 0 0 10px var(--primary-color); }
        50% { box-shadow: 0 0 12px var(--primary-color), 0 0 18px var(--primary-color); }
      }
       @keyframes pulse-red {
        0%, 100% { box-shadow: 0 0 6px var(--secondary-color), 0 0 10px var(--secondary-color); }
        50% { box-shadow: 0 0 12px var(--secondary-color), 0 0 18px var(--secondary-color); }
      }
       @keyframes pulse-white {
        0%, 100% { box-shadow: 0 0 6px #ffffff, 0 0 10px #ffffff; }
        50% { box-shadow: 0 0 12px #ffffff, 0 0 18px #ffffff; }
      }
      @keyframes pulse-red-border {
        0%, 100% { box-shadow: 0 0 3px var(--secondary-color), 0 0 6px var(--secondary-color); }
        50% { box-shadow: 0 0 8px var(--secondary-color), 0 0 12px var(--secondary-color); }
      }
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .suggestion-applied {
        background-color: rgba(34, 197, 94, 0.1);
        border-color: #22c55e;
      }
      .suggestion-applied .ai-suggestion {
        color: #22c55e;
      }
      .re-analyzing {
        animation: pulse-analysis 2s infinite;
      }
      @keyframes pulse-analysis {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
    </style>
</head>
<body class="bg-[#0D0F15] text-white">
<div class="relative flex size-full min-h-screen flex-col bg-[#0D0F15] group/design-root overflow-x-hidden" style='font-family: "Space Grotesk", "Noto Sans", sans-serif;'>
<div class="layout-container flex h-full grow flex-col">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#282e39] px-10 py-4">
<div class="flex items-center gap-4 text-white">
<div class="size-8 text-[var(--primary-color)]">
<svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_6_543)">
<path d="M42.1739 20.1739L27.8261 5.82609C29.1366 7.13663 28.3989 10.1876 26.2002 13.7654C24.8538 15.9564 22.9595 18.3449 20.6522 20.6522C18.3449 22.9595 15.9564 24.8538 13.7654 26.2002C10.1876 28.3989 7.13663 29.1366 5.82609 27.8261L20.1739 42.1739C21.4845 43.4845 24.5355 42.7467 28.1133 40.548C30.3042 39.2016 32.6927 37.3073 35 35C37.3073 32.6927 39.2016 30.3042 40.548 28.1133C42.7467 24.5355 43.4845 21.4845 42.1739 20.1739Z" fill="currentColor"></path>
<path clip-rule="evenodd" d="M7.24189 26.4066C7.31369 26.4411 7.64204 26.5637 8.52504 26.3738C9.59462 26.1438 11.0343 25.5311 12.7183 24.4963C14.7583 23.2426 17.0256 21.4503 19.238 19.238C21.4503 17.0256 23.2426 14.7583 24.4963 12.7183C25.5311 11.0343 26.1438 9.59463 26.3738 8.52504C26.5637 7.64204 26.4411 7.31369 26.4066 7.24189C26.345 7.21246 26.143 7.14535 25.6664 7.1918C24.9745 7.25925 23.9954 7.5498 22.7699 8.14278C20.3369 9.32007 17.3369 11.4915 14.4142 14.4142C11.4915 17.3369 9.32007 20.3369 8.14278 22.7699C7.5498 23.9954 7.25925 24.9745 7.1918 25.6664C7.14534 26.143 7.21246 26.345 7.24189 26.4066ZM29.9001 10.7285C29.4519 12.0322 28.7617 13.4172 27.9042 14.8126C26.465 17.1544 24.4686 19.6641 22.0664 22.0664C19.6641 24.4686 17.1544 26.465 14.8126 27.9042C13.4172 28.7617 12.0322 29.4519 10.7285 29.9001L21.5754 40.747C21.6001 40.7606 21.8995 40.931 22.8729 40.7217C23.9424 40.4916 25.3821 39.879 27.0661 38.8441C29.1062 37.5904 31.3734 35.7982 33.5858 33.5858C35.7982 31.3734 37.5904 29.1062 38.8441 27.0661C39.879 25.3821 40.4916 23.9425 40.7216 22.8729C40.931 21.8995 40.7606 21.6001 40.747 21.5754L29.9001 10.7285ZM29.2403 4.41187L43.5881 18.7597C44.9757 20.1473 44.9743 22.1235 44.6322 23.7139C44.2714 25.3919 43.4158 27.2666 42.252 29.1604C40.8128 31.5022 38.8165 34.012 36.4142 36.4142C34.012 38.8165 31.5022 40.8128 29.1604 42.252C27.2666 43.4158 25.3919 44.2714 23.7139 44.6322C22.1235 44.9743 20.1473 44.9757 18.7597 43.5881L4.41187 29.2403C3.29027 28.1187 3.08209 26.5973 3.21067 25.2783C3.34099 23.9415 3.8369 22.4852 4.54214 21.0277C5.96129 18.0948 8.43335 14.7382 11.5858 11.5858C14.7382 8.43335 18.0948 5.9613 21.0277 4.54214C22.4852 3.8369 23.9415 3.34099 25.2783 3.21067C26.5973 3.08209 28.1187 3.29028 29.2403 4.41187Z" fill="white" fill-opacity="0.2" fill-rule="evenodd"></path>
</g>
<defs>
<clipPath id="clip0_6_543"><rect fill="white" height="48" width="48"></rect></clipPath>
</defs>
</svg>
</div>
<h2 class="text-white text-xl font-bold leading-tight tracking-[-0.015em]">CourseCraft AI</h2>
</div>
<div class="flex flex-1 justify-end gap-6 items-center">
<nav class="flex items-center gap-8">
<a class="text-neutral-300 hover:text-white transition-colors text-sm font-medium leading-normal cursor-pointer" onclick="navigateToDashboard()">Dashboard</a>
<a class="text-neutral-300 hover:text-white transition-colors text-sm font-medium leading-normal cursor-pointer" onclick="navigateToProjects()">Projects</a>
<a class="text-white text-sm font-medium leading-normal" href="#">Analysis</a>
<a class="text-neutral-300 hover:text-white transition-colors text-sm font-medium leading-normal cursor-pointer" onclick="navigateToResources()">Resources</a>
<a class="text-neutral-300 hover:text-white transition-colors text-sm font-medium leading-normal cursor-pointer" onclick="navigateToCommunity()">Community</a>
</nav>
<button class="flex items-center justify-center rounded-full h-10 w-10 bg-[#1f232e] text-neutral-400 hover:text-white hover:bg-[#282e39] transition-colors">
<span class="material-symbols-outlined text-2xl">notifications</span>
</button>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-transparent hover:border-[var(--primary-color)] transition-colors" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD0sePGBr_vayWt3d6C45L5DAuo6Wj29pvRUDS8XPpHU7_cLQG22Dmq9ccGvZ-hRch3LZE6Eg-vpls2AuYVUR9nCdBGYdyEc1oAk5il--Pit__W_W2JQh_7MheFtLh6poqU1jD2HjSm_9DrOXEuPVhIZ6n3SdXttl6SHBZm6a-CRL6U6m-Nzv7-hDwXE4EFYuk1FDezEtKzlUxGB5ZqOr9Fz3e4Lt7n2Rc6642A148Uys5T1IMjDSixt3vaUM1toQOlHfpm5zkv4EU");'></div>
</div>
</header>
<main class="px-10 lg:px-20 xl:px-40 flex flex-1 justify-center py-12">
<div class="layout-content-container flex flex-col w-full max-w-[1200px]">
<div class="flex flex-col gap-4 mb-12">
<h1 class="text-4xl font-bold tracking-tight">Content Analysis Results</h1>
<p class="text-neutral-400 text-lg">AI-powered insights to refine your course content using ChatGPT-4.</p>
</div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
<div class="lg:col-span-2 flex flex-col gap-8">
<div class="bg-[#111318] rounded-xl border border-[#282e39] p-6">
<h3 class="text-xl font-bold mb-4">Modules &amp; Lessons Status</h3>
<div class="flex flex-col gap-4" id="modules-container">
<!-- Module 1: Complete -->
<div class="flex items-center justify-between p-4 rounded-lg bg-[#1f232e] border border-transparent hover:border-[var(--primary-color)] transition-all">
<div class="flex items-center gap-4">
<span class="material-symbols-outlined text-green-400">check_circle</span>
<div>
<h4 class="font-bold text-white">Module 1: Introduction</h4>
<p class="text-sm text-neutral-400">Status: Complete</p>
</div>
</div>
<button class="text-neutral-400 hover:text-white" onclick="toggleModule('module1')">
<span class="material-symbols-outlined">expand_more</span>
</button>
</div>

<!-- Module 2: Needs Improvement (Expanded) -->
<div class="flex flex-col gap-4 p-4 rounded-lg bg-[#1f232e] border glowing-border-red">
<div class="flex items-center justify-between">
<div class="flex items-center gap-4">
<span class="material-symbols-outlined text-[var(--secondary-color)]">error</span>
<div>
<h4 class="font-bold text-white">Module 2: Core Concepts</h4>
<p class="text-sm text-red-400">Status: Needs Improvement</p>
</div>
</div>
<button class="text-neutral-400 hover:text-white" onclick="toggleModule('module2')">
<span class="material-symbols-outlined">expand_less</span>
</button>
</div>

<!-- Suggestions Container -->
<div class="pl-8 flex flex-col gap-4 mt-2 border-l-2 border-dashed border-[#282e39] ml-4" id="module2-suggestions">
<div id="suggestion1" class="p-4 rounded-md bg-[#282e39]/50">
<p class="text-sm text-neutral-300 mb-2"><strong class="font-bold text-white">Missing Section:</strong> 'Learning Objectives' is not clearly defined.</p>
<div class="bg-[#0D0F15] p-3 rounded-lg border border-[#3b4354]">
<p class="text-sm text-neutral-400 font-mono ai-suggestion"><span class="text-[var(--primary-color)]">AI Suggestion:</span> "Add a bulleted list of 3-5 specific, measurable learning objectives at the beginning of this module."</p>
<div class="flex gap-2 mt-3">
<button class="text-xs font-bold bg-[var(--primary-color)] text-white px-3 py-1 rounded-md hover:bg-blue-600 transition-colors" onclick="applySuggestion('suggestion1', 'learning_objectives')">Apply</button>
<button class="text-xs font-bold bg-transparent text-neutral-300 px-3 py-1 rounded-md hover:bg-[#3b4354] transition-colors" onclick="editSuggestion('suggestion1')">Edit</button>
</div>
</div>
</div>
<div id="suggestion2" class="p-4 rounded-md bg-[#282e39]/50">
<p class="text-sm text-neutral-300 mb-2"><strong class="font-bold text-white">Low Quality:</strong> 'Examples' section is too brief.</p>
<div class="bg-[#0D0F15] p-3 rounded-lg border border-[#3b4354]">
<p class="text-sm text-neutral-400 font-mono ai-suggestion"><span class="text-[var(--primary-color)]">AI Suggestion:</span> "Expand with at least two real-world examples for each core concept to improve clarity and retention."</p>
<div class="flex gap-2 mt-3">
<button class="text-xs font-bold bg-[var(--primary-color)] text-white px-3 py-1 rounded-md hover:bg-blue-600 transition-colors" onclick="applySuggestion('suggestion2', 'examples')">Apply</button>
<button class="text-xs font-bold bg-transparent text-neutral-300 px-3 py-1 rounded-md hover:bg-[#3b4354] transition-colors" onclick="editSuggestion('suggestion2')">Edit</button>
</div>
</div>
</div>
</div>
</div>

<!-- Module 3: Complete -->
<div class="flex items-center justify-between p-4 rounded-lg bg-[#1f232e] border border-transparent hover:border-[var(--primary-color)] transition-all">
<div class="flex items-center gap-4">
<span class="material-symbols-outlined text-green-400">check_circle</span>
<div>
<h4 class="font-bold text-white">Module 3: Advanced Techniques</h4>
<p class="text-sm text-neutral-400">Status: Complete</p>
</div>
</div>
<button class="text-neutral-400 hover:text-white" onclick="toggleModule('module3')">
<span class="material-symbols-outlined">expand_more</span>
</button>
</div>
</div>

<!-- Completion Status -->
<div id="completion-status" class="hidden bg-green-900/20 border border-green-400 rounded-lg p-4 text-center">
<p class="text-green-400 font-bold mb-2">üéâ All Suggestions Applied!</p>
<p class="text-neutral-300 text-sm">Your content analysis is complete. Ready to proceed to Gap Analysis.</p>
<button class="mt-3 px-4 py-2 bg-green-600 text-white rounded-md font-bold hover:bg-green-700 transition-colors" onclick="proceedToGapAnalysis()">
Proceed to Gap Analysis
</button>
</div>
</div>
</div>

<!-- Sidebar -->
<div class="bg-[#111318] rounded-xl border border-[#282e39] p-6 flex flex-col gap-6">
<!-- Quality Metrics -->
<div>
<h3 class="text-xl font-bold mb-4">Quality Metrics</h3>
<div class="flex flex-col gap-4" id="quality-metrics">
<div class="flex items-center justify-between">
<p class="text-neutral-300">Clarity</p>
<div class="w-1/2 bg-[#282e39] rounded-full h-2.5">
<div id="clarity-bar" class="bg-[var(--primary-color)] h-2.5 rounded-full glowing-chart-bar-blue" style="width: 0%"></div>
</div>
<span id="clarity-score" class="font-bold text-white">Loading...</span>
</div>
<div class="flex items-center justify-between">
<p class="text-neutral-300">Redundancy</p>
<div class="w-1/2 bg-[#282e39] rounded-full h-2.5">
<div id="redundancy-bar" class="bg-[var(--secondary-color)] h-2.5 rounded-full glowing-chart-bar-red" style="width: 0%"></div>
</div>
<span id="redundancy-score" class="font-bold text-white">Loading...</span>
</div>
<div class="flex items-center justify-between">
<p class="text-neutral-300">Engagement</p>
<div class="w-1/2 bg-[#282e39] rounded-full h-2.5">
<div id="engagement-bar" class="bg-white h-2.5 rounded-full glowing-chart-bar-white" style="width: 0%"></div>
</div>
<span id="engagement-score" class="font-bold text-white">Loading...</span>
</div>
</div>
</div>

<!-- Content Map -->
<div>
<h3 class="text-xl font-bold mb-4">Content Map</h3>
<div class="relative flex justify-center items-center h-48">
<div class="absolute w-full h-px bg-[#282e39]"></div>
<div class="absolute h-full w-px bg-[#282e39]"></div>
<div class="glowing-metric bg-[var(--primary-color)] rounded-full size-16 flex items-center justify-center text-xs font-bold text-center p-2 z-10">Intro</div>
<div class="glowing-metric bg-white text-[#0D0F15] rounded-full size-12 flex items-center justify-center text-xs font-bold text-center p-2 z-10 absolute" style="top: 10px; left: 25%;">Concepts</div>
<div class="glowing-metric bg-white text-[#0D0F15] rounded-full size-12 flex items-center justify-center text-xs font-bold text-center p-2 z-10 absolute" style="bottom: 10px; right: 25%;">Techniques</div>
<div class="glowing-metric bg-[var(--secondary-color)] rounded-full size-10 flex items-center justify-center text-xs font-bold text-center p-2 z-10 absolute" style="top: 50%; right: 10%; transform: translateY(-50%);">Quiz</div>
</div>
<p class="text-neutral-400 text-sm mt-4 text-center">Visual representation of content flow and connections.</p>
</div>

<!-- Professional Analysis Results - NEW SECTIONS -->

<!-- Domain Classification -->
<div id="domain-classification">
<!-- Will be populated by professional analysis -->
</div>

<!-- Complexity Assessment -->
<div id="complexity-assessment">
<!-- Will be populated by professional analysis -->
</div>

<!-- Suitability Assessment -->
<div id="suitability-assessment">
<!-- Will be populated by professional analysis -->
</div>

<!-- Gap Analysis -->
<div id="gap-analysis">
<!-- Will be populated by professional analysis -->
</div>

<!-- Enhancement Suggestions -->
<div id="enhancement-suggestions">
<!-- Will be populated by professional analysis -->
</div>

<!-- SME Questions -->
<div id="sme-questions">
<!-- Will be populated by professional analysis -->
</div>

<!-- Professional Recommendations -->
<div id="professional-recommendations">
<!-- Will be populated by professional analysis -->
</div>

<!-- Action Buttons -->
<div class="flex flex-col gap-3 mt-auto">
<button id="reanalyze-btn" class="flex w-full items-center justify-center gap-2 rounded-md h-10 px-4 bg-[var(--primary-color)] text-white text-sm font-bold hover:bg-blue-600 transition-colors" onclick="reAnalyzeContent()">
<span class="material-symbols-outlined">model_training</span>
<span id="reanalyze-text" class="truncate">Re-analyze Content</span>
</button>
<button id="export-btn" class="flex w-full items-center justify-center gap-2 rounded-md h-10 px-4 bg-[#282e39] text-white text-sm font-bold hover:bg-[#3b4354] transition-colors" onclick="exportAnalysisToPDF()">
<span class="material-symbols-outlined">download</span>
<span id="export-text" class="truncate">Export Analysis</span>
</button>
</div>
</div>
</div>
</div>
</main>
</div>
</div>

<script>
// Global variables
let contentAnalysisData = {};
let appliedSuggestions = [];
let isReAnalyzing = false;
let isExporting = false;
let uploadedFiles = [];
let qualityMetrics = {
    clarity: null,
    redundancy: null,
    engagement: null
};

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    console.log('Content Analysis Results page loaded');

    // Check for professional analysis results first
    const professionalAnalysisData = localStorage.getItem('professionalAnalysisResults');

    if (professionalAnalysisData) {
        console.log('üìä Loading professional analysis results...');
        const analysisData = JSON.parse(professionalAnalysisData);
        console.log('üìä Analysis data structure:', analysisData);

        // Check if this is from our new backend format
        if (analysisData.data && analysisData.data.domain) {
            console.log('‚úÖ Using new backend format');
            displaySimpleAnalysisResults(analysisData.data);
        } else if (analysisData.professionalAnalysis) {
            console.log('‚úÖ Using old professional analysis format');
            displayProfessionalAnalysisResults(analysisData);
        } else {
            console.log('‚ö†Ô∏è Unknown format, using fallback');
            initializePage();
        }
    } else {
        // Try to load from URL parameter (if redirected with session ID)
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');

        if (sessionId) {
            console.log(`üîç Loading professional analysis for session: ${sessionId}`);
            loadProfessionalAnalysisFromSession(sessionId);
        } else {
            // Fallback to original initialization
            console.log('üìã No professional analysis found, using original display');
            initializePage();
        }
    }
});

// Display simple analysis results from new backend format
function displaySimpleAnalysisResults(data) {
    console.log('üéØ Displaying simple analysis results:', data);

    // Update domain display
    const domainElement = document.querySelector('.text-2xl.font-bold.text-white');
    if (domainElement && domainElement.textContent === 'General') {
        domainElement.textContent = data.domain || 'General';
    }

    // Update word count display
    const wordCountElements = document.querySelectorAll('[class*="word"]');
    wordCountElements.forEach(el => {
        if (el.textContent.includes('0 words')) {
            el.textContent = el.textContent.replace('0 words', `${data.wordCount || 0} words`);
        }
    });

    // Update reasoning/description
    const reasoningElements = document.querySelectorAll('.text-sm.text-neutral-400, .text-neutral-400');
    reasoningElements.forEach(el => {
        if (el.textContent.includes('AI has classified')) {
            el.textContent = data.reasoning || el.textContent;
        }
    });

    console.log('‚úÖ Analysis results displayed:', {
        domain: data.domain,
        wordCount: data.wordCount,
        reasoning: data.reasoning?.substring(0, 50)
    });
}

// Load professional analysis from session ID
async function loadProfessionalAnalysisFromSession(sessionId) {
    try {
        const response = await fetch(`https://clamshell-backend-e5dmap3xc-mohammed-asrafs-projects.vercel.app/api/content/analysis-status/${sessionId}`);

        if (!response.ok) {
            throw new Error(`Failed to load analysis: ${response.status}`);
        }

        const result = await response.json();

        if (result.data.status === 'completed' && result.data.professionalAnalysis) {
            console.log('‚úÖ Professional analysis loaded from session');
            localStorage.setItem('professionalAnalysisResults', JSON.stringify(result.data));
            displayProfessionalAnalysisResults(result.data);
        } else {
            console.warn('‚ö†Ô∏è Analysis not completed yet, using fallback');
            initializePage();
        }

    } catch (error) {
        console.error('‚ùå Failed to load professional analysis:', error);
        initializePage(); // Fallback to original display
    }
}

// Display professional analysis results
function displayProfessionalAnalysisResults(analysisData) {
    console.log('üéì Displaying professional analysis results from Dr. Sarah Mitchell');

    const analysis = analysisData.professionalAnalysis;

    try {
        // Update quality metrics with justifications
        if (analysis.qualityAssessment) {
            updateQualityMetricsWithJustifications(analysis.qualityAssessment);
        }

        // Display all professional analysis sections
        displayProfessionalAnalysisWithJustifications(analysisData);

        console.log('‚úÖ Professional analysis results displayed successfully');

    } catch (error) {
        console.error('‚ùå Error displaying professional analysis:', error);
        initializePage(); // Fallback to original display
    }
}

// Update quality metrics with justifications
function updateQualityMetricsWithJustifications(qualityData) {
    // Update existing quality bars with professional scores
    const metrics = [
        { name: 'clarity', score: qualityData.clarityScore, justification: qualityData.clarityJustification },
        { name: 'engagement', score: qualityData.engagementScore, justification: qualityData.engagementJustification }
    ];

    metrics.forEach(metric => {
        const scoreElement = document.getElementById(`${metric.name}-score`);
        const barElement = document.getElementById(`${metric.name}-bar`);

        if (scoreElement) {
            scoreElement.textContent = `${metric.score}%`;
        }

        if (barElement) {
            barElement.style.width = `${metric.score}%`;

            // Add justification below the bar
            const parentElement = barElement.closest('.flex.items-center.justify-between');
            if (parentElement && !parentElement.querySelector('.professional-justification')) {
                const justificationDiv = document.createElement('div');
                justificationDiv.className = 'professional-justification bg-[#0D0F15] p-3 rounded-lg border border-[#3b4354] mt-2 col-span-full';
                justificationDiv.innerHTML = `
                    <p class="text-xs text-neutral-300">
                        <span class="font-bold text-[var(--primary-color)]">Dr. Sarah's Assessment:</span>
                        ${metric.justification}
                    </p>
                `;

                // Insert after the current row
                parentElement.parentNode.insertBefore(justificationDiv, parentElement.nextSibling);
            }
        }
    });

    // Update overall quality metrics object
    qualityMetrics = {
        clarity: qualityData.clarityScore,
        completeness: qualityData.completenessScore,
        engagement: qualityData.engagementScore,
        redundancy: Math.max(0, 100 - qualityData.clarityScore), // Inverse relationship
        overall: qualityData.overallScore
    };
}

// Basic professional analysis display (fallback)
function displayProfessionalAnalysisBasic(analysisData) {
    const analysis = analysisData.professionalAnalysis;

    // Add professional analysis summary to the page
    const summaryHTML = `
        <div class="bg-[#111318] rounded-xl border border-[#282e39] p-6 mb-8">
            <h3 class="text-2xl font-bold mb-4 text-white">üéì Professional Analysis Summary</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="bg-[#1f232e] p-4 rounded-lg">
                    <div class="text-2xl font-bold text-white mb-2">${analysis.domainClassification.primaryDomain}</div>
                    <div class="text-sm text-neutral-400">Domain (${analysis.domainClassification.confidence}% confidence)</div>
                </div>
                <div class="bg-[#1f232e] p-4 rounded-lg">
                    <div class="text-2xl font-bold text-white mb-2">${analysis.complexityAssessment.level}</div>
                    <div class="text-sm text-neutral-400">Complexity Level</div>
                </div>
                <div class="bg-[#1f232e] p-4 rounded-lg">
                    <div class="text-2xl font-bold text-white mb-2">${analysis.qualityAssessment.overallScore}%</div>
                    <div class="text-sm text-neutral-400">Professional Score</div>
                </div>
            </div>
            <div class="mt-4 bg-[#0D0F15] p-4 rounded-lg border border-[#3b4354]">
                <p class="text-sm text-neutral-300">
                    <span class="font-bold text-[var(--primary-color)]">Dr. Sarah Mitchell's Assessment:</span>
                    ${analysis.suitabilityAssessment.recommendation}
                </p>
            </div>
        </div>
    `;

    // Insert the summary at the top of the main content
    const mainContent = document.querySelector('main .layout-content-container');
    if (mainContent) {
        const firstChild = mainContent.firstElementChild;
        firstChild.insertAdjacentHTML('afterend', summaryHTML);
    }
}

// Initialize page with data from previous steps
function initializePage() {
    // Load uploaded files and previous analysis data
    const uploadedFilesData = localStorage.getItem('uploadedFiles');
    const brandAnalysis = localStorage.getItem('brandAnalysisResults');
    const smeResults = localStorage.getItem('smeInterviewResults');
    
    if (uploadedFilesData) {
        uploadedFiles = JSON.parse(uploadedFilesData);
        console.log('Loaded uploaded files:', uploadedFiles);
    }
    
    if (brandAnalysis) {
        const brandData = JSON.parse(brandAnalysis);
        console.log('Loaded brand analysis:', brandData);
    }
    
    if (smeResults) {
        const smeData = JSON.parse(smeResults);
        console.log('Loaded SME results:', smeData);
    }
    
    // Generate content-specific analysis
    generateContentAnalysis();
    
    console.log('Page initialized successfully');
}

// Generate content analysis using ChatGPT-4
function generateContentAnalysis() {
    console.log('Generating content analysis with ChatGPT-4...');
    
    // Analyze uploaded content to create contextual analysis
    const analysisContext = {
        uploadedFiles: uploadedFiles,
        fileTypes: uploadedFiles.map(file => getFileType(file.name)),
        totalFiles: uploadedFiles.length
    };
    
    // Store analysis context
    contentAnalysisData = {
        timestamp: new Date().toISOString(),
        context: analysisContext,
        modules: generateModuleAnalysis(analysisContext),
        metrics: qualityMetrics,
        suggestions: generateSuggestions(analysisContext)
    };
    
    localStorage.setItem('contentAnalysisData', JSON.stringify(contentAnalysisData));
    
    // Update UI with dynamic content
    updateAnalysisDisplay();
    
    // TODO: Integrate with your ChatGPT-4 API for content analysis
    /*
    fetch('/api/analyze-content', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            files: uploadedFiles,
            context: analysisContext,
            model: 'gpt-4',
            analysisType: 'comprehensive_content_analysis'
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Content analysis completed:', data);
        contentAnalysisData = data;
        updateAnalysisDisplay();
    })
    .catch(error => {
        console.error('Content analysis failed:', error);
    });
    */
}

// Get file type from filename
function getFileType(filename) {
    const extension = filename.toLowerCase().split('.').pop();
    if (['pdf'].includes(extension)) return 'document';
    if (['ppt', 'pptx'].includes(extension)) return 'presentation';
    if (['doc', 'docx'].includes(extension)) return 'document';
    if (['mp4', 'mov'].includes(extension)) return 'video';
    if (['mp3', 'wav'].includes(extension)) return 'audio';
    return 'document';
}

// Generate module analysis based on content
function generateModuleAnalysis(context) {
    const fileTypes = context.fileTypes;
    const hasPresentation = fileTypes.includes('presentation');
    const hasDocument = fileTypes.includes('document');
    
    return {
        module1: { status: 'complete', issues: [] },
        module2: {
            status: 'needs_improvement',
            issues: [
                {
                    type: 'missing_section',
                    title: 'Learning Objectives',
                    suggestion: hasPresentation ? 
                        'Add clear learning objectives slide at the beginning of your presentation content.' :
                        'Add a bulleted list of 3-5 specific, measurable learning objectives at the beginning of this module.'
                },
                {
                    type: 'low_quality',
                    title: 'Examples',
                    suggestion: hasDocument ? 
                        'Expand your document with at least two real-world examples for each core concept.' :
                        'Expand with at least two real-world examples for each core concept to improve clarity and retention.'
                }
            ]
        },
        module3: { status: 'complete', issues: [] }
    };
}

// Generate contextual suggestions
function generateSuggestions(context) {
    return [
        {
            id: 'learning_objectives',
            type: 'missing_section',
            priority: 'high',
            suggestion: 'Add clear learning objectives based on your uploaded content'
        },
        {
            id: 'examples',
            type: 'enhancement',
            priority: 'medium',
            suggestion: 'Enhance examples to match your content type and audience'
        }
    ];
}

// Update analysis display
function updateAnalysisDisplay() {
    // Update any dynamic content based on uploaded files
    console.log('Analysis display updated with content-specific data');
}

// Toggle module expansion
function toggleModule(moduleId) {
    console.log(`Toggling module: ${moduleId}`);
    // Add module expansion/collapse functionality if needed
}

// Apply AI suggestion
function applySuggestion(suggestionId, suggestionType) {
    console.log(`Applying suggestion: ${suggestionId} (${suggestionType})`);
    
    const suggestionElement = document.getElementById(suggestionId);
    
    // Show loading state
    const applyBtn = suggestionElement.querySelector('button');
    const originalText = applyBtn.textContent;
    applyBtn.innerHTML = '<div class="loading mr-1"></div>Applying...';
    applyBtn.disabled = true;
    
    // Simulate application process with ChatGPT-4
    setTimeout(() => {
        // Mark as applied
        suggestionElement.classList.add('suggestion-applied');
        applyBtn.textContent = 'Applied ‚úì';
        applyBtn.classList.remove('bg-[var(--primary-color)]', 'hover:bg-blue-600');
        applyBtn.classList.add('bg-green-600', 'cursor-default');
        applyBtn.disabled = true;
        
        // Track applied suggestions
        appliedSuggestions.push(suggestionId);
        
        // Update quality metrics
        updateQualityMetrics(suggestionType);
        
        // Check if all suggestions are applied
        checkCompletionStatus();
        
        console.log(`Suggestion ${suggestionId} applied successfully`);
        
        // Store application
        localStorage.setItem('appliedSuggestions', JSON.stringify(appliedSuggestions));
        
        // TODO: Send to ChatGPT-4 backend to actually apply the suggestion
        /*
        fetch('/api/apply-suggestion', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                suggestionId: suggestionId,
                suggestionType: suggestionType,
                contentContext: contentAnalysisData,
                model: 'gpt-4'
            })
        });
        */
        
    }, 2000);
}

// Edit AI suggestion
function editSuggestion(suggestionId) {
    console.log(`Editing suggestion: ${suggestionId}`);
    
    const suggestionElement = document.getElementById(suggestionId);
    const suggestionText = suggestionElement.querySelector('.ai-suggestion');
    
    // Create editable text area
    const currentText = suggestionText.textContent.replace('AI Suggestion: ', '');
    const textarea = document.createElement('textarea');
    textarea.className = 'w-full bg-[#282e39] border border-[#3b4354] rounded p-2 text-white text-sm';
    textarea.value = currentText.replace(/"/g, '');
    textarea.rows = 3;
    
    // Replace suggestion with editable field
    suggestionText.innerHTML = '<span class="text-[var(--primary-color)]">AI Suggestion (Edit):</span>';
    suggestionText.appendChild(textarea);
    
    // Update buttons
    const buttonsDiv = suggestionElement.querySelector('.flex.gap-2');
    buttonsDiv.innerHTML = `
        <button class="text-xs font-bold bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 transition-colors" onclick="saveSuggestionEdit('${suggestionId}')">Save</button>
        <button class="text-xs font-bold bg-gray-600 text-white px-3 py-1 rounded-md hover:bg-gray-700 transition-colors" onclick="cancelSuggestionEdit('${suggestionId}')">Cancel</button>
    `;
    
    textarea.focus();
}

// Save suggestion edit
function saveSuggestionEdit(suggestionId) {
    console.log(`Saving edited suggestion: ${suggestionId}`);
    
    const suggestionElement = document.getElementById(suggestionId);
    const textarea = suggestionElement.querySelector('textarea');
    const newText = textarea.value;
    
    // Update suggestion text
    const suggestionText = suggestionElement.querySelector('.ai-suggestion');
    suggestionText.innerHTML = `<span class="text-[var(--primary-color)]">AI Suggestion:</span> "${newText}"`;
    
    // Restore original buttons
    const buttonsDiv = suggestionElement.querySelector('.flex.gap-2');
    const suggestionType = suggestionId.includes('1') ? 'learning_objectives' : 'examples';
    buttonsDiv.innerHTML = `
        <button class="text-xs font-bold bg-[var(--primary-color)] text-white px-3 py-1 rounded-md hover:bg-blue-600 transition-colors" onclick="applySuggestion('${suggestionId}', '${suggestionType}')">Apply</button>
        <button class="text-xs font-bold bg-transparent text-neutral-300 px-3 py-1 rounded-md hover:bg-[#3b4354] transition-colors" onclick="editSuggestion('${suggestionId}')">Edit</button>
    `;
    
    console.log(`Suggestion ${suggestionId} edited and saved`);
}

// Cancel suggestion edit
function cancelSuggestionEdit(suggestionId) {
    location.reload(); // Simple way to restore original state
}

// Update quality metrics based on applied suggestions
function updateQualityMetrics(suggestionType) {
    if (suggestionType === 'learning_objectives') {
        qualityMetrics.clarity = Math.min(100, qualityMetrics.clarity + 5);
        qualityMetrics.engagement = Math.min(100, qualityMetrics.engagement + 8);
    } else if (suggestionType === 'examples') {
        qualityMetrics.engagement = Math.min(100, qualityMetrics.engagement + 12);
        qualityMetrics.redundancy = Math.max(0, qualityMetrics.redundancy - 3);
    }
    
    // Update UI
    document.getElementById('clarity-score').textContent = `${qualityMetrics.clarity}%`;
    document.getElementById('clarity-bar').style.width = `${qualityMetrics.clarity}%`;
    
    document.getElementById('engagement-score').textContent = `${qualityMetrics.engagement}%`;
    document.getElementById('engagement-bar').style.width = `${qualityMetrics.engagement}%`;
    
    document.getElementById('redundancy-score').textContent = `${qualityMetrics.redundancy}%`;
    document.getElementById('redundancy-bar').style.width = `${qualityMetrics.redundancy}%`;
}

// Check completion status
function checkCompletionStatus() {
    if (appliedSuggestions.length >= 2) { // All suggestions applied
        document.getElementById('completion-status').classList.remove('hidden');
        
        // Update module 2 status
        const module2 = document.querySelector('#modules-container .glowing-border-red');
        module2.classList.remove('glowing-border-red');
        module2.classList.add('border-green-400');
        
        const module2Icon = module2.querySelector('.material-symbols-outlined');
        module2Icon.textContent = 'check_circle';
        module2Icon.className = 'material-symbols-outlined text-green-400';
        
        const module2Status = module2.querySelector('.text-red-400');
        module2Status.textContent = 'Status: Complete';
        module2Status.className = 'text-sm text-green-400';
    }
}

// Re-analyze content with ChatGPT-4
function reAnalyzeContent() {
    if (isReAnalyzing) return;
    
    console.log('Re-analyzing content with ChatGPT-4...');
    isReAnalyzing = true;
    
    const reanalyzeBtn = document.getElementById('reanalyze-btn');
    const reanalyzeText = document.getElementById('reanalyze-text');
    
    // Show loading state
    reanalyzeBtn.disabled = true;
    reanalyzeBtn.classList.add('opacity-80', 'cursor-not-allowed', 're-analyzing');
    reanalyzeText.innerHTML = '<div class="loading mr-2"></div>Re-analyzing...';
    
    // Add visual feedback
    const modulesContainer = document.getElementById('modules-container');
    modulesContainer.classList.add('re-analyzing');
    
    // Simulate re-analysis process
    setTimeout(() => {
        // Update metrics with new values
        qualityMetrics = {
            clarity: Math.min(100, qualityMetrics.clarity + Math.random() * 5),
            redundancy: Math.max(0, qualityMetrics.redundancy - Math.random() * 2),
            engagement: Math.min(100, qualityMetrics.engagement + Math.random() * 8)
        };
        
        updateQualityMetrics('reanalysis');
        
        // Restore button state
        reanalyzeBtn.disabled = false;
        reanalyzeBtn.classList.remove('opacity-80', 'cursor-not-allowed', 're-analyzing');
        reanalyzeText.textContent = 'Re-analyze Content';
        
        modulesContainer.classList.remove('re-analyzing');
        
        isReAnalyzing = false;
        
        console.log('Re-analysis completed');
        
        // Store updated analysis
        localStorage.setItem('contentReAnalyzed', 'true');
        localStorage.setItem('lastReAnalysisTime', new Date().toISOString());
        
        // TODO: Integrate with ChatGPT-4 API for re-analysis
        /*
        fetch('/api/reanalyze-content', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                previousAnalysis: contentAnalysisData,
                appliedSuggestions: appliedSuggestions,
                model: 'gpt-4'
            })
        })
        .then(response => response.json())
        .then(data => {
            contentAnalysisData = data;
            updateAnalysisDisplay();
        });
        */
        
    }, 4000);
}

// Export analysis to PDF
function exportAnalysisToPDF() {
    if (isExporting) return;
    
    console.log('Exporting analysis to PDF...');
    isExporting = true;
    
    const exportBtn = document.getElementById('export-btn');
    const exportText = document.getElementById('export-text');
    
    // Show loading state
    exportBtn.disabled = true;
    exportBtn.classList.add('opacity-80', 'cursor-not-allowed');
    exportText.innerHTML = '<div class="loading mr-2"></div>Generating PDF...';
    
    // Generate PDF using jsPDF
    setTimeout(() => {
        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('Content Analysis Report', 20, 30);
            
            // Add generated date
            doc.setFontSize(12);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 45);
            
            // Add content analysis summary
            doc.setFontSize(16);
            doc.text('Analysis Summary', 20, 65);
            
            doc.setFontSize(12);
            doc.text(`Total Files Analyzed: ${uploadedFiles.length}`, 20, 80);
            doc.text(`File Types: ${uploadedFiles.map(f => getFileType(f.name)).join(', ')}`, 20, 95);
            
            // Add quality metrics
            doc.setFontSize(16);
            doc.text('Quality Metrics', 20, 120);
            
            doc.setFontSize(12);
            doc.text(`Clarity: ${qualityMetrics.clarity}%`, 20, 135);
            doc.text(`Redundancy: ${qualityMetrics.redundancy}%`, 20, 150);
            doc.text(`Engagement: ${qualityMetrics.engagement}%`, 20, 165);
            
            // Add module status
            doc.setFontSize(16);
            doc.text('Module Status', 20, 190);
            
            doc.setFontSize(12);
            doc.text('Module 1: Introduction - Complete', 20, 205);
            doc.text(`Module 2: Core Concepts - ${appliedSuggestions.length >= 2 ? 'Complete' : 'Needs Improvement'}`, 20, 220);
            doc.text('Module 3: Advanced Techniques - Complete', 20, 235);
            
            // Add applied suggestions
            if (appliedSuggestions.length > 0) {
                doc.setFontSize(16);
                doc.text('Applied Suggestions', 20, 260);
                
                doc.setFontSize(12);
                appliedSuggestions.forEach((suggestion, index) => {
                    doc.text(`${index + 1}. ${suggestion} - Applied`, 20, 275 + (index * 15));
                });
            }
            
            // Save PDF
            const filename = `content_analysis_report_${new Date().getTime()}.pdf`;
            doc.save(filename);
            
            console.log(`PDF exported: ${filename}`);
            
        } catch (error) {
            console.error('PDF generation failed:', error);
            alert('PDF generation failed. Please try again.');
        }
        
        // Restore button state
        exportBtn.disabled = false;
        exportBtn.classList.remove('opacity-80', 'cursor-not-allowed');
        exportText.textContent = 'Export Analysis';
        
        isExporting = false;
        
        // Store export log
        localStorage.setItem('analysisExported', 'true');
        localStorage.setItem('lastExportTime', new Date().toISOString());
        
    }, 2000);
}

// Proceed to Gap Analysis Dashboard
function proceedToGapAnalysis() {
    console.log('Proceeding to Gap Analysis Dashboard...');
    
    // Store completion data
    localStorage.setItem('contentAnalysisCompleted', 'true');
    localStorage.setItem('completionTime', new Date().toISOString());
    
    // Navigate to gap analysis dashboard
    navigateToGapAnalysisDashboard();
}

// Navigate to gap analysis dashboard
function navigateToGapAnalysisDashboard() {
    const targetPath = '../gap_analysis_dashboard/code.html';
    
    try {
        console.log(`Navigating to: ${targetPath}`);
        window.location.href = targetPath;
        
        // Fallback navigation
        setTimeout(() => {
            if (window.location.href.indexOf('gap_analysis_dashboard') === -1) {
                console.warn('Navigation may have failed, trying alternative method');
                window.location.replace(targetPath);
            }
        }, 2000);
        
    } catch (error) {
        console.error('Navigation failed:', error);
        alert(`Navigation failed. Please manually navigate to: ${targetPath}\n\nError: ${error.message}`);
    }
}

// Header navigation functions
function navigateToDashboard() {
    window.location.href = '../Dashboard_Landing_Pages/code.html';
}

function navigateToProjects() {
    window.location.href = '../projects/code.html';
}

function navigateToResources() {
    window.location.href = '../resources/code.html';
}

function navigateToCommunity() {
    window.location.href = '../community/code.html';
}

// Handle page unload
window.addEventListener('beforeunload', function(event) {
    if (isReAnalyzing || isExporting) {
        console.log('Page is being unloaded during processing');
    }
});

// Error handling
window.addEventListener('error', function(event) {
    console.error('Uncaught error:', event.error);
});

console.log('Content Analysis Results script loaded successfully');
</script>

<!-- Add Universal Comment Widget - Expert can click anywhere to add feedback -->
<script>
window.commentWidgetConfig = {
    apiBase: "https://clamshell-backend-e5dmap3xc-mohammed-asrafs-projects.vercel.app",
    position: "top-right"
};
</script>
<script src="./comment-widget-hybrid.js"></script>

<script>
function showBackendError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.id = 'backend-error-overlay';
    errorDiv.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50';
    errorDiv.innerHTML = `
        <div class="bg-red-900 text-white p-8 rounded-lg max-w-2xl">
            <h2 class="text-2xl font-bold mb-4">‚ö†Ô∏è AI Backend Required</h2>
            <p class="mb-4">${message}</p>
            <p class="text-sm opacity-80">Backend must be running at https://clamshell-backend-e5dmap3xc-mohammed-asrafs-projects.vercel.app</p>
            <button onclick="location.reload()" class="mt-4 bg-white text-red-900 px-6 py-2 rounded font-bold">Retry</button>
        </div>
    `;
    document.body.appendChild(errorDiv);
}
</script>

</body></html>