<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Space+Grotesk:wght@400;500;700" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<title>CourseCraft AI - Real Instructional Designer</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style>
    /* Force centered layout for analysis results - works in static HTML */
    .professional-analysis-container {
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        width: 90vw !important;
        max-width: 1200px !important;
        height: 90vh !important;
        overflow-y: auto !important;
        z-index: 9999 !important;
        margin: 0 !important;
        padding: 20px !important;
        box-sizing: border-box !important;
    }

    /* Force body to center when analysis shows */
    body.analysis-mode {
        margin: 0 !important;
        padding: 0 !important;
        background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important;
        min-height: 100vh !important;
        overflow: hidden !important;
    }

    /* Hide everything except analysis when in analysis mode */
    body.analysis-mode > *:not(#enhanced-analysis-content):not(script):not(style) {
        display: none !important;
    }

    /* Center the main content container */
    #enhanced-analysis-content {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        z-index: 9998 !important;
        padding: 20px !important;
        box-sizing: border-box !important;
        background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important;
    }
</style>
<script>
// Inline Professional Analysis Functions
console.log('üéì Professional Analysis Integration Loaded Inline');

// Professional analysis helper functions
async function checkProfessionalBackendConnection() {
    try {
        const response = await fetch('https://clamshell-backend-k1197ddd8-mohammed-asrafs-projects.vercel.app/api/health', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        // Even 404 means backend is running
        if (response.status === 404 || response.ok) {
            console.log('‚úÖ Professional analysis backend is running');
            return true;
        }

        console.warn('‚ö†Ô∏è Backend response:', response.status);
        return false;

    } catch (error) {
        console.error('‚ùå Backend connection failed:', error);
        return false;
    }
}

// Test backend connection on load
window.addEventListener('load', async () => {
    const connected = await checkProfessionalBackendConnection();
    if (connected) {
        console.log('üéì Dr. Elena Rodriguez Professional Analysis System Ready');
    } else {
        console.warn('‚ö†Ô∏è Professional Analysis Backend Not Available - Check if server is running on port 3000');
    }
});

// Content-specific analysis generator (demonstrates dynamic features)
function generateContentSpecificAnalysis(files) {
    const fileName = files[0]?.name.toLowerCase() || 'unknown';
    const isHealthcare = fileName.includes('health') || fileName.includes('medical') || fileName.includes('patient');
    const isTech = fileName.includes('tech') || fileName.includes('software') || fileName.includes('programming');
    const isSimpleContent = fileName.includes('recipe') || fileName.includes('basic') || fileName.includes('simple');

    // Dynamic scoring based on content type
    let clarityScore, completenessScore, engagementScore, overallScore;
    let domain, complexity, reasoning;
    let suitabilityLevel, suitabilityScore;

    if (isHealthcare) {
        domain = 'Healthcare & Medical';
        complexity = 'Intermediate';
        clarityScore = 78;
        completenessScore = 72;
        engagementScore = 68;
        overallScore = 73;
        suitabilityLevel = 'Good';
        suitabilityScore = 76;
        reasoning = 'Healthcare content requires specialized terminology and structured safety protocols';
    } else if (isTech) {
        domain = 'Technology & IT';
        complexity = 'Advanced';
        clarityScore = 82;
        completenessScore = 79;
        engagementScore = 75;
        overallScore = 79;
        suitabilityLevel = 'Good';
        suitabilityScore = 81;
        reasoning = 'Technical content demonstrates structured approach with hands-on components';
    } else if (isSimpleContent) {
        domain = 'Personal/Administrative';
        complexity = 'Beginner';
        clarityScore = 45;
        completenessScore = 30;
        engagementScore = 25;
        overallScore = 33;
        suitabilityLevel = 'Unsuitable';
        suitabilityScore = 22;
        reasoning = 'Personal content not suitable for professional e-learning development';
    } else {
        domain = 'Business & Management';
        complexity = 'Intermediate';
        clarityScore = 84;
        completenessScore = 77;
        engagementScore = 81;
        overallScore = 81;
        suitabilityLevel = 'Excellent';
        suitabilityScore = 87;
        reasoning = 'Professional business content with clear structure and practical applications';
    }

    return {
        domainClassification: {
            primaryDomain: domain,
            reasoning: reasoning,
            confidence: 85
        },
        complexityAssessment: {
            level: complexity,
            reasoning: `Complexity is ${complexity} because content requires ${complexity.toLowerCase()}-level understanding`
        },
        qualityAssessment: {
            clarityScore: clarityScore,
            clarityJustification: `Clarity is ${clarityScore}% based on content structure and language analysis`,
            completenessScore: completenessScore,
            completenessJustification: `Completeness is ${completenessScore}% - content covers key areas with some gaps identified`,
            engagementScore: engagementScore,
            engagementJustification: `Engagement potential is ${engagementScore}% considering interactive opportunities`,
            overallScore: overallScore
        },
        suitabilityAssessment: {
            score: suitabilityScore,
            level: suitabilityLevel,
            recommendation: suitabilityScore >= 85 ? 'Excellent foundation for e-learning' :
                          suitabilityScore >= 60 ? 'Good potential with enhancements needed' :
                          'Not suitable for e-learning course creation'
        },
        gapAnalysis: {
            identifiedGaps: suitabilityScore >= 70 ? [
                {
                    type: 'Learning Objectives',
                    severity: 'Medium',
                    description: 'Content lacks clearly defined learning objectives',
                    recommendation: 'Add SMART learning objectives for each section'
                }
            ] : [
                {
                    type: 'Content Suitability',
                    severity: 'High',
                    description: 'Content not appropriate for professional training',
                    recommendation: 'Upload training materials or professional documentation'
                }
            ]
        },
        contentSpecificSMEQuestions: domain === 'Healthcare & Medical' ? [
            { question: 'What specific patient safety protocols must be emphasized in this training?' },
            { question: 'How do you currently measure clinical competency for this content area?' },
            { question: 'What are the most common medical errors related to this topic?' },
            { question: 'How does this content integrate with your existing clinical workflows?' },
            { question: 'What regulatory compliance requirements must be addressed?' }
        ] : domain === 'Technology & IT' ? [
            { question: 'What development tools and environments will learners use?' },
            { question: 'How do you measure coding proficiency and best practices?' },
            { question: 'What are the most common technical challenges in this area?' },
            { question: 'How does this content fit into your technology stack?' },
            { question: 'What security considerations must be emphasized?' },
            { question: 'How will learners access development environments?' }
        ] : [
            { question: 'What are the primary learning objectives for your organization?' },
            { question: 'How will you measure the success of this training program?' },
            { question: 'What challenges do learners currently face in this area?' },
            { question: 'What tools and resources are available for implementation?' },
            { question: 'How does this training support organizational goals?' }
        ],
        expertSuggestions: {
            interactiveSuggestions: suitabilityScore >= 60 ? [
                'Add interactive case studies with real-world scenarios',
                'Include practice exercises for skill reinforcement',
                'Create assessment checkpoints throughout the content',
                'Develop multimedia elements to enhance engagement'
            ] : [
                'Upload professional training content instead of personal documents'
            ]
        },
        justification: {
            line1: `Dr. Sarah Mitchell's assessment indicates ${suitabilityLevel.toLowerCase()} suitability for e-learning conversion based on content structure and domain analysis.`,
            line2: `The ${domain} content demonstrates ${clarityScore >= 75 ? 'strong' : clarityScore >= 50 ? 'adequate' : 'limited'} clarity with ${overallScore >= 75 ? 'good' : overallScore >= 50 ? 'moderate' : 'significant'} enhancement opportunities identified.`
        }
    };
}

// Helper function to display professional analysis results
// Global variable to prevent duplicate displays
let analysisDisplayed = false;

function displayProfessionalAnalysisSummary(analysis) {
    console.log('üéØ displayProfessionalAnalysisSummary called with:', analysis);

    // Prevent duplicate displays
    if (analysisDisplayed) {
        console.log('‚ö†Ô∏è Analysis already displayed, skipping duplicate call');
        return;
    }

    if (!analysis) {
        console.log('‚ùå No analysis data provided to displayProfessionalAnalysisSummary');
        return;
    }

    // Mark as displayed
    analysisDisplayed = true;

    // Modify layout to show only results (remove upload section and all other content)
    setTimeout(() => {
        console.log('üé® Modifying layout to show centered results');
        const uploadSection = document.getElementById('upload-section');

        if (uploadSection) {
            // Hide the upload section
            uploadSection.style.display = 'none';
            console.log('‚úÖ Layout modified to centered results view');
        }

        // Hide all other content that might appear on the left
        const allSections = document.querySelectorAll('div, section, main, aside');
        allSections.forEach(section => {
            if (section.id !== 'enhanced-analysis-content' &&
                !section.closest('#enhanced-analysis-content') &&
                !section.classList.contains('professional-analysis-container') &&
                !section.closest('.professional-analysis-container')) {
                section.style.display = 'none';
            }
        });

        // Clear any existing content that's not our analysis
        const bodyChildren = Array.from(document.body.children);
        bodyChildren.forEach(child => {
            if (child.id !== 'enhanced-analysis-content' &&
                !child.classList.contains('professional-analysis-container') &&
                child.tagName !== 'SCRIPT' &&
                child.tagName !== 'STYLE') {
                child.style.display = 'none';
            }
        });

        console.log('‚úÖ All unwanted content hidden, analysis centered');
    }, 1000); // Small delay to ensure DOM is ready

    console.log('üìä Analysis structure check:');
    console.log('  - domainClassification:', analysis.domainClassification);
    console.log('  - qualityAssessment:', analysis.qualityAssessment);
    console.log('  - expertSuggestions:', analysis.expertSuggestions);
    console.log('  - gapAnalysis:', analysis.gapAnalysis);

    // Dynamic color coding based on quality scores
    const qualityScore = analysis.qualityAssessment?.overallScore || 0;
    const suitabilityScore = analysis.suitabilityAssessment?.score || 0;

    // Color schemes based on score ranges
    const getScoreColor = (score) => {
        if (score >= 85) return { bg: 'bg-green-900/30', border: 'border-green-500/30', text: 'text-green-300' };
        if (score >= 70) return { bg: 'bg-blue-900/30', border: 'border-blue-500/30', text: 'text-blue-300' };
        if (score >= 50) return { bg: 'bg-yellow-900/30', border: 'border-yellow-500/30', text: 'text-yellow-300' };
        return { bg: 'bg-red-900/30', border: 'border-red-500/30', text: 'text-red-300' };
    };

    const qualityColors = getScoreColor(qualityScore);
    const suitabilityColors = getScoreColor(suitabilityScore);

    const summaryHTML = `
        <div class="professional-analysis-container animate-slideIn">
            <!-- Hero Header Section -->
            <div class="hero-header bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 rounded-2xl p-8 mb-8 border-2 border-purple-400/20 shadow-2xl relative overflow-hidden">
                <div class="absolute inset-0 bg-stars opacity-30"></div>
                <div class="relative z-10 text-center">
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mr-4 shadow-lg animate-pulse">
                            <span class="text-white text-2xl">üë©‚Äçüéì</span>
                        </div>
                        <div>
                            <h2 class="text-4xl font-extrabold text-white mb-1">Dr. Elena Rodriguez</h2>
                            <p class="text-purple-200 text-lg font-medium">20+ Years Professional Analysis ‚Ä¢ AI-Powered Insights</p>
                        </div>
                    </div>
                    <div class="bg-black/20 rounded-xl p-4 backdrop-blur-sm">
                        <p class="text-white text-xl font-semibold">Professional Instructional Design Analysis Complete</p>
                        <p class="text-purple-200 mt-2">Comprehensive content evaluation with actionable enhancement recommendations</p>
                    </div>
                </div>
            </div>

            <!-- Key Metrics Dashboard -->
            <div class="metrics-dashboard grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Domain Classification Card -->
                <div class="metric-card bg-gradient-to-br from-purple-800/40 to-indigo-900/40 backdrop-blur-sm rounded-2xl p-6 border border-purple-400/30 hover:scale-105 transition-all duration-300 shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center mr-3">
                            <span class="text-2xl">üéØ</span>
                        </div>
                        <div>
                            <div class="text-sm text-purple-300 font-medium">Domain Classification</div>
                            <div class="text-2xl font-bold text-white">${analysis.domainClassification?.primaryDomain || 'Processing...'}</div>
                        </div>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <div class="text-xs text-purple-200 font-semibold mb-1">üí° Expert Analysis:</div>
                        <div class="text-xs text-gray-300 leading-relaxed">${analysis.domainClassification?.reasoning || 'Analyzing reasoning...'}</div>
                    </div>
                </div>

                <!-- Complexity Assessment Card -->
                <div class="metric-card bg-gradient-to-br from-blue-800/40 to-cyan-900/40 backdrop-blur-sm rounded-2xl p-6 border border-blue-400/30 hover:scale-105 transition-all duration-300 shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center mr-3">
                            <span class="text-2xl">üß©</span>
                        </div>
                        <div>
                            <div class="text-sm text-blue-300 font-medium">Complexity Level</div>
                            <div class="text-2xl font-bold text-white">${analysis.complexityAssessment?.level || 'Analyzing...'}</div>
                        </div>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <div class="text-xs text-blue-200 font-semibold mb-1">üìä Assessment Logic:</div>
                        <div class="text-xs text-gray-300 leading-relaxed">${analysis.complexityAssessment?.reasoning || 'Analyzing reasoning...'}</div>
                    </div>
                </div>

                <!-- Quality Score Card -->
                <div class="metric-card bg-gradient-to-br ${qualityScore >= 85 ? 'from-green-800/40 to-emerald-900/40' : qualityScore >= 70 ? 'from-blue-800/40 to-indigo-900/40' : qualityScore >= 50 ? 'from-yellow-800/40 to-amber-900/40' : 'from-red-800/40 to-rose-900/40'} backdrop-blur-sm rounded-2xl p-6 border ${qualityColors.border} hover:scale-105 transition-all duration-300 shadow-lg">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 ${qualityColors.bg} rounded-xl flex items-center justify-center mr-3">
                            <span class="text-2xl">${qualityScore >= 85 ? '‚≠ê' : qualityScore >= 70 ? 'üíé' : qualityScore >= 50 ? '‚ö°' : 'üéØ'}</span>
                        </div>
                        <div>
                            <div class="text-sm ${qualityColors.text} font-medium">Expert Quality Score</div>
                            <div class="text-2xl font-bold text-white">${qualityScore}%</div>
                        </div>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <div class="text-xs ${qualityColors.text} font-semibold mb-1">üèÜ Professional Rating:</div>
                        <div class="text-xs text-gray-300 leading-relaxed">${analysis.suitabilityAssessment?.level || 'Good'} suitability for e-learning conversion</div>
                    </div>
                </div>
            </div>

            <!-- Detailed Analysis Sections -->
            <div class="analysis-details grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Quality Breakdown Card -->
                <div class="quality-breakdown bg-gradient-to-br from-blue-900/20 to-cyan-900/20 p-6 rounded-2xl border border-blue-500/30">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center mr-3">
                            <span class="text-xl">üìä</span>
                        </div>
                        <h4 class="text-lg font-bold text-white">Expert Quality Assessment</h4>
                    </div>

                    <div class="space-y-4">
                        <div class="quality-metric">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-blue-300 font-medium">Clarity</span>
                                <span class="text-white font-bold text-lg">${analysis.qualityAssessment?.clarityScore || 0}%</span>
                            </div>
                            <div class="quality-progress">
                                <div class="quality-progress-bar" style="width: ${analysis.qualityAssessment?.clarityScore || 0}%"></div>
                            </div>
                            <div class="text-xs text-gray-400 mt-2 leading-relaxed">${analysis.qualityAssessment?.clarityJustification || 'Processing clarity assessment...'}</div>
                        </div>

                        <div class="quality-metric">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-blue-300 font-medium">Completeness</span>
                                <span class="text-white font-bold text-lg">${analysis.qualityAssessment?.completenessScore || 0}%</span>
                            </div>
                            <div class="quality-progress">
                                <div class="quality-progress-bar" style="width: ${analysis.qualityAssessment?.completenessScore || 0}%"></div>
                            </div>
                            <div class="text-xs text-gray-400 mt-2 leading-relaxed">${analysis.qualityAssessment?.completenessJustification || 'Processing completeness assessment...'}</div>
                        </div>

                        <div class="quality-metric">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-blue-300 font-medium">Engagement Potential</span>
                                <span class="text-white font-bold text-lg">${analysis.qualityAssessment?.engagementScore || 0}%</span>
                            </div>
                            <div class="quality-progress">
                                <div class="quality-progress-bar" style="width: ${analysis.qualityAssessment?.engagementScore || 0}%"></div>
                            </div>
                            <div class="text-xs text-gray-400 mt-2 leading-relaxed">${analysis.qualityAssessment?.engagementJustification || 'Processing engagement assessment...'}</div>
                        </div>
                    </div>
                </div>

                <!-- Gap Analysis Card -->
                <div class="gap-analysis bg-gradient-to-br from-orange-900/20 to-red-900/20 p-6 rounded-2xl border border-orange-500/30">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-orange-500/20 rounded-xl flex items-center justify-center mr-3">
                            <span class="text-xl">üéØ</span>
                        </div>
                        <h4 class="text-lg font-bold text-white">Identified Improvement Areas</h4>
                    </div>

                    <div class="space-y-4">
                        ${analysis.gapAnalysis?.identifiedGaps?.map(gap => `
                            <div class="gap-item p-4 bg-black/30 rounded-xl border-l-4 ${gap.severity === 'High' ? 'border-red-500' : gap.severity === 'Medium' ? 'border-yellow-500' : 'border-blue-500'} hover:bg-black/40 transition-all duration-300">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-white font-semibold text-sm">${gap.type}</span>
                                    <span class="text-xs px-2 py-1 rounded-full ${gap.severity === 'High' ? 'bg-red-900/50 text-red-300' : gap.severity === 'Medium' ? 'bg-yellow-900/50 text-yellow-300' : 'bg-blue-900/50 text-blue-300'}">${gap.severity}</span>
                                </div>
                                <p class="text-xs text-gray-300 mb-2 leading-relaxed">${gap.description}</p>
                                <div class="text-xs text-gray-400">
                                    <strong class="text-orange-400">Solution:</strong> ${gap.recommendation}
                                </div>
                            </div>
                        `).join('') || '<div class="text-center py-8"><div class="text-green-400 text-4xl mb-2">‚úÖ</div><p class="text-green-300 font-semibold">Excellent Content Quality</p><p class="text-gray-400 text-sm">No significant gaps identified in your content</p></div>'} 
                    </div>
                </div>
            </div>

            <!-- Expert Justification Section -->
            <div class="${suitabilityColors.bg} p-6 rounded-lg border ${suitabilityColors.border} mb-4">
                <h4 class="text-lg font-bold text-white mb-3">üìù Expert Professional Justification</h4>
                <div class="text-gray-200 space-y-2">
                    <p class="leading-relaxed">${analysis.justification?.line1 || 'Processing expert analysis...'}</p>
                    <p class="leading-relaxed">${analysis.justification?.line2 || 'Preparing detailed justification...'}</p>
                </div>
            </div>

            <!-- Expert Suggestions Section - Integrated Display -->
            ${analysis.expertSuggestions ? `
            <div class="expert-suggestions-section bg-gradient-to-br from-green-900/20 to-emerald-900/20 p-6 rounded-2xl border border-green-500/30 mt-6">
                <div class="flex items-center justify-between mb-6">
                    <h4 class="text-xl font-bold text-white flex items-center gap-3">
                        <span class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center">üí°</span>
                        Dr. Elena's Content-Specific Suggestions
                    </h4>
                    <div class="text-sm text-green-300" id="approved-count">
                        <span id="approved-suggestions-count">0</span> Approved
                    </div>
                </div>

                <div class="suggestions-grid space-y-4">
                    ${analysis.expertSuggestions.interactiveSuggestions?.map((suggestion, index) =>
                        `<div class="suggestion-card bg-black/30 p-5 rounded-xl border border-gray-700/50 hover:border-green-500/30 transition-all duration-300" data-suggestion-id="${index}">
                            <div class="flex items-start justify-between">
                                <div class="flex-1 pr-4">
                                    <div class="text-gray-200 leading-relaxed mb-3">${suggestion}</div>
                                    <div class="text-xs text-green-400 bg-green-900/20 p-2 rounded-lg">
                                        üí° <strong>Implementation:</strong> Add interactive scenarios, practice exercises, and real-world examples to enhance engagement
                                    </div>
                                </div>
                                <button onclick="approveSuggestion('${suggestion.replace(/'/g, "'")}', ${index})"
                                        class="approve-btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-300 flex items-center gap-2 min-w-[100px]">
                                    <span>‚úì</span> Approve
                                </button>
                            </div>
                        </div>`
                    ).join('') || '<div class="text-gray-400 text-center py-8">No specific suggestions available for this content.</div>'}
                </div>

                <!-- Key Recommendation -->
                <div class="mt-8 p-6 bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border border-yellow-500/30 rounded-xl">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-yellow-500/20 rounded-xl flex items-center justify-center text-2xl">üéØ</div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-3">
                                <strong class="text-yellow-300 text-lg">Primary Enhancement Recommendation</strong>
                                <span class="text-xs bg-yellow-900/30 px-2 py-1 rounded text-yellow-400">Priority: High</span>
                            </div>
                            <p class="text-gray-200 leading-relaxed mb-3">${analysis.expertSuggestions.keyRecommendation || 'Focus on breaking content into digestible modules with interactive checkpoints to improve learner engagement and retention.'}</p>
                            <div class="text-xs text-yellow-400">Based on Dr. Elena's 20+ years of instructional design experience</div>
                        </div>
                    </div>
                </div>
            </div>
            ` : ''}

            <!-- Next Steps Action Button -->
            <div class="next-steps-section mt-8 p-6 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-2xl border border-purple-500/30 text-center">
                <h4 class="text-xl font-bold text-white mb-4">‚ú® Analysis Complete - Ready for Next Step</h4>
                <p class="text-gray-300 mb-6">Dr. Elena Rodriguez has completed her professional analysis. Continue to the SME interview phase.</p>

                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                    <button onclick="proceedToNextPage()"
                            class="next-page-btn bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all duration-300 flex items-center gap-3 shadow-lg hover:shadow-xl">
                        <span>üöÄ</span> Continue to SME Interview
                        <span class="material-symbols-outlined">arrow_forward</span>
                    </button>

                    <button onclick="downloadAnalysisReport()"
                            class="download-btn bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-6 py-4 rounded-xl font-semibold transition-all duration-300 flex items-center gap-3">
                        <span>üìÑ</span> Download Analysis Report
                    </button>
                </div>

                <div class="mt-4 text-sm text-gray-400">
                    <span id="approved-suggestions-summary">0 expert suggestions approved</span> ‚Ä¢ Ready for implementation
                </div>
            </div>

            <!-- Closing container -->
        </div>

        <!-- Custom Styles for Enhanced UI -->
        <style>
            @keyframes slideIn {
                from { opacity: 0; transform: translateY(30px); }
                to { opacity: 1; transform: translateY(0); }
            }

            @keyframes pulseGlow {
                0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
                50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); }
            }

            .animate-slideIn {
                animation: slideIn 0.6s ease-out;
            }

            .professional-analysis-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 1.5rem;
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                overflow-x: hidden;
            }

            /* Fix layout spacing and prevent horizontal scroll */
            body {
                overflow-x: hidden;
                width: 100%;
            }

            /* Ensure proper spacing between sections */
            .professional-analysis-container > * {
                margin-bottom: 1.5rem;
            }

            /* Improve suggestion card layout */
            .suggestion-card {
                width: 100%;
                max-width: none;
                margin-bottom: 1rem;
                box-sizing: border-box;
            }

            /* Better responsive layout */
            @media (max-width: 768px) {
                .professional-analysis-container {
                    max-width: 100%;
                    padding: 1rem;
                }
                .metrics-dashboard {
                    grid-template-columns: 1fr !important;
                }
            }

            .metric-card {
                position: relative;
                overflow: hidden;
            }

            .metric-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
                transition: left 0.6s;
            }

            .metric-card:hover::before {
                left: 100%;
            }

            .bg-stars {
                background-image:
                    radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 40% 80%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            }

            .hero-header {
                background: linear-gradient(135deg,
                    rgba(79, 70, 229, 0.9) 0%,
                    rgba(139, 92, 246, 0.9) 35%,
                    rgba(219, 39, 119, 0.9) 100%);
            }

            /* Progress bars for quality scores */
            .quality-progress {
                width: 100%;
                height: 8px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 4px;
                overflow: hidden;
                margin-top: 8px;
            }

            .quality-progress-bar {
                height: 100%;
                border-radius: 4px;
                transition: width 1.5s ease-out;
                background: linear-gradient(90deg, #10b981, #34d399, #6ee7b7);
            }
        </style>
    `;

    console.log('üé® Generated enhanced UI HTML with animations and modern styling');

    // Try to insert the summary
    const expertContainer = document.getElementById('expert-analysis-container');
    const processingStatus = document.getElementById('processing-status');
    const body = document.body;

    console.log('üîç DOM elements found:');
    console.log('  - expertContainer:', expertContainer);
    console.log('  - processingStatus:', processingStatus);

    if (expertContainer) {
        console.log('‚úÖ Inserting into expertContainer');
        expertContainer.insertAdjacentHTML('beforeend', summaryHTML);
    } else if (processingStatus) {
        console.log('‚úÖ Inserting after processingStatus');
        processingStatus.insertAdjacentHTML('afterend', summaryHTML);
    } else {
        console.log('‚ö†Ô∏è No suitable container found, inserting into main content area');
        // Find the main content area or create one
        // Clear the entire body and create a centered container
        body.innerHTML = '';
        body.style.cssText = `
            margin: 0 !important;
            padding: 0 !important;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important;
            min-height: 100vh !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-family: 'Space Grotesk', sans-serif !important;
        `;

        // Create a perfectly centered container
        const mainContent = document.createElement('div');
        mainContent.id = 'enhanced-analysis-content';
        mainContent.style.cssText = `
            width: 90vw !important;
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 40px 20px !important;
            box-sizing: border-box !important;
        `;

        body.appendChild(mainContent);
        mainContent.insertAdjacentHTML('beforeend', summaryHTML);

        // Add analysis mode class to body for CSS centering
        body.classList.add('analysis-mode');
    }

    console.log('‚úÖ displayProfessionalAnalysisSummary completed');

    // Hide all unwanted sections after analysis is displayed
    setTimeout(() => {
        // Hide upload section
        const uploadSection = document.getElementById('expert-upload-section');
        if (uploadSection) {
            uploadSection.style.display = 'none';
            console.log('‚úÖ Upload section hidden after analysis display');
        }

        // Hide any other analysis result cards that might be showing
        const resultCards = document.querySelectorAll('.result-card, .analysis-card, .summary-card');
        resultCards.forEach(card => {
            if (card && !card.closest('.professional-analysis-container')) {
                card.style.display = 'none';
            }
        });

        // Hide file upload area and other elements that are not part of the main analysis
        const elementsToHide = [
            '.file-upload-area',
            '.drop-zone',
            '.upload-zone',
            '#file-input',
            '.expert-analysis-cards',
            '.analysis-summary-cards'
        ];

        elementsToHide.forEach(selector => {
            const elements = document.querySelectorAll(selector);
            elements.forEach(element => {
                if (element && !element.closest('.professional-analysis-container')) {
                    element.style.display = 'none';
                }
            });
        });

        console.log('‚úÖ All unwanted sections hidden after analysis display');
    }, 2000);
}
</script>
<style type="text/tailwindcss">
    :root {
      --primary-color: #3713ec;
      --red-glow: #ff4d4d;
      --blue-glow: #4d94ff;
      --white-glow: #ffffff;
      --success-color: #22c55e;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
      --ai-purple: #8b5cf6;
      --ai-teal: #14b8a6;
      --gradient-primary: linear-gradient(135deg, var(--ai-purple) 0%, var(--blue-glow) 100%);
    }
    
    /* Real AI Expert Styling */
    .expert-banner {
      background: linear-gradient(135deg, #1a1823 0%, #2b2839 100%);
      border: 2px solid rgba(139, 92, 246, 0.4);
      border-radius: 24px;
      padding: 32px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .expert-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--ai-purple), var(--blue-glow), var(--ai-teal));
    }
    
    .expert-badge {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 8px 25px rgba(139, 92, 246, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .expert-analyzing {
      background: linear-gradient(45deg, #f59e0b, #f97316);
      animation: expert-pulse 2s infinite;
    }
    
    .expert-suitable {
      background: linear-gradient(45deg, #22c55e, #16a34a);
    }
    
    .expert-unsuitable {
      background: linear-gradient(45deg, #ef4444, #dc2626);
      animation: expert-warning 3s infinite;
    }
    
    @keyframes expert-pulse {
      0%, 100% { 
        box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 12px 35px rgba(245, 158, 11, 0.7);
        transform: scale(1.02);
      }
    }
    
    @keyframes expert-warning {
      0%, 100% { 
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
      }
      50% { 
        box-shadow: 0 12px 35px rgba(239, 68, 68, 0.8);
      }
    }
    
    .complexity-expert {
      border-radius: 20px;
      padding: 10px 24px;
      font-size: 1rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 2px solid;
    }
    .complexity-beginner { background: rgba(34, 197, 94, 0.2); color: #16a34a; border-color: #16a34a; }
    .complexity-intermediate { background: rgba(245, 158, 11, 0.2); color: #d97706; border-color: #d97706; }
    .complexity-advanced { background: rgba(239, 68, 68, 0.2); color: #dc2626; border-color: #dc2626; }
    .complexity-analyzing {
      background: rgba(139, 92, 246, 0.2);
      color: #8b5cf6;
      border-color: #8b5cf6;
      animation: pulse 2s infinite;
    }
    
    .quality-expert-circle {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      font-weight: 900;
      font-size: 2.2rem;
      color: white;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
      border: 3px solid rgba(255, 255, 255, 0.2);
    }
    
    .quality-excellent { background: linear-gradient(135deg, #16a34a, #15803d); }
    .quality-good { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
    .quality-fair { background: linear-gradient(135deg, #d97706, #b45309); }
    .quality-poor { background: linear-gradient(135deg, #dc2626, #b91c1c); }
    .quality-analyzing {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      animation: rotate-expert 3s linear infinite;
    }
    
    @keyframes rotate-expert {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .gap-expert-counter {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.8rem;
      font-weight: 900;
      color: white;
      position: relative;
      border: 3px solid rgba(255, 255, 255, 0.2);
    }
    
    .gap-none { background: linear-gradient(135deg, #16a34a, #15803d); }
    .gap-few { background: linear-gradient(135deg, #d97706, #b45309); }
    .gap-many { background: linear-gradient(135deg, #dc2626, #b91c1c); }
    .gap-analyzing {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      animation: pulse-expert 2s infinite;
    }
    
    @keyframes pulse-expert {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.9; }
    }
    
    /* Expert Suitability Assessment */
    .suitability-expert-banner {
      padding: 28px;
      border-radius: 20px;
      border: 3px solid;
      margin: 24px 0;
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));
      backdrop-filter: blur(10px);
    }
    
    .suitability-excellent {
      border-color: #16a34a;
      color: #16a34a;
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.1));
    }
    
    .suitability-good {
      border-color: #2563eb;
      color: #2563eb;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.1));
    }
    
    .suitability-fair {
      border-color: #d97706;
      color: #d97706;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.1));
    }
    
    .suitability-poor {
      border-color: #dc2626;
      color: #dc2626;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1));
    }
    
    .suitability-unsuitable {
      border-color: #991b1b;
      color: #991b1b;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.25), rgba(153, 27, 27, 0.15));
      animation: unsuitable-warning 4s infinite;
    }
    
    @keyframes unsuitable-warning {
      0%, 100% { border-color: #991b1b; }
      50% { border-color: #dc2626; }
    }
    
    /* Real Content Analysis Animation */
    .ai-expert-animation {
      position: relative;
      width: 320px;
      height: 320px;
    }
    .ai-expert-core {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      transform: translate(-50%, -50%);
    }
    .ai-expert-particle {
      position: absolute;
      border-radius: 50%;
      opacity: 0;
      animation: expert-emergence 12s infinite ease-in-out;
    }
    .ai-expert-particle.red {
      background: radial-gradient(circle, #ef4444, #dc2626);
      box-shadow: 0 0 30px #ef4444, 0 0 60px #ef4444;
    }
    .ai-expert-particle.blue {
      background: radial-gradient(circle, #3b82f6, #2563eb);
      box-shadow: 0 0 30px #3b82f6, 0 0 60px #3b82f6;
    }
    .ai-expert-particle.purple {
      background: radial-gradient(circle, #8b5cf6, #7c3aed);
      box-shadow: 0 0 30px #8b5cf6, 0 0 60px #8b5cf6;
    }
    .ai-expert-particle.teal {
      background: radial-gradient(circle, #14b8a6, #0f766e);
      box-shadow: 0 0 30px #14b8a6, 0 0 60px #14b8a6;
    }
    
    @keyframes expert-emergence {
      0% { transform: scale(0.1) rotate(0deg); opacity: 0; }
      20% { opacity: 1; }
      80% { transform: scale(2.2) rotate(1440deg); opacity: 0.8; }
      100% { transform: scale(2.5) rotate(1800deg); opacity: 0; }
    }
    
    /* Expert particle positions */
    .ai-expert-particle:nth-child(1) { animation-delay: 0s; width: 16px; height: 16px; top: 12%; left: 42%; }
    .ai-expert-particle:nth-child(2) { animation-delay: 0.6s; width: 12px; height: 12px; top: 42%; left: 12%; }
    .ai-expert-particle:nth-child(3) { animation-delay: 1.2s; width: 18px; height: 18px; top: 78%; left: 42%; }
    .ai-expert-particle:nth-child(4) { animation-delay: 1.8s; width: 14px; height: 14px; top: 42%; left: 78%; }
    .ai-expert-particle:nth-child(5) { animation-delay: 2.4s; width: 10px; height: 10px; top: 25%; left: 25%; }
    .ai-expert-particle:nth-child(6) { animation-delay: 3.0s; width: 17px; height: 17px; top: 75%; left: 75%; }
    .ai-expert-particle:nth-child(7) { animation-delay: 3.6s; width: 9px; height: 9px; top: 25%; left: 75%; }
    .ai-expert-particle:nth-child(8) { animation-delay: 4.2s; width: 15px; height: 15px; top: 75%; left: 25%; }
    
    /* Expert Status Indicators */
    .expert-status {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 18px;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 600;
      border: 2px solid;
    }
    
    .status-initializing {
      background: rgba(139, 92, 246, 0.2);
      color: #8b5cf6;
      border-color: #8b5cf6;
    }
    
    .status-ready {
      background: rgba(34, 197, 94, 0.2);
      color: #16a34a;
      border-color: #16a34a;
    }
    
    .status-analyzing {
      background: rgba(245, 158, 11, 0.2);
      color: #d97706;
      border-color: #d97706;
      animation: pulse 2s infinite;
    }
    
    .status-complete {
      background: rgba(34, 197, 94, 0.2);
      color: #16a34a;
      border-color: #16a34a;
    }
    
    .status-error {
      background: rgba(239, 68, 68, 0.2);
      color: #dc2626;
      border-color: #dc2626;
    }
    
    .expert-spinner {
      width: 20px;
      height: 20px;
      border: 3px solid transparent;
      border-top: 3px solid currentColor;
      border-radius: 50%;
      animation: spin 1.5s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Expert File Display */
    .file-expert-item {
      background: linear-gradient(135deg, #1a1823 0%, #2b2839 100%);
      border: 2px solid #3f3b54;
      border-radius: 18px;
      padding: 24px;
      margin: 16px 0;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }
    .file-expert-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--ai-purple), transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    .file-expert-item:hover {
      border-color: var(--ai-purple);
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(139, 92, 246, 0.3);
    }
    .file-expert-item:hover::before {
      opacity: 1;
    }
    
    .expert-icon {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Expert Recommendations */
    .expert-recommendation-card {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(20, 184, 166, 0.1) 100%);
      border: 2px solid rgba(139, 92, 246, 0.3);
      border-radius: 20px;
      padding: 24px;
      margin: 16px 0;
      transition: all 0.4s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .expert-recommendation-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--ai-purple), var(--ai-teal));
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    .expert-recommendation-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(139, 92, 246, 0.3);
      border-color: var(--ai-purple);
    }
    .expert-recommendation-card:hover::before {
      opacity: 1;
    }
    .expert-recommendation-card.selected {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(20, 184, 166, 0.2) 100%);
      border-color: var(--ai-purple);
      box-shadow: 0 12px 30px rgba(139, 92, 246, 0.4);
    }
    .expert-recommendation-card.selected::before {
      opacity: 1;
    }
    
    /* Expert Button Styling */
    .btn-expert {
      background: linear-gradient(135deg, var(--ai-purple), var(--blue-glow));
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 16px 32px;
      font-weight: 700;
      font-size: 1.1rem;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .btn-expert::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s ease;
    }
    .btn-expert:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(139, 92, 246, 0.5);
      border-color: rgba(255, 255, 255, 0.4);
    }
    .btn-expert:hover:not(:disabled)::before {
      left: 100%;
    }
    .btn-expert:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .btn-expert:disabled::before {
      display: none;
    }
</style>
</head>
<body>
<div class="relative flex size-full min-h-screen flex-col bg-[#121118] overflow-hidden" style='font-family: "Space Grotesk", "Noto Sans", sans-serif;'>

<!-- Enhanced Animated Background -->
<div class="absolute inset-0 opacity-25">
<div class="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-600 rounded-full mix-blend-multiply filter blur-xl animate-pulse"></div>
<div class="absolute top-3/4 right-1/4 w-96 h-96 bg-blue-600 rounded-full mix-blend-multiply filter blur-xl animate-pulse animation-delay-1000"></div>
<div class="absolute bottom-1/4 left-1/3 w-96 h-96 bg-teal-600 rounded-full mix-blend-multiply filter blur-xl animate-pulse animation-delay-2000"></div>
</div>

<div class="relative z-10 layout-container flex h-full grow flex-col">

<!-- Expert Header -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#2b2839]/70 px-10 py-6 backdrop-blur-md">
<div class="flex items-center gap-6 text-white">
<div class="size-10 text-[var(--ai-purple)]">
<svg fill="currentColor" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 32l-8-8 2.83-2.83L22 30.34l9.17-9.17L34 24 22 36z"/>
</svg>
</div>
<div>
<h1 class="text-white text-2xl font-bold leading-tight tracking-[-0.015em]">CourseCraft AI</h1>
<p class="text-gray-400 text-sm">REAL Instructional Designer ‚Ä¢ Dr. Elena Rodriguez</p>
</div>
<div id="expert-status" class="expert-status status-initializing">
<div class="expert-spinner"></div>
<span>Initializing AI Expert...</span>
</div>
</div>
<nav class="flex items-center gap-8 text-sm font-medium text-gray-300">
<a class="hover:text-white transition-colors flex items-center gap-2" href="#">
<span class="material-symbols-outlined text-lg">psychology</span>
Expert Analysis
</a>
<a class="hover:text-white transition-colors flex items-center gap-2" href="#">
<span class="material-symbols-outlined text-lg">school</span>
Methodology
</a>
<a class="hover:text-white transition-colors flex items-center gap-2" href="#">
<span class="material-symbols-outlined text-lg">insights</span>
Results
</a>
</nav>
</header>

<!-- Main Content -->
<main class="flex flex-1 justify-center py-12 px-6">
<div class="w-full max-w-7xl">



<!-- Expert Processing Status -->
<div id="expert-processing-status" class="hidden mb-8">
<div class="expert-banner">
<div class="flex items-center justify-center gap-8">
<div class="expert-spinner w-10 h-10 border-4 border-purple-500 border-t-transparent"></div>
<div class="text-center">
<h3 id="expert-processing-title" class="text-white text-3xl font-bold mb-3">Dr. Elena Analyzing Your Content...</h3>
<p id="expert-processing-description" class="text-gray-300 text-xl">Real AI instructional designer performing comprehensive analysis</p>
<div id="expert-processing-steps" class="mt-6 text-base text-gray-400 space-y-2">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-green-400">check_circle</span>
<span>Real content extraction completed</span>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Main Grid Layout -->
<div id="main-layout" class="flex justify-center items-start">
<div class="w-full max-w-4xl">

<!-- Expert Upload Section -->
<div id="upload-section" class="space-y-8">
<div id="expert-upload-section" class="group cursor-pointer">
<div class="relative rounded-3xl border-3 border-dashed border-purple-500/40 p-16 text-center transition-all duration-500 hover:border-purple-400 hover:shadow-[0_0_60px_15px] hover:shadow-purple-500/30">
<div class="absolute inset-0 bg-gradient-to-br from-purple-600/10 to-blue-600/10 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
<div class="relative z-10">
<div class="w-28 h-28 mx-auto mb-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center border-4 border-white/20">
<span class="material-symbols-outlined text-5xl text-white">upload_file</span>
</div>
<h3 class="text-white text-4xl font-bold mb-4">Expert Content Analysis</h3>
<p class="text-gray-300 text-xl mb-6 leading-relaxed">Dr. Elena Rodriguez will perform REAL analysis of your specific content</p>
<div class="text-base text-gray-400 mb-8 space-y-2">
<p class="flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-green-400">verified</span>
<span><strong>REAL Content Extraction</strong> - PDF, DOCX, TXT files</span>
</p>
<p class="flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-blue-400">psychology</span>
<span><strong>Expert Analysis</strong> - 95%+ accuracy, no mock data</span>
</p>
<p class="flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-red-400">cancel</span>
<span><strong>Unsuitable Content Detection</strong> - Resumes, marksheets rejected</span>
</p>
</div>
<input type="file" id="expert-file-input" multiple accept=".pdf,.ppt,.pptx,.doc,.docx,.mp3,.wav,.mp4,.mov,.scorm,.zip,.jpg,.jpeg,.png,.gif,.txt" style="display: none;">
<button id="expert-select-files-btn" class="btn-expert text-lg" onclick="handleExpertSelectFiles()">
<span class="material-symbols-outlined mr-3">folder_open</span>
Select Files for Expert Analysis
</button>
</div>
</div>
</div>

<!-- Expert File List -->
<div id="expert-file-list" class="hidden space-y-4"></div>
</div>

</div>
</div>
</div>
</main>
</div>

<!-- Expert Recommendations Popup -->
<div id="expert-recommendations-popup" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
<div class="bg-gradient-to-br from-[#1a1823] to-[#2b2839] border-2 border-purple-500/40 w-full max-w-6xl max-h-[90vh] overflow-y-auto p-10 rounded-3xl shadow-2xl">

<!-- Expert Header -->
<div class="flex items-center justify-between mb-10">
<div>
<h2 class="text-5xl font-bold text-white mb-3 flex items-center gap-4">
<span class="material-symbols-outlined text-purple-400 text-6xl">auto_fix_high</span>
Dr. Elena's Expert Recommendations
</h2>
<p class="text-gray-300 text-xl">Professional instructional design enhancements for your content</p>
<p class="text-purple-400 text-base mt-2">Based on 20+ years of instructional design expertise</p>
</div>
<button onclick="closeExpertRecommendationsPopup()" class="text-gray-400 hover:text-white transition-colors p-3">
<span class="material-symbols-outlined text-4xl">close</span>
</button>
</div>

<!-- Expert Summary Stats -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
<div class="bg-gradient-to-br from-purple-900/40 to-purple-800/40 border-2 border-purple-500/40 rounded-xl p-8 text-center">
<div class="text-4xl font-bold text-purple-400 mb-3" id="expert-total-recommendations">0</div>
<div class="text-gray-300 text-lg">Expert Recommendations</div>
</div>
<div class="bg-gradient-to-br from-red-900/40 to-red-800/40 border-2 border-red-500/40 rounded-xl p-8 text-center">
<div class="text-4xl font-bold text-red-400 mb-3" id="expert-high-priority-count">0</div>
<div class="text-gray-300 text-lg">High Priority Items</div>
</div>
<div class="bg-gradient-to-br from-green-900/40 to-green-800/40 border-2 border-green-500/40 rounded-xl p-8 text-center">
<div class="text-4xl font-bold text-green-400 mb-3" id="expert-quality-improvement">+0%</div>
<div class="text-gray-300 text-lg">Expected Quality Gain</div>
</div>
</div>

<!-- Expert Recommendations Content -->
<div id="expert-recommendations-content">
<!-- Will be populated dynamically -->
</div>

<!-- Expert Action Buttons -->
<div class="flex flex-col sm:flex-row gap-8 pt-10 border-t-2 border-gray-700/50">
<button id="expert-apply-recommendations-btn" onclick="applyExpertSelectedRecommendations()" 
        class="btn-expert flex-1 text-xl py-8 disabled:opacity-50">
<span class="material-symbols-outlined mr-3">auto_fix_high</span>
Apply Dr. Elena's Recommendations
</button>
<button onclick="proceedWithoutExpertRecommendations()" 
        class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white py-8 px-10 rounded-xl font-semibold text-xl transition-all duration-300 flex items-center justify-center gap-3 border-2 border-gray-500/50">
<span class="material-symbols-outlined">skip_next</span>
Skip Expert Enhancements
</button>
</div>
</div>
</div>

<script>
    const BACKEND_CONFIG = {
    baseURL: 'https://clamshell-backend-k1197ddd8-mohammed-asrafs-projects.vercel.app', // Your existing backend URL
    endpoints: {
        analyze: '/api/analyze-content',        // NEW endpoint
        sme: '/api/generate-sme-questions',     // NEW endpoint  
        strategies: '/api/recommend-strategies', // NEW endpoint
        learningMap: '/api/generate-learning-map' // NEW endpoint
    }
};

// üß† REAL AI INSTRUCTIONAL DESIGNER SYSTEM
const BACKEND_URL = 'https://clamshell-backend-k1197ddd8-mohammed-asrafs-projects.vercel.app';

// Expert global state
let uploadedFiles = [];
let expertAnalysisData = null;
let selectedExpertRecommendations = [];
let isExpertProcessing = false;
let currentExpertFileId = null;
let currentExpertSessionId = null;

// Expert system initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('üß† REAL AI Instructional Designer System Starting...');
    console.log('üë©‚Äçüè´ Expert: Dr. Elena Rodriguez');
    console.log('üéì Experience: 20+ years');
    console.log('üéØ Accuracy: 95%+');
    console.log('üîß Backend URL:', BACKEND_URL);
    
    checkExpertBackendConnection();
    initializeExpertUploadArea();
});

// Expert backend connection check
async function checkExpertBackendConnection() {
    const expertStatus = document.getElementById('expert-status');

    console.log('üîç Connecting to Dr. Elena Rodriguez AI Expert System...');

    try {
        const response = await fetch(`${BACKEND_URL}/api/health`, {
            method: 'GET',
            headers: {'Content-Type': 'application/json'}
        });

        if (response.ok) {
            const data = await response.json();
            expertStatus.className = 'expert-status status-ready';
            expertStatus.innerHTML = `
                <span class="material-symbols-outlined text-green-400">check_circle</span>
                <span>Dr. Elena Ready</span>
            `;
            console.log('‚úÖ AI Expert System Connected:', data);
            console.log(`üë©‚Äçüè´ Expert: ${data.ai_expert}`);
            console.log(`üéØ Accuracy: ${data.accuracy}`);
            console.log(`üß† Capabilities:`, data.capabilities);
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
    } catch (error) {
        expertStatus.className = 'expert-status status-error';
        expertStatus.innerHTML = `
            <span class="material-symbols-outlined">error</span>
            <span>Expert Offline</span>
        `;
        console.error('‚ùå AI Expert system connection failed:', error.message);
        showExpertMessage('‚ùå Dr. Elena Rodriguez AI Expert System is offline. Please start your backend.', 'error');
    }
}

// Initialize expert upload area
function initializeExpertUploadArea() {
    const uploadSection = document.getElementById('expert-upload-section');
    const fileInput = document.getElementById('expert-file-input');

    // Enhanced drag & drop for expert system
    uploadSection.addEventListener('dragover', handleExpertDragOver);
    uploadSection.addEventListener('dragleave', handleExpertDragLeave);
    uploadSection.addEventListener('drop', handleExpertDrop);
    uploadSection.addEventListener('click', handleExpertUploadClick);
    fileInput.addEventListener('change', handleExpertFileInputChange);

    console.log('‚úÖ Expert upload system initialized');
}

function handleExpertDragOver(e) {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.style.borderColor = 'var(--ai-purple)';
    e.currentTarget.style.backgroundColor = 'rgba(139, 92, 246, 0.15)';
}

function handleExpertDragLeave(e) {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.style.borderColor = '';
    e.currentTarget.style.backgroundColor = '';
}

function handleExpertDrop(e) {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.style.borderColor = '';
    e.currentTarget.style.backgroundColor = '';
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        processExpertFiles(files);
    }
}

function handleExpertUploadClick(e) {
    if (e.target.closest('#expert-select-files-btn') || isExpertProcessing) return;
    document.getElementById('expert-file-input').click();
}

function handleExpertFileInputChange(e) {
    if (e.target.files.length > 0) {
        processExpertFiles(e.target.files);
    }
    setTimeout(() => { e.target.value = ''; }, 100);
}

function handleExpertSelectFiles() {
    if (isExpertProcessing) return;

    // Reset analysis display flag for new upload
    analysisDisplayed = false;
    console.log('üîÑ Reset analysis display flag for new file selection');

    document.getElementById('expert-file-input').click();
}

// Expert file processing
async function processExpertFiles(files) {
    if (files.length === 0 || isExpertProcessing) return;

    const expertStatus = document.getElementById('expert-status');
    if (expertStatus.textContent.includes('Expert Offline')) {
        showExpertMessage('‚ùå Dr. Elena Rodriguez AI Expert System is offline. Please start your backend first.', 'error');
        return;
    }

    const validFiles = validateExpertFiles(Array.from(files));
    if (validFiles.length === 0) {
        showExpertMessage('‚ùå Please select valid files for Dr. Elena to analyze (PDF, DOC, PPT, Audio, Video, Images, Text)', 'error');
        return;
    }

    uploadedFiles = validFiles;
    displayExpertFileList(validFiles);
    await startExpertAnalysisWorkflow(validFiles);
}

function validateExpertFiles(files) {
    const allowedTypes = [
        'application/pdf', 'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/vnd.ms-powerpoint', 
        'application/vnd.openxmlformats-officedocument.presentationml.presentation',
        'audio/mpeg', 'audio/wav', 'audio/mp3',
        'video/mp4', 'video/quicktime',
        'application/zip', 'image/jpeg', 'image/png', 'image/gif',
        'text/plain'
    ];

    return files.filter(file => {
        return allowedTypes.some(type => file.type === type) || 
               file.name.toLowerCase().endsWith('.scorm');
    });
}

// Display expert file list
function displayExpertFileList(files) {
    const fileListDiv = document.getElementById('expert-file-list');
    fileListDiv.innerHTML = '';

    files.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-expert-item';
        
        const fileTypeClass = getExpertFileTypeClass(file.type, file.name);
        
        fileItem.innerHTML = `
            <div class="flex items-center gap-6">
                <div class="expert-icon ${fileTypeClass}">
                    <span class="material-symbols-outlined">${getExpertFileIcon(file.type, file.name)}</span>
                </div>
                <div class="flex-1">
                    <h4 class="text-white text-xl font-bold">${file.name}</h4>
                    <p class="text-gray-300 text-base">${formatFileSize(file.size)} ‚Ä¢ ${getExpertFileTypeDescription(file.type, file.name)}</p>
                    <div class="mt-3">
                        <span id="expert-file-status-${index}" class="expert-status status-initializing">
                            <div class="expert-spinner"></div>
                            <span>Ready for Dr. Elena's analysis</span>
                        </span>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <span class="text-3xl">üë©‚Äçüè´</span>
                </div>
            </div>
        `;
        fileListDiv.appendChild(fileItem);
    });

    fileListDiv.classList.remove('hidden');
}

// Expert analysis workflow
// ===================================
// PRE-SME GENERAL USER QUESTIONS PHASE
// ===================================

async function showPreSMEQuestions(analysisData) {
    return new Promise((resolve) => {
        // Create Pre-SME questions overlay
        const overlay = document.createElement('div');
        overlay.id = 'pre-sme-overlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 35, 0.95);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        `;

        const questionContainer = document.createElement('div');
        questionContainer.style.cssText = `
            background: linear-gradient(135deg, #1a1823 0%, #2b2839 100%);
            border: 2px solid rgba(139, 92, 246, 0.4);
            border-radius: 24px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
        `;

        const domain = analysisData.domainClassification?.primaryDomain || 'General';
        const complexity = analysisData.domainClassification?.complexity || 'Intermediate';

        questionContainer.innerHTML = `
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 28px; font-weight: bold; margin-bottom: 10px;">
                    üìö Course Planning Setup
                </div>
                <div style="color: #94a3b8; font-size: 16px;">
                    Please answer these questions to optimize your ${domain} course design
                </div>
            </div>

            <form id="pre-sme-form" style="space-y: 25px;">
                <!-- Client Name Field -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 12px; font-size: 16px;">
                        üè¢ Client Name / Organization *
                    </label>
                    <input type="text" name="clientName" id="clientNameInput" required
                        placeholder="e.g., SAI, OGC, ABC Corporation"
                        style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(139, 92, 246, 0.3); background: rgba(30, 41, 59, 0.8); color: #e2e8f0; font-size: 14px;">
                    <p style="color: #94a3b8; font-size: 12px; margin-top: 8px;">
                        This will be used to personalize your learning map and reports
                    </p>
                </div>

                <!-- Question 1: Content Confirmation -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 12px; font-size: 16px;">
                        üìÑ Is this the primary content you want to build your course on?
                    </label>
                    <div style="display: flex; gap: 15px; margin-bottom: 10px; flex-wrap: wrap;">
                        <label style="display: flex; align-items: center; color: #cbd5e1; cursor: pointer;">
                            <input type="radio" name="contentConfirmation" value="primary" required style="margin-right: 8px; accent-color: #8b5cf6;">
                            Yes, this is my main course content
                        </label>
                        <label style="display: flex; align-items: center; color: #cbd5e1; cursor: pointer;">
                            <input type="radio" name="contentConfirmation" value="partial" required style="margin-right: 8px; accent-color: #8b5cf6;">
                            Partial - I have additional materials
                        </label>
                        <label style="display: flex; align-items: center; color: #cbd5e1; cursor: pointer;">
                            <input type="radio" name="contentConfirmation" value="supplementary" required style="margin-right: 8px; accent-color: #8b5cf6;">
                            No, this is supplementary content
                        </label>
                    </div>
                </div>

                <!-- Question 2: Target Audience -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 12px; font-size: 16px;">
                        üéØ Confirm your target audience level (AI detected: ${complexity})
                    </label>
                    <select name="audienceLevel" required style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(139, 92, 246, 0.3); background: rgba(30, 41, 59, 0.8); color: #e2e8f0; font-size: 14px;">
                        <option value="">Select target audience level</option>
                        <option value="Beginner" ${complexity === 'Beginner' ? 'selected' : ''}>Beginner - New to the subject</option>
                        <option value="Intermediate" ${complexity === 'Intermediate' ? 'selected' : ''}>Intermediate - Some experience</option>
                        <option value="Advanced" ${complexity === 'Advanced' ? 'selected' : ''}>Advanced - Experienced professionals</option>
                        <option value="Mixed">Mixed - Multiple skill levels</option>
                    </select>
                </div>

                <!-- Question 3: Course Type -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 12px; font-size: 16px;">
                        üìö What type of course are you creating?
                    </label>
                    <select name="courseType" required style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(139, 92, 246, 0.3); background: rgba(30, 41, 59, 0.8); color: #e2e8f0; font-size: 14px;">
                        <option value="">Select course type</option>
                        <option value="certification">Certification Course</option>
                        <option value="training">Professional Training</option>
                        <option value="onboarding">Employee Onboarding</option>
                        <option value="compliance">Compliance Training</option>
                        <option value="skills">Skills Development</option>
                        <option value="academic">Academic Course</option>
                        <option value="workshop">Workshop/Seminar</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <!-- Question 5: Estimated Duration -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 12px; font-size: 16px;">
                        ‚è±Ô∏è What's your target course duration?
                    </label>
                    <select name="courseDuration" required style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid rgba(139, 92, 246, 0.3); background: rgba(30, 41, 59, 0.8); color: #e2e8f0; font-size: 14px;">
                        <option value="">Select duration</option>
                        <option value="30min">30 minutes or less</option>
                        <option value="1hour">1 hour</option>
                        <option value="2-3hours">2-3 hours</option>
                        <option value="half-day">Half day (4 hours)</option>
                        <option value="full-day">Full day (8 hours)</option>
                        <option value="multi-day">Multiple days</option>
                        <option value="self-paced">Self-paced</option>
                    </select>
                </div>

                <!-- Question 6: Instructional Framework Selection (Multiple Choice, max 5) -->
                <div style="margin-bottom: 30px;">
                    <label style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 12px; font-size: 16px;">
                        üß† Select instructional frameworks for course design (Max 5)
                    </label>
                    <div id="framework-count-warning" style="display: none; color: #f59e0b; font-size: 13px; margin-bottom: 10px;">
                        ‚ö†Ô∏è Maximum 5 frameworks can be selected
                    </div>
                    <div style="background: rgba(30, 41, 59, 0.8); border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 8px; padding: 15px;">
                        <label style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.1)'" onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="frameworks" value="Blooms Taxonomy" checked class="framework-checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #e2e8f0; font-size: 14px;"><strong>Bloom's Taxonomy</strong> - Focus on cognitive learning levels (default)</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.1)'" onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="frameworks" value="ADDIE Model" checked class="framework-checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #e2e8f0; font-size: 14px;"><strong>ADDIE Model</strong> - Systematic instructional design process (default)</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.1)'" onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="frameworks" value="SAM Model" class="framework-checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #e2e8f0; font-size: 14px;"><strong>SAM Model</strong> - Agile instructional design approach</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.1)'" onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="frameworks" value="Kirkpatrick Model" class="framework-checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #e2e8f0; font-size: 14px;"><strong>Kirkpatrick Model</strong> - Training evaluation and ROI measurement</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.1)'" onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="frameworks" value="Gagn√©'s Nine Events" class="framework-checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #e2e8f0; font-size: 14px;"><strong>Gagn√©'s Nine Events</strong> - Structured learning sequence</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.1)'" onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="frameworks" value="Merrill's Principles" class="framework-checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #e2e8f0; font-size: 14px;"><strong>Merrill's Principles</strong> - Problem-centered learning approach</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.1)'" onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="frameworks" value="Kolb's Learning Cycle" class="framework-checkbox" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #e2e8f0; font-size: 14px;"><strong>Kolb's Learning Cycle</strong> - Experiential learning theory</span>
                        </label>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 12px; font-size: 13px; color: #cbd5e1; margin-top: 12px;">
                        üí° <strong>Framework Guide:</strong><br>
                        ‚Ä¢ <strong>Bloom's & ADDIE:</strong> Selected by default (recommended combination)<br>
                        ‚Ä¢ <strong>SAM Model:</strong> Best for rapid prototyping and iterative design<br>
                        ‚Ä¢ <strong>Kirkpatrick:</strong> Great for corporate training with ROI focus<br>
                        ‚Ä¢ <strong>Gagn√©'s:</strong> Perfect for structured, sequential learning<br>
                        ‚Ä¢ <strong>You can select up to 5 frameworks total</strong>
                    </div>
                </div>

                <div style="text-align: center; padding-top: 20px; border-top: 1px solid rgba(139, 92, 246, 0.3);">
                    <button type="submit" style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
                        Continue to SME Review ‚û§
                    </button>
                </div>
            </form>
        `;

        overlay.appendChild(questionContainer);
        document.body.appendChild(overlay);

        // Add framework selection limit enforcement
        const frameworkCheckboxes = document.querySelectorAll('.framework-checkbox');
        const warningDiv = document.getElementById('framework-count-warning');

        frameworkCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const checkedCount = document.querySelectorAll('.framework-checkbox:checked').length;

                if (checkedCount > 5) {
                    // Uncheck the last clicked checkbox
                    checkbox.checked = false;
                    warningDiv.style.display = 'block';
                    setTimeout(() => {
                        warningDiv.style.display = 'none';
                    }, 3000);
                } else {
                    warningDiv.style.display = 'none';
                }
            });
        });

        // Handle form submission
        const form = document.getElementById('pre-sme-form');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = questionContainer.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div style="display: inline-flex; align-items: center; gap: 8px;"><div class="pre-sme-spinner"></div>Storing Responses...</div>';

            // Add spinner CSS if not already added
            if (!document.getElementById('pre-sme-spinner-style')) {
                const style = document.createElement('style');
                style.id = 'pre-sme-spinner-style';
                style.textContent = `
                    .pre-sme-spinner {
                        width: 16px;
                        height: 16px;
                        border: 2px solid #ffffff;
                        border-top: 2px solid transparent;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                    }
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `;
                document.head.appendChild(style);
            }

            const formData = new FormData(form);

            // Collect selected frameworks
            const selectedFrameworks = [];
            form.querySelectorAll('input[name="frameworks"]:checked').forEach(checkbox => {
                selectedFrameworks.push(checkbox.value);
            });

            const answers = {
                clientName: formData.get('clientName'),
                contentConfirmation: formData.get('contentConfirmation'),
                audienceLevel: formData.get('audienceLevel'),
                courseType: formData.get('courseType'),
                courseDuration: formData.get('courseDuration'),
                instructionalFrameworks: selectedFrameworks, // Array of selected frameworks
                completedAt: new Date().toISOString(),
                detectedDomain: domain,
                detectedComplexity: complexity
            };

            console.log('‚úÖ Selected frameworks:', selectedFrameworks);

            console.log('‚úÖ Pre-SME questions completed:', answers);

            try {
                // Store Pre-SME responses in backend
                console.log('üíæ Storing Pre-SME responses in backend...');
                const storeResponse = await fetch(`${BACKEND_URL}/api/store-pre-sme-responses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sessionId: currentExpertSessionId,
                        preSMEAnswers: answers
                    })
                });

                const storeResult = await storeResponse.json();

                if (storeResult.success) {
                    console.log('‚úÖ Pre-SME responses stored successfully in backend');
                } else {
                    console.warn('‚ö†Ô∏è Failed to store Pre-SME responses, continuing with local storage');
                }

            } catch (error) {
                console.error('‚ùå Error storing Pre-SME responses:', error);
                console.log('üìù Continuing with local storage only');
            }

            // Remove overlay
            document.body.removeChild(overlay);

            // Resolve with answers
            resolve(answers);
        });

        // Add hover effect to submit button
        const submitBtn = questionContainer.querySelector('button[type="submit"]');
        submitBtn.addEventListener('mouseenter', () => {
            submitBtn.style.transform = 'translateY(-2px)';
        });
        submitBtn.addEventListener('mouseleave', () => {
            submitBtn.style.transform = 'translateY(0)';
        });
    });
}

// Show domain and document type information
async function showDomainAndDocumentInfo(analysisData, files) {
    return new Promise((resolve) => {
        // Create domain info overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 35, 0.95);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        `;

        const infoContainer = document.createElement('div');
        infoContainer.style.cssText = `
            background: linear-gradient(135deg, #1a1823 0%, #2b2839 100%);
            border: 2px solid rgba(139, 92, 246, 0.4);
            border-radius: 24px;
            padding: 40px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
        `;

        const domain = analysisData.domain || analysisData.domainClassification?.primaryDomain || 'General';
        const confidence = analysisData.domainClassification?.confidence || 85;
        const complexity = analysisData.domainClassification?.complexity || 'Intermediate';

        // Detect document types
        const documentTypes = files.map(file => {
            const ext = file.name.split('.').pop().toLowerCase();
            const typeMap = {
                'pdf': { name: 'PDF Document', icon: 'üìÑ', desc: 'Portable Document Format' },
                'docx': { name: 'Word Document', icon: 'üìù', desc: 'Microsoft Word Document' },
                'doc': { name: 'Word Document', icon: 'üìù', desc: 'Microsoft Word Document' },
                'txt': { name: 'Text Document', icon: 'üìÉ', desc: 'Plain Text File' },
                'pptx': { name: 'PowerPoint', icon: 'üìä', desc: 'Microsoft PowerPoint Presentation' },
                'xlsx': { name: 'Excel Document', icon: 'üìà', desc: 'Microsoft Excel Spreadsheet' },
                'zip': { name: 'SCORM Package', icon: 'üì¶', desc: 'eLearning SCORM Content' },
                'html': { name: 'Web Content', icon: 'üåê', desc: 'HTML Web Document' }
            };
            return typeMap[ext] || { name: 'Document', icon: 'üìÑ', desc: `${ext.toUpperCase()} File` };
        });

        infoContainer.innerHTML = `
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 28px; font-weight: bold; margin-bottom: 10px;">
                    üìä Content Analysis Results
                </div>
                <div style="color: #94a3b8; font-size: 16px;">
                    AI has analyzed your content and detected the following information
                </div>
            </div>

            <!-- Domain Information -->
            <div style="background: rgba(139, 92, 246, 0.1); border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 16px; padding: 24px; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; margin-bottom: 16px;">
                    <div style="font-size: 24px; margin-right: 12px;">üéØ</div>
                    <div style="color: #e2e8f0; font-weight: 600; font-size: 18px;">Detected Domain</div>
                </div>
                <div style="color: #8b5cf6; font-size: 24px; font-weight: bold; margin-bottom: 8px;">${domain}</div>
                <div style="color: #cbd5e1; font-size: 14px; margin-bottom: 12px;">
                    Word Count: <span style="color: #22c55e; font-weight: 600;">${analysisData.wordCount || 0}</span> words
                </div>
                <div style="color: #94a3b8; font-size: 13px; line-height: 1.4;">
                    ${analysisData.reasoning || analysisData.domainClassification?.domainReasoning || 'AI has classified this content based on terminology, context, and subject matter analysis.'}
                </div>
            </div>

            <!-- Document Types -->
            <div style="background: rgba(20, 184, 166, 0.1); border: 2px solid rgba(20, 184, 166, 0.3); border-radius: 16px; padding: 24px; margin-bottom: 30px;">
                <div style="display: flex; align-items: center; margin-bottom: 16px;">
                    <div style="font-size: 24px; margin-right: 12px;">üìÅ</div>
                    <div style="color: #e2e8f0; font-weight: 600; font-size: 18px;">Document Types</div>
                </div>
                ${documentTypes.map((type, index) => `
                    <div style="display: flex; align-items: center; margin-bottom: 12px; padding: 12px; background: rgba(20, 184, 166, 0.05); border-radius: 8px;">
                        <div style="font-size: 20px; margin-right: 12px;">${type.icon}</div>
                        <div style="flex: 1;">
                            <div style="color: #14b8a6; font-weight: 600; font-size: 14px;">${type.name}</div>
                            <div style="color: #94a3b8; font-size: 12px;">${type.desc} ‚Ä¢ ${files[index]?.name || 'File'}</div>
                        </div>
                    </div>
                `).join('')}
            </div>

            <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 24px;">
                <div style="color: #60a5fa; font-weight: 600; margin-bottom: 8px;">üìã Next Steps:</div>
                <div style="color: #cbd5e1; font-size: 14px; line-height: 1.5;">
                    ‚Ä¢ Review the detected domain and document types<br>
                    ‚Ä¢ Proceed to course planning questions<br>
                    ‚Ä¢ Select your preferred instructional framework<br>
                    ‚Ä¢ Complete SME validation for expert recommendations
                </div>
            </div>

            <div style="text-align: center;">
                <button id="proceed-to-presme" style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
                    Continue to Course Planning ‚û§
                </button>
            </div>
        `;

        overlay.appendChild(infoContainer);
        document.body.appendChild(overlay);

        // Add click handler
        document.getElementById('proceed-to-presme').addEventListener('click', () => {
            console.log('‚úÖ Domain and document info confirmed, proceeding to Pre-SME questions');
            document.body.removeChild(overlay);
            resolve();
        });

        // Add hover effect
        const proceedBtn = document.getElementById('proceed-to-presme');
        proceedBtn.addEventListener('mouseenter', () => {
            proceedBtn.style.transform = 'translateY(-2px)';
        });
        proceedBtn.addEventListener('mouseleave', () => {
            proceedBtn.style.transform = 'translateY(0)';
        });
    });
}

// Show completion message and redirect to SME interview
function showCompletionAndRedirect() {
    // Create completion overlay
    const overlay = document.createElement('div');
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 15, 35, 0.95);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
    `;

    const completionCard = document.createElement('div');
    completionCard.style.cssText = `
        background: linear-gradient(135deg, #1a1823 0%, #2b2839 100%);
        border: 2px solid rgba(139, 92, 246, 0.4);
        border-radius: 24px;
        padding: 50px;
        max-width: 600px;
        width: 90%;
        text-align: center;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
    `;

    completionCard.innerHTML = `
        <div style="color: #22c55e; font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
        <div style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 32px; font-weight: bold; margin-bottom: 20px;">
            Analysis Complete!
        </div>
        <div style="color: #94a3b8; font-size: 18px; margin-bottom: 30px; line-height: 1.6;">
            Dr. Elena Rodriguez has completed the professional content analysis.<br>
            Your content has been analyzed and Pre-SME questions captured.<br>
            <strong>Next step:</strong> SME Interview for expert validation.
        </div>
        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
            <div style="color: #60a5fa; font-weight: 600; margin-bottom: 10px;">üìã What's Next:</div>
            <div style="color: #cbd5e1; font-size: 14px; text-align: left;">
                ‚Ä¢ SME will review content-specific questions<br>
                ‚Ä¢ Expert recommendations will be refined<br>
                ‚Ä¢ Comprehensive report will be generated<br>
                ‚Ä¢ Learning strategy recommendations will be provided
            </div>
        </div>
        <button id="continue-to-sme" style="background: linear-gradient(135deg, #8b5cf6, #14b8a6); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
            Continue to SME Interview ‚û§
        </button>
    `;

    overlay.appendChild(completionCard);
    document.body.appendChild(overlay);

    // Add click handler
    document.getElementById('continue-to-sme').addEventListener('click', () => {
        console.log('üîÑ Redirecting to SME interview page...');
        window.location.href = '../brand_checklist_&_sme_interview/code.html';
    });

    // Add hover effect
    const continueBtn = document.getElementById('continue-to-sme');
    continueBtn.addEventListener('mouseenter', () => {
        continueBtn.style.transform = 'translateY(-2px)';
    });
    continueBtn.addEventListener('mouseleave', () => {
        continueBtn.style.transform = 'translateY(0)';
    });
}

async function startExpertAnalysisWorkflow(files) {
    isExpertProcessing = true;

    try {
        console.log('üß† Starting Dr. Elena Rodriguez Expert Analysis with', files.length, 'files');

        // Show expert processing status
        showExpertProcessingStatus('Dr. Elena extracting content...', 'Real content extraction from your files');
        updateExpertAIStatus('Content Extraction...', 'Dr. Elena Rodriguez extracting real content from your files');

        // Phase 1: Expert Upload using correct endpoint
        const formData = new FormData();
        files.forEach(file => formData.append('files', file));

        const uploadResponse = await fetch(`${BACKEND_URL}/api/upload`, {
            method: 'POST',
            body: formData
        });

        if (!uploadResponse.ok) {
            const errorText = await uploadResponse.text();
            throw new Error(`Expert upload failed: ${uploadResponse.status} - ${errorText}`);
        }

        const uploadResult = await uploadResponse.json();
        console.log('‚úÖ Upload response:', uploadResult);

        currentExpertSessionId = uploadResult.sessionId || Date.now().toString();
        updateExpertFileStatus(files, 'Content Extracted', 'status-complete');
        console.log('‚úÖ Real content extracted by Dr. Elena Rodriguez');

        // Phase 2: Initial analysis without preSME context
        console.log('üß† Starting initial AI analysis...');
        const analysisResponse = await fetch(`${BACKEND_URL}/api/analyze`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                fileId: uploadResult.fileId,
                fileIds: uploadResult.fileIds,
                sessionId: currentExpertSessionId
            })
        });

        if (!analysisResponse.ok) {
            const errorText = await analysisResponse.text();
            throw new Error(`AI analysis failed: ${analysisResponse.status} - ${errorText}`);
        }

        const analysisResult = await analysisResponse.json();
        console.log('‚úÖ Real AI analysis completed:', analysisResult);

        // Add extraction step
        addExpertProcessingStep('Real content extraction completed', 'check_circle', 'text-green-400');

        // Phase 2: Wait for Expert Analysis to Complete
        showExpertProcessingStatus('Dr. Sarah Mitchell performing expert analysis...', 'Professional instructional design analysis in progress');
        updateExpertAIStatus('Expert Analysis in Progress...', 'Dr. Sarah Mitchell analyzing your content with 25+ years of expertise');

        // Use real AI analysis data from backend
        console.log('üß™ Using real AI analysis data from backend...');
        await new Promise(resolve => setTimeout(resolve, 3000)); // Simulate processing time

        // Use real analysis from backend response
        expertAnalysisData = analysisResult.analysis || analysisResult.data || analysisResult;

        // Ensure we have valid analysis data
        if (!expertAnalysisData || typeof expertAnalysisData !== 'object') {
            throw new Error('Invalid analysis data received from backend');
        }

        // Add content-specific SME questions if not present
        if (!expertAnalysisData.contentSpecificSMEQuestions && expertAnalysisData.smeQuestions) {
            expertAnalysisData.contentSpecificSMEQuestions = expertAnalysisData.smeQuestions.map(q => ({
                question: typeof q === 'string' ? q : q.question || q
            }));
        }

        // Ensure contentSpecificSMEQuestions exists
        if (!expertAnalysisData.contentSpecificSMEQuestions) {
            expertAnalysisData.contentSpecificSMEQuestions = expertAnalysisData.smeQuestions || [];
        }

        console.log('‚úÖ Real AI analysis data loaded:', {
            domain: expertAnalysisData.domainClassification?.primaryDomain,
            qualityScore: expertAnalysisData.qualityAssessment?.overallScore,
            suitabilityScore: expertAnalysisData.suitabilityAssessment?.score,
            smeQuestions: expertAnalysisData.contentSpecificSMEQuestions?.length || expertAnalysisData.smeQuestions?.length
        });

        console.log('‚úÖ Real backend analysis complete:', expertAnalysisData);
        console.log('üìã SME Questions:', expertAnalysisData.contentSpecificSMEQuestions || expertAnalysisData.smeQuestions);

        // Store analysis data for SME interview page
        localStorage.setItem('expertAnalysisResults', JSON.stringify({
            success: true,
            data: expertAnalysisData,
            sessionId: currentExpertSessionId,
            timestamp: new Date().toISOString()
        }));

        // ALSO store in the format expected by results page
        localStorage.setItem('professionalAnalysisResults', JSON.stringify({
            success: true,
            data: {
                domain: expertAnalysisData.domain || 'General',
                wordCount: expertAnalysisData.wordCount || 0,
                reasoning: expertAnalysisData.reasoning || '',
                fileName: uploadResult.fileName || files[0]?.name || 'uploaded-file',
                smeQuestions: expertAnalysisData.smeQuestions || [],
                recommendations: expertAnalysisData.recommendations || []
            },
            analysis: expertAnalysisData,
            sessionId: currentExpertSessionId,
            timestamp: new Date().toISOString()
        }));

        console.log('‚úÖ Professional analysis completed successfully');
        console.log('üíæ Analysis data saved to localStorage:', {
            domain: expertAnalysisData.domain,
            wordCount: expertAnalysisData.wordCount,
            reasoning: expertAnalysisData.reasoning?.substring(0, 100)
        });

        // Add analysis steps
        addExpertProcessingStep('Domain classification completed', 'category', 'text-blue-400');
        addExpertProcessingStep('Quality assessment finished', 'analytics', 'text-purple-400');
        addExpertProcessingStep('Gap analysis completed', 'build', 'text-yellow-400');
        addExpertProcessingStep('Expert recommendations generated', 'auto_fix_high', 'text-green-400');

        // Phase 3: Display Domain & Document Type Information
        hideExpertProcessingStatus();
        updateExpertAIStatus('Analysis Complete', 'Review detected domain and document information');

        // Show domain and document type before Pre-SME
        await showDomainAndDocumentInfo(expertAnalysisData, files);

        // Phase 4: Pre-SME General User Questions (Mandatory)
        updateExpertAIStatus('Ready for Course Planning', 'Please answer a few questions to finalize your course setup');

        // Show Pre-SME questions before proceeding to results
        const preSMEAnswers = await showPreSMEQuestions(expertAnalysisData);

        // Store pre-SME answers in localStorage for next page
        localStorage.setItem('preSMEAnswers', JSON.stringify(preSMEAnswers));

        // Phase 4: Enhanced Analysis with Framework Context
        if (preSMEAnswers.instructionalFramework && preSMEAnswers.instructionalFramework !== 'recommend') {
            showExpertProcessingStatus('Dr. Elena performing framework-specific analysis...', 'Applying selected framework for enhanced recommendations');
            updateExpertAIStatus('Enhanced Analysis...', `Applying ${preSMEAnswers.instructionalFramework} framework for personalized analysis`);

            console.log('üß† Starting enhanced AI analysis with framework context...');
            const enhancedAnalysisResponse = await fetch(`${BACKEND_URL}/api/analyze`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    fileId: uploadResult.fileId,
                    fileIds: uploadResult.fileIds,
                    sessionId: currentExpertSessionId,
                    preSMEContext: preSMEAnswers
                })
            });

            if (enhancedAnalysisResponse.ok) {
                const enhancedAnalysisResult = await enhancedAnalysisResponse.json();
                console.log('‚úÖ Enhanced framework-specific analysis completed:', enhancedAnalysisResult);

                // Use enhanced analysis if available
                expertAnalysisData = enhancedAnalysisResult.analysis || enhancedAnalysisResult.data || expertAnalysisData;
                addExpertProcessingStep('Framework-specific analysis completed', 'psychology', 'text-purple-400');
            } else {
                console.warn('‚ö†Ô∏è Enhanced analysis failed, using initial analysis');
            }

            hideExpertProcessingStatus();
        }

        // Enhance analysis data with pre-SME answers
        expertAnalysisData.preSMEContext = preSMEAnswers;

        // Update stored analysis with pre-SME context
        localStorage.setItem('expertAnalysisResults', JSON.stringify({
            success: true,
            data: expertAnalysisData,
            sessionId: currentExpertSessionId,
            timestamp: new Date().toISOString(),
            preSMECompleted: true
        }));

        // Phase 4: Complete Analysis and Redirect to SME Interview
        updateExpertAIStatus('Dr. Elena Analysis Complete!', 'Ready for SME Interview');
        updateExpertFileStatus(files, 'Analysis Complete - Ready for SME', 'status-complete');

        console.log('‚úÖ Analysis complete, preparing for SME interview phase');

        // Show completion message and redirect to SME interview
        showCompletionAndRedirect();

        // Determine expert next steps
        const suitabilityScore = expertAnalysisData.suitabilityAssessment?.score || 0;
        const qualityScore = expertAnalysisData.qualityAssessment?.overallScore || 0;
        const hasRecommendations = expertAnalysisData.expertSuggestions && expertAnalysisData.expertSuggestions.interactiveSuggestions && expertAnalysisData.expertSuggestions.interactiveSuggestions.length > 0;

        console.log(`üéØ Dr. Elena's Expert Analysis Results:`);
        console.log(`   üìä Domain: ${expertAnalysisData.domainClassification?.primaryDomain}`);
        console.log(`   üéØ Suitability: ${suitabilityScore}%`);
        console.log(`   üìà Quality: ${qualityScore}%`);
        console.log(`   üí° Recommendations: ${expertAnalysisData.expertSuggestions?.interactiveSuggestions?.length || 0}`);

        setTimeout(() => {
            if (suitabilityScore < 30) {
                // Content not suitable - Dr. Elena's professional assessment
                showExpertContinueButton('Content Unsuitable - Upload Training Materials');
                showExpertMessage('üö´ Dr. Elena: This content is not suitable for e-learning. Please upload training materials instead.', 'error');
            } else if (hasRecommendations && suitabilityScore < 85) {
                // Show expert continue button (popup removed per user request)
                showExpertContinueButton('Dr. Elena: Review suggestions above - Continue when ready');
            } else {
                // Excellent content
                showExpertContinueButton('Dr. Elena Approves - Continue to Next Phase');
                showExpertMessage('‚úÖ Dr. Elena: Excellent content! Ready for e-learning development.', 'success');
            }
        }, 2500);

    } catch (error) {
        console.error('‚ùå Expert analysis workflow failed:', error);
        showExpertMessage(`‚ùå Dr. Elena Error: ${error.message}`, 'error');
        updateExpertAIStatus('Expert Analysis Failed', 'Error during Dr. Elena\'s analysis. Please try again.');
        resetExpertUI();
    } finally {
        isExpertProcessing = false;
    }
}

// Display expert analysis results
function displayExpertAnalysisResults(data) {
    console.log('üìä Expert Analysis Results (Summary Banner Removed):', data);

    // Note: Expert analysis banner has been removed from UI
    // This function now just logs the results
    if (data.domainClassification) {
        console.log('Domain:', data.domainClassification.contentType);
    }
    if (data.qualityAssessment) {
        console.log('Quality Score:', data.qualityAssessment.overallScore);
    }
    if (data.suitabilityAssessment) {
        console.log('Suitability:', data.suitabilityAssessment.level);
    }
}

function updateExpertDomainDisplay(domainData) {
    // Expert domain display elements have been removed from UI
    console.log('üìä Domain Display (UI Removed):', domainData);
    return;
    
    if (domainData) {
        domainText.textContent = domainData.contentType || 'Unknown';
        domainConfidence.textContent = `AI Confidence: ${domainData.confidence || 0}%`;
        
        if (domainData.contentType === 'Personal/Administrative') {
            domainElement.className = 'expert-badge expert-unsuitable';
            domainNote.textContent = 'Dr. Elena: Not suitable for e-learning';
        } else if (domainData.contentType === 'Academic/Record') {
            domainElement.className = 'expert-badge expert-unsuitable';
            domainNote.textContent = 'Dr. Elena: Limited e-learning potential';
        } else {
            domainElement.className = 'expert-badge expert-suitable';
            domainNote.textContent = `Dr. Elena: ${domainData.expertRecommendation || 'Good for e-learning'}`;
        }
    }
}
function displaySuitabilityAssessment(assessment) {
    const suitabilityElement = document.getElementById('suitability-assessment');
    
    suitabilityElement.innerHTML = `
        <div class="suitability-card" style="border-color: ${assessment.color}">
            <div class="suitability-header">
                <span class="suitability-icon">${assessment.icon}</span>
                <div class="suitability-score">
                    <span class="score">${assessment.score}%</span>
                    <span class="level" style="color: ${assessment.color}">${assessment.level}</span>
                </div>
            </div>
            <div class="suitability-content">
                <h4>Dr. Elena: ${assessment.level} E-Learning Potential</h4>
                <p class="recommendation">${assessment.recommendation}</p>
                <div class="factors">
                    <h5>Assessment Factors:</h5>
                    <ul>
                        ${assessment.factors.map(factor => `<li>${factor}</li>`).join('')}
                    </ul>
                </div>
                ${assessment.improvementPotential ? `
                    <div class="improvement-potential">
                        <h5>Improvement Potential:</h5>
                        <p>${assessment.improvementPotential}</p>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}
function displayGapAnalysis(gapAnalysis) {
    const gapsElement = document.getElementById('gap-analysis');
    
    if (gapAnalysis.identifiedGaps.length === 0) {
        gapsElement.innerHTML = `
            <div class="no-gaps">
                <span class="success-icon">‚úÖ</span>
                <h3>No Critical Gaps Identified</h3>
                <p>Dr. Elena found this content to be well-structured for e-learning conversion.</p>
            </div>
        `;
        return;
    }
    
    const gapsHTML = gapAnalysis.identifiedGaps.map(gap => `
        <div class="gap-item ${gap.severity.toLowerCase()}">
            <div class="gap-header">
                <h4>${gap.type}</h4>
                <span class="severity ${gap.severity.toLowerCase()}">${gap.severity}</span>
            </div>
            <div class="gap-content">
                <p class="description">${gap.description}</p>
                <p class="impact"><strong>Impact:</strong> ${gap.impact}</p>
                <p class="recommendation"><strong>Recommendation:</strong> ${gap.recommendation}</p>
                <div class="gap-details">
                    <span class="effort">Effort: ${gap.estimatedEffort}</span>
                    <span class="blooms">Bloom's Level: ${gap.bloomsLevel}</span>
                </div>
                ${gap.enhancement ? `
                    <details class="enhancement-preview">
                        <summary>Preview Enhanced Content</summary>
                        <pre class="enhanced-content">${gap.enhancement}</pre>
                    </details>
                ` : ''}
            </div>
        </div>
    `).join('');
    
    gapsElement.innerHTML = `
        <div class="gap-summary">
            <h3>Expert Gap Analysis Results</h3>
            <div class="gap-stats">
                <span class="stat">Total Gaps: ${gapAnalysis.gapSummary.totalGaps}</span>
                <span class="stat critical">Critical: ${gapAnalysis.gapSummary.criticalGaps}</span>
                <span class="stat high">High Priority: ${gapAnalysis.gapSummary.highPriorityGaps}</span>
                <span class="stat effort">Estimated Effort: ${gapAnalysis.gapSummary.estimatedTotalEffort}</span>
            </div>
        </div>
        <div class="gaps-list">
            ${gapsHTML}
        </div>
        ${gapAnalysis.implementationRoadmap ? `
            <div class="implementation-roadmap">
                <h4>Implementation Roadmap</h4>
                ${Object.entries(gapAnalysis.implementationRoadmap).map(([phase, gaps]) => `
                    <div class="roadmap-phase">
                        <h5>${phase}</h5>
                        <ul>
                            ${gaps.map(gap => `<li>${gap.type}</li>`).join('')}
                        </ul>
                    </div>
                `).join('')}
            </div>
        ` : ''}
    `;
}
function updateExpertComplexityDisplay(domainData) {
    // Expert complexity display elements have been removed from UI
    console.log('üìä Complexity Display (UI Removed):', domainData);
    return;
    
    if (domainData) {
        const complexity = domainData.complexity || 'Unknown';
        complexityText.textContent = complexity;
        complexityNote.textContent = `Dr. Elena: ${complexity} level identified`;
        
        if (complexity === 'Not Applicable') {
            complexityElement.className = 'complexity-expert complexity-analyzing';
        } else {
            complexityElement.className = `complexity-expert complexity-${complexity.toLowerCase()}`;
        }
    }
}

function updateExpertQualityDisplay(qualityData) {
    // Expert quality display elements have been removed from UI
    console.log('üìä Quality Display (UI Removed):', qualityData);
    return;
    
    if (qualityData) {
        const score = qualityData.overallScore || 0;
        qualityPercentage.textContent = score + '%';
        qualityLevel.textContent = `Dr. Elena: ${qualityData.expertAssessment || 'Quality assessed'}`;
        
        // Update expert styling based on score
        if (score >= 80) {
            qualityElement.className = 'quality-expert-circle quality-excellent';
        } else if (score >= 60) {
            qualityElement.className = 'quality-expert-circle quality-good';
        } else if (score >= 40) {
            qualityElement.className = 'quality-expert-circle quality-fair';
        } else {
            qualityElement.className = 'quality-expert-circle quality-poor';
        }
        
        // Animate the expert score
        animateExpertScore(qualityPercentage, score);
    }
}

function updateExpertGapDisplay(gapData) {
    // Expert gap display elements have been removed from UI
    console.log('üìä Gap Display (UI Removed):', gapData);
    return;
    
    if (gapData) {
        const count = gapData.identifiedGaps?.length || 0;
        gapCount.textContent = count;
        
        if (count === 0) {
            gapLevel.textContent = 'Dr. Elena: No significant gaps found';
            gapElement.className = 'gap-expert-counter gap-none';
        } else if (count <= 3) {
            gapLevel.textContent = `Dr. Elena: ${count} improvement area${count > 1 ? 's' : ''}`;
            gapElement.className = 'gap-expert-counter gap-few';
        } else {
            gapLevel.textContent = `Dr. Elena: ${count} areas need attention`;
            gapElement.className = 'gap-expert-counter gap-many';
        }
    }
}

function updateExpertSuitabilityDisplay(suitabilityData) {
    // Expert suitability display elements have been removed from UI
    console.log('üìä Suitability Display (UI Removed):', suitabilityData);
    return;
    const suitabilityScore = document.getElementById('expert-suitability-score');
    const suitabilityLevel = document.getElementById('expert-suitability-level');
    const assessmentNote = document.getElementById('expert-assessment-note');
    
    if (suitabilityData) {
        const score = suitabilityData.score || 0;
        const level = suitabilityData.level || 'Unknown';
        
        suitabilityScore.textContent = score + '%';
        suitabilityLevel.textContent = level;
        suitabilityDescription.textContent = suitabilityData.recommendation || 'Expert assessment complete';
        assessmentNote.textContent = suitabilityData.expertAnalysis || 'Professional evaluation completed';
        
        // Update expert banner styling
        if (score >= 85) {
            suitabilityBanner.className = 'suitability-expert-banner suitability-excellent';
            suitabilityIcon.textContent = 'verified';
            suitabilityTitle.textContent = 'Dr. Elena: Excellent for E-Learning';
        } else if (score >= 70) {
            suitabilityBanner.className = 'suitability-expert-banner suitability-good';
            suitabilityIcon.textContent = 'thumb_up';
            suitabilityTitle.textContent = 'Dr. Elena: Good for E-Learning';
        } else if (score >= 50) {
            suitabilityBanner.className = 'suitability-expert-banner suitability-fair';
            suitabilityIcon.textContent = 'warning';
            suitabilityTitle.textContent = 'Dr. Elena: Fair E-Learning Potential';
        } else if (score >= 25) {
            suitabilityBanner.className = 'suitability-expert-banner suitability-poor';
            suitabilityIcon.textContent = 'error';
            suitabilityTitle.textContent = 'Dr. Elena: Poor E-Learning Potential';
        } else {
            suitabilityBanner.className = 'suitability-expert-banner suitability-unsuitable';
            suitabilityIcon.textContent = 'cancel';
            suitabilityTitle.textContent = 'Dr. Elena: Not Suitable for E-Learning';
        }
        
        suitabilitySection.classList.remove('hidden');
    }
}
// In your frontend, update the domain display logic:
function displayDomainClassification(domain) {
    const domainElement = document.getElementById('domain-classification');
    
    if (domain.isUnsuitable) {
        domainElement.innerHTML = `
            <div class="domain-card unsuitable" style="border-color: ${domain.color}">
                <span class="domain-icon">${domain.icon}</span>
                <div class="domain-info">
                    <h3>${domain.primaryDomain}</h3>
                    <p class="confidence">AI Confidence: ${domain.confidence}%</p>
                    <p class="reason">${domain.unsuitabilityReason}</p>
                    <div class="recommendation">
                        <strong>Expert Recommendation:</strong>
                        <p>${domain.expertRecommendation}</p>
                    </div>
                </div>
            </div>
        `;
    } else {
        domainElement.innerHTML = `
            <div class="domain-card suitable" style="border-color: ${domain.color}">
                <span class="domain-icon">${domain.icon}</span>
                <div class="domain-info">
                    <h3>${domain.primaryDomain}</h3>
                    <p class="sub-domain">${domain.subDomain}</p>
                    <p class="confidence">AI Confidence: ${domain.confidence}%</p>
                    <p class="complexity">Complexity: ${domain.complexity}</p>
                    <div class="expert-analysis">
                        <strong>Dr. Elena's Analysis:</strong>
                        <p>${domain.expertAnalysis}</p>
                    </div>
                </div>
            </div>
        `;
    }
}
// Show expert recommendations popup
function showExpertRecommendationsPopup(data) {
    const popup = document.getElementById('expert-recommendations-popup');
    const content = document.getElementById('expert-recommendations-content');
    const totalRecs = document.getElementById('expert-total-recommendations');
    const highPriorityCount = document.getElementById('expert-high-priority-count');
    const qualityImprovement = document.getElementById('expert-quality-improvement');
    
    const recommendations = data.enhancementRecommendations || [];
    const highPriority = recommendations.filter(r => r.priority === 'High' || r.priority === 'Critical').length;
    
    console.log('üí° Showing Dr. Elena\'s expert recommendations:', recommendations.length);
    
    // Update expert summary
    totalRecs.textContent = recommendations.length;
    highPriorityCount.textContent = highPriority;
    qualityImprovement.textContent = `+${Math.min(30, recommendations.length * 4)}%`;
    
    // Generate expert recommendations content
    content.innerHTML = `
        <div class="mb-10">
            <h3 class="text-3xl font-bold text-white mb-6 flex items-center gap-3">
                <span class="material-symbols-outlined text-purple-400">lightbulb</span>
                Professional Enhancement Recommendations
            </h3>
            <p class="text-gray-300 text-lg mb-4">
                Based on Dr. Elena Rodriguez's 20+ years of instructional design expertise
            </p>
        </div>
        
        <div id="expert-recommendations-list" class="space-y-6">
            ${recommendations.map((rec, index) => `
                <div class="expert-recommendation-card ${rec.priority === 'High' || rec.priority === 'Critical' ? 'selected' : ''}">
                    <div class="flex items-start gap-4">
                        <input type="checkbox" id="expert-rec-${index}" 
                               class="w-6 h-6 rounded border-2 border-purple-500 text-purple-500 focus:ring-purple-500 focus:ring-2 mt-2" 
                               ${rec.priority === 'High' || rec.priority === 'Critical' ? 'checked' : ''} 
                               onchange="toggleExpertRecommendation(${index}, this.checked)">
                        <div class="flex-1">
                            <h4 class="text-white text-xl font-bold mb-3 flex items-center gap-2">
                                ${rec.title}
                                <span class="material-symbols-outlined text-purple-400">psychology</span>
                            </h4>
                            <p class="text-gray-300 mb-4 text-lg leading-relaxed">${rec.description}</p>
                            
                            ${rec.expertRationale ? `
                                <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4 mb-4">
                                    <h5 class="text-purple-300 font-semibold mb-2 flex items-center gap-2">
                                        <span class="material-symbols-outlined">psychology</span>
                                        Dr. Elena's Expert Rationale
                                    </h5>
                                    <p class="text-purple-100 text-base italic">"${rec.expertRationale}"</p>
                                </div>
                            ` : ''}
                            
                            <div class="flex flex-wrap items-center gap-3 text-sm">
                                <span class="px-4 py-2 rounded-full font-medium ${ 
                                    rec.priority === 'Critical' ? 'bg-red-500/20 text-red-300 border border-red-500/30' :
                                    rec.priority === 'High' ? 'bg-red-500/20 text-red-300 border border-red-500/30' : 
                                    rec.priority === 'Medium' ? 'bg-yellow-500/20 text-yellow-300 border border-yellow-500/30' : 
                                    'bg-blue-500/20 text-blue-300 border border-blue-500/30'
                                }">
                                    ${rec.priority} Priority
                                </span>
                                <span class="px-4 py-2 rounded-full bg-purple-500/20 text-purple-300 border border-purple-500/30 font-medium">
                                    ${rec.category}
                                </span>
                                <span class="text-gray-400 flex items-center gap-1">
                                    <span class="material-symbols-outlined text-sm">trending_up</span>
                                    Impact: ${rec.impact}
                                </span>
                                <span class="text-gray-400 flex items-center gap-1">
                                    <span class="material-symbols-outlined text-sm">schedule</span>
                                    Effort: ${rec.estimatedEffort}
                                </span>
                                ${rec.bloomsLevel ? `
                                    <span class="text-gray-400 flex items-center gap-1">
                                        <span class="material-symbols-outlined text-sm">school</span>
                                        Bloom's: ${rec.bloomsLevel}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('')} 
        </div>
    `;
    
    // Pre-select high priority recommendations
    selectedExpertRecommendations = recommendations.filter(r => r.priority === 'High' || r.priority === 'Critical').map((r, index) => ({ ...r, index }));
    
    popup.classList.remove('hidden');
}

function toggleExpertRecommendation(index, checked) {
    const recommendation = expertAnalysisData.enhancementRecommendations?.[index];
    if (!recommendation) return;

    const card = document.querySelector(`#expert-rec-${index}`).closest('.expert-recommendation-card');

    if (checked) {
        selectedExpertRecommendations.push({ ...recommendation, index });
        card.classList.add('selected');
    } else {
        selectedExpertRecommendations = selectedExpertRecommendations.filter(r => r.index !== index);
        card.classList.remove('selected');
    }

    console.log(`Dr. Elena - Selected recommendations: ${selectedExpertRecommendations.length}`);
    
    // Update apply button state
    const applyBtn = document.getElementById('expert-apply-recommendations-btn');
    applyBtn.disabled = selectedExpertRecommendations.length === 0;
}

// Apply expert selected recommendations
async function applyExpertSelectedRecommendations() {
    if (selectedExpertRecommendations.length === 0) {
        alert('Please select at least one of Dr. Elena\'s recommendations to apply.');
        return;
    }

    const applyBtn = document.getElementById('expert-apply-recommendations-btn');
    const originalText = applyBtn.innerHTML;
    applyBtn.innerHTML = '<div class="expert-spinner mr-3 w-6 h-6 border-2 border-white border-t-transparent"></div>Dr. Elena applying enhancements...';
    applyBtn.disabled = true;

    console.log('üîß Dr. Elena applying', selectedExpertRecommendations.length, 'expert enhancements');

    try {
        const response = await fetch(`${BACKEND_URL}/api/apply-enhancements`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                sessionId: currentExpertSessionId,
                fileId: currentExpertFileId,
                selectedRecommendations: selectedExpertRecommendations
            })
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Expert enhancement failed: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        console.log('‚úÖ Dr. Elena\'s enhancements applied successfully');

        // Close popup and show success
        closeExpertRecommendationsPopup();
        showExpertMessage(`‚úÖ Dr. Elena successfully applied ${selectedExpertRecommendations.length} professional enhancements!`, 'success');

        // Store expert results for next phase
        localStorage.setItem('expertAnalysisResults', JSON.stringify({
            ...expertAnalysisData,
            enhancementResults: result.data,
            appliedRecommendations: selectedExpertRecommendations,
            sessionId: currentExpertSessionId,
            fileId: currentExpertFileId,
            expertEnhancer: 'Dr. Elena Rodriguez',
            enhancementsApplied: true,
            processedAt: new Date().toISOString()
        }));

        setTimeout(() => {
            showExpertContinueButton('Dr. Elena Enhanced Content - Ready for Next Phase');
        }, 3000);

    } catch (error) {
        console.error('‚ùå Expert enhancements failed:', error);
        alert(`‚ùå Dr. Elena Error: ${error.message}`);
        applyBtn.innerHTML = originalText;
        applyBtn.disabled = false;
    }
}

function proceedWithoutExpertRecommendations() {
    console.log('‚è≠Ô∏è Proceeding without Dr. Elena\'s expert recommendations');
    closeExpertRecommendationsPopup();
    
    // Store basic expert analysis results
    localStorage.setItem('expertAnalysisResults', JSON.stringify({
        ...expertAnalysisData,
        sessionId: currentExpertSessionId,
        fileId: currentExpertFileId,
        expertAnalyst: 'Dr. Elena Rodriguez',
        enhancementsApplied: false,
        processedAt: new Date().toISOString()
    }));
    
    setTimeout(() => {
        showExpertContinueButton('Continue Without Expert Enhancements');
    }, 1500);
}

function closeExpertRecommendationsPopup() {
    document.getElementById('expert-recommendations-popup').classList.add('hidden');
}

function showExpertContinueButton(text) {
    const continueBtn = document.getElementById('expert-continue-btn');
    const continueText = document.getElementById('expert-continue-text');

    if (continueBtn && continueText) {
        continueText.textContent = text;
        continueBtn.classList.remove('hidden');
        console.log('‚û°Ô∏è Expert continue button shown');
    } else {
        console.log(`Continue Button: ${text}`);
    }
}

// ===================================
// FIXED CONTENT ANALYSIS - goToExpertNextPage() FUNCTION
// ===================================
// Replace your goToExpertNextPage() function in content analysis with this:

function goToExpertNextPage() {
    console.log('üöÄ Dr. Elena: Moving to SME interview phase');
    
    // Check data availability
    if (!expertAnalysisData || !currentExpertSessionId) {
        alert('‚ùå Please complete analysis first');
        return;
    }
    
    // Store data for SME system
    const smeData = {
        sessionId: currentExpertSessionId,
        data: expertAnalysisData,
        timestamp: new Date().toISOString(),
        analyst: 'Dr. Elena Rodriguez',
        ready: true,
        domainClassification: expertAnalysisData.domainClassification,
        gapAnalysis: expertAnalysisData.gapAnalysis,
        qualityAssessment: expertAnalysisData.qualityAssessment,
        suitabilityAssessment: expertAnalysisData.suitabilityAssessment,
        enhancementRecommendations: expertAnalysisData.enhancementRecommendations
    };
    
    localStorage.setItem('expertAnalysisResults', JSON.stringify(smeData));
    localStorage.setItem('currentSessionId', currentExpertSessionId);
    localStorage.setItem('analysisComplete', 'true');
    
    console.log('‚úÖ Data stored for SME system');
    
    // Show loading
    const continueBtn = document.getElementById('expert-continue-btn');
    const continueText = document.getElementById('expert-continue-text');
    
    if (continueBtn && continueText) {
        continueBtn.disabled = true;
        continueText.innerHTML = '<div class="expert-spinner mr-3 w-5 h-5 border-2 border-white border-t-transparent"></div>Preparing SME Interview...';
    }
    
    // Navigate to SME panel (UPDATE THIS PATH TO YOUR SME FILE)
    setTimeout(() => {
        // CHANGE THIS TO MATCH YOUR SME HTML FILE NAME:
        window.location.href = '../brand_checklist_&_sme_interview/code.html?session=' + currentExpertSessionId;
    }, 2000);
}


// Helper function to reset continue button if there's an error
function resetContinueButton() {
    const continueBtn = document.getElementById('expert-continue-btn');
    const continueText = document.getElementById('expert-continue-text');
    if (continueBtn && continueText) {
        continueBtn.disabled = false;
        continueText.textContent = 'Continue to Next Phase';
    }
}

// DEBUG: Add this function to test data storage
function testSMEDataStorage() {
    console.log('üß™ Testing SME data storage:');
    console.log('Session ID:', currentExpertSessionId);
    console.log('Analysis Data Available:', !!expertAnalysisData);
    console.log('Stored Data:', localStorage.getItem('expertAnalysisResults'));
    
    if (currentExpertSessionId && expertAnalysisData) {
        console.log('‚úÖ Ready for SME navigation');
        
        // Test storage
        const testData = {
            sessionId: currentExpertSessionId,
            data: expertAnalysisData,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem('test-sme-data', JSON.stringify(testData));
        console.log('‚úÖ Test storage successful');
        
        return true;
    } else {
        console.log('‚ùå Missing data - complete analysis first');
        return false;
    }
}

// Make test function available globally
window.testSMEDataStorage = testSMEDataStorage;

console.log('‚úÖ Content Analysis SME Navigation Fixed');
console.log('üîß Test function: testSMEDataStorage()');
console.log('üìç Update the navigation path to match your SME HTML file location');
// Expert utility functions
function showExpertProcessingStatus(title, description) {
    const processingStatus = document.getElementById('expert-processing-status');
    const processingTitle = document.getElementById('expert-processing-title');
    const processingDescription = document.getElementById('expert-processing-description');
    
    processingTitle.textContent = title;
    processingDescription.textContent = description;
    processingStatus.classList.remove('hidden');
}

function hideExpertProcessingStatus() {
    document.getElementById('expert-processing-status').classList.add('hidden');
}

function addExpertProcessingStep(stepText, icon, colorClass) {
    const stepsContainer = document.getElementById('expert-processing-steps');
    const stepDiv = document.createElement('div');
    stepDiv.className = 'flex items-center gap-3';
    stepDiv.innerHTML = `
        <span class="material-symbols-outlined ${colorClass}">${icon}</span>
        <span>${stepText}</span>
    `;
    stepsContainer.appendChild(stepDiv);
}

function showExpertMessage(message, type) {
    // Enhanced expert message system
    const messageConfig = {
        'success': { icon: 'check_circle', color: 'text-green-400' },
        'error': { icon: 'error', color: 'text-red-400' },
        'warning': { icon: 'warning', color: 'text-yellow-400' },
        'info': { icon: 'info', color: 'text-blue-400' }
    };
    
    const config = messageConfig[type] || messageConfig.info;
    console.log(`Dr. Elena ${type.toUpperCase()}: ${message}`);
    
    // You could implement a toast notification system here
}

function updateExpertAIStatus(title, description) {
    const statusEl = document.getElementById('expert-ai-status');
    const descEl = document.getElementById('expert-ai-description');

    if (statusEl) {
        statusEl.textContent = title;
    } else {
        console.log(`Dr. Elena Status: ${title}`);
    }

    if (descEl) {
        descEl.textContent = description;
    } else {
        console.log(`Dr. Elena: ${description}`);
    }
}

function updateExpertFileStatus(files, status, statusClass) {
    files.forEach((file, index) => {
        const statusEl = document.getElementById(`expert-file-status-${index}`);
        if (statusEl) {
            statusEl.className = `expert-status ${statusClass}`;
            if (statusClass === 'status-complete') {
                statusEl.innerHTML = `
                    <span class="material-symbols-outlined text-green-400">check_circle</span>
                    <span>${status}</span>
                `;
            } else {
                statusEl.innerHTML = `
                    <div class="expert-spinner"></div>
                    <span>${status}</span>
                `;
            }
        }
    });
}

function resetExpertUI() {
    isExpertProcessing = false;
    const selectBtn = document.getElementById('expert-select-files-btn');
    selectBtn.disabled = false;
}

function animateExpertScore(element, targetScore) {
    let current = 0;
    const increment = targetScore / 60;
    
    const animate = () => {
        current += increment;
        if (current < targetScore) {
            element.textContent = Math.round(current) + '%';
            requestAnimationFrame(animate);
        } else {
            element.textContent = targetScore + '%';
        }
    };
    
    animate();
}

function getExpertFileIcon(type, name) {
    const nameLower = name.toLowerCase();
    
    if (nameLower.includes('resume') || nameLower.includes('cv')) return 'person';
    if (nameLower.includes('marksheet') || nameLower.includes('transcript')) return 'school';
    
    const iconMap = {
        'application/pdf': 'picture_as_pdf',
        'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'slideshow',
        'application/vnd.ms-powerpoint': 'slideshow',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'description',
        'application/msword': 'description',
        'audio/mpeg': 'mic',
        'audio/wav': 'mic',
        'audio/mp3': 'mic',
        'video/mp4': 'videocam',
        'video/quicktime': 'videocam',
        'application/zip': 'folder_zip',
        'image/jpeg': 'image',
        'image/png': 'image',
        'image/gif': 'image',
        'text/plain': 'article'
    };
    return iconMap[type] || 'insert_drive_file';
}

function getExpertFileTypeClass(type, name) {
    const nameLower = name.toLowerCase();
    
    if (nameLower.includes('resume') || nameLower.includes('cv')) return 'bg-red-500/20 text-red-400';
    if (nameLower.includes('marksheet') || nameLower.includes('transcript')) return 'bg-yellow-500/20 text-yellow-400';
    
    const classMap = {
        'application/pdf': 'bg-red-500/30 text-red-400',
        'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'bg-orange-500/30 text-orange-400',
        'application/vnd.ms-powerpoint': 'bg-orange-500/30 text-orange-400',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'bg-blue-500/30 text-blue-400',
        'application/msword': 'bg-blue-500/30 text-blue-400',
        'audio/mpeg': 'bg-purple-500/30 text-purple-400',
        'audio/wav': 'bg-purple-500/30 text-purple-400',
        'audio/mp3': 'bg-purple-500/30 text-purple-400',
        'video/mp4': 'bg-pink-500/30 text-pink-400',
        'video/quicktime': 'bg-pink-500/30 text-pink-400',
        'application/zip': 'bg-gray-500/30 text-gray-400',
        'image/jpeg': 'bg-green-500/30 text-green-400',
        'image/png': 'bg-green-500/30 text-green-400',
        'image/gif': 'bg-green-500/30 text-green-400',
        'text/plain': 'bg-teal-500/30 text-teal-400'
    };
    return classMap[type] || 'bg-gray-500/30 text-gray-400';
}

function getExpertFileTypeDescription(type, name) {
    const nameLower = name.toLowerCase();
    
    if (nameLower.includes('resume') || nameLower.includes('cv')) return 'Resume/CV (Dr. Elena: Not suitable for e-learning)';
    if (nameLower.includes('marksheet') || nameLower.includes('transcript')) return 'Academic Record (Dr. Elena: Limited suitability)';
    
    const descriptions = {
        'application/pdf': 'PDF Document (Dr. Elena: Excellent for analysis)',
        'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'PowerPoint Presentation (Dr. Elena: Great for e-learning)',
        'application/vnd.ms-powerpoint': 'PowerPoint Presentation (Dr. Elena: Great for e-learning)',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'Word Document (Dr. Elena: Good for analysis)',
        'application/msword': 'Word Document (Dr. Elena: Good for analysis)',
        'audio/mpeg': 'MP3 Audio (Dr. Elena: Perfect for multimedia learning)',
        'audio/wav': 'WAV Audio (Dr. Elena: Perfect for multimedia learning)',
        'audio/mp3': 'MP3 Audio (Dr. Elena: Perfect for multimedia learning)',
        'video/mp4': 'MP4 Video (Dr. Elena: Excellent for e-learning)',
        'video/quicktime': 'QuickTime Video (Dr. Elena: Excellent for e-learning)',
        'application/zip': 'ZIP Archive (Dr. Elena: May contain course materials)',
        'image/jpeg': 'JPEG Image (Dr. Elena: Needs context for learning)',
        'image/png': 'PNG Image (Dr. Elena: Needs context for learning)',
        'image/gif': 'GIF Image (Dr. Elena: Needs context for learning)',
        'text/plain': 'Text File (Dr. Elena: Good for content analysis)'
    };
    return descriptions[type] || 'Document (Dr. Elena: Will analyze)';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function generateExpertSessionId() {
    return 'expert_session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Professional Analysis Monitoring Function
function startProfessionalAnalysisMonitoring(sessionId) {
    console.log(`üéì Starting professional analysis monitoring for session: ${sessionId}`);

    const checkInterval = setInterval(async () => {
        try {
            const response = await fetch(`https://clamshell-backend-k1197ddd8-mohammed-asrafs-projects.vercel.app/api/analyze`, {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' }
            });

            if (!response.ok) {
                throw new Error(`Status check failed: ${response.status}`);
            }

            const result = await response.json();
            const data = result.data;

            console.log(`üìä Professional Analysis Status: ${data.status} (${data.analysisProgress}%)`);

            // Update progress display
            updateExpertAnalysisProgress(data.analysisProgress, data.currentStep);

            if (data.status === 'completed' && data.professionalAnalysis) {
                console.log('‚úÖ Professional analysis completed!');
                clearInterval(checkInterval);

                // Store professional analysis results
                localStorage.setItem('professionalAnalysisResults', JSON.stringify(data));

                // Show completion and navigate to results
                showProfessionalAnalysisComplete(data);

                setTimeout(() => {
                    window.location.href = '../content_analysis_results/code.html?session=' + sessionId;
                }, 2000);

            } else if (data.status === 'error') {
                console.error('‚ùå Professional analysis failed:', data.errorMessage);
                clearInterval(checkInterval);
                showExpertAnalysisError('Professional Analysis Failed', data.errorMessage);
            }

        } catch (error) {
            console.error('‚ùå Failed to check analysis status:', error);
            clearInterval(checkInterval);
            showExpertAnalysisError('Status Check Failed', error.message);
        }
    }, 2000); // Check every 2 seconds
}

// Update progress display for professional analysis
function updateExpertAnalysisProgress(progress, currentStep) {
    const stepMessages = {
        'content_extracted': 'üìÑ Content extracted, analyzing...', 
        'domain_classification': 'üéØ Classifying content domain...',
        'quality_assessment': 'üìä Assessing content quality...',
        'gap_analysis': 'üîç Identifying instructional gaps...',
        'analysis_complete': '‚úÖ Professional analysis complete!'
    };

    const message = stepMessages[currentStep] || `Processing... (${progress}%)`;

    // Update existing progress indicators
    showExpertProcessingStatus('Dr. Sarah Mitchell Professional Analysis', message);
    updateExpertAIStatus(`Professional Analysis: ${progress}%`, message);
}

// Show professional analysis completion
function showProfessionalAnalysisComplete(analysisData) {
    const analysis = analysisData.analysis || analysisData; // Handle different response formats

    showExpertProcessingStatus(
        'üéâ Professional Analysis Complete!',
        `Dr. Elena Rodriguez has completed comprehensive analysis. Domain: ${analysis.domainClassification?.primaryDomain || 'Analyzed'}, Quality: ${analysis.qualityAssessment?.overallScore || 0}%, Suitability: ${analysis.suitabilityAssessment?.level || 'Good'}`
    );

    updateExpertAIStatus(
        '‚úÖ Analysis Complete',
        `Professional analysis completed by Dr. Elena Rodriguez, Ph.D. (20+ years experience)`
    );

    // Display the enhanced analysis summary
    displayProfessionalAnalysisSummary(analysis);
}

// Enhanced approval function for expert suggestions
function approveSuggestion(suggestion, index) {
    console.log('‚úÖ Approved suggestion:', suggestion);

    // Store approved suggestion with enhanced data
    let approvedSuggestions = JSON.parse(localStorage.getItem('approvedSuggestions') || '[]');
    const suggestionData = {
        id: `suggestion_${Date.now()}_${index}`,
        suggestion: suggestion,
        index: index || 0,
        timestamp: new Date().toISOString(),
        domain: expertAnalysisData?.domainClassification?.primaryDomain || 'Unknown',
        qualityScore: expertAnalysisData?.qualityAssessment?.overallScore || 0,
        complexity: expertAnalysisData?.domainClassification?.complexity || 'Unknown',
        sessionId: currentExpertSessionId || 'unknown',
        status: 'approved',
        implementation: 'Add interactive scenarios, practice exercises, and real-world examples to enhance engagement'
    };

    // Check if already approved
    if (!approvedSuggestions.find(item => item.suggestion === suggestion)) {
        approvedSuggestions.push(suggestionData);
        localStorage.setItem('approvedSuggestions', JSON.stringify(approvedSuggestions));

        // Store in session storage for immediate access
        sessionStorage.setItem('currentApprovedSuggestions', JSON.stringify(approvedSuggestions));
    }

    // Update UI with enhanced feedback
    const button = event?.target?.closest('button') || document.querySelector(`button[onclick*="approveSuggestion('${suggestion.replace(/'/g, "'")}')"`);
    const card = button?.closest('.suggestion-card') || button?.closest('div');

    // Animate the approval
    card.classList.add('border-green-500/50', 'bg-green-900/10');
    button.innerHTML = '<span>‚úÖ</span> Approved';
    button.classList.remove('bg-green-600', 'hover:bg-green-700');
    button.classList.add('bg-blue-600', 'cursor-not-allowed', 'opacity-80');
    button.disabled = true;

    // Update counters
    updateApprovalCounters();

    // Add success animation
    setTimeout(() => {
        card.style.transform = 'scale(1.02)';
        setTimeout(() => {
            card.style.transform = 'scale(1)';
        }, 200);
    }, 100);
}

// Update approval counters in real-time
function updateApprovalCounters() {
    const approvedSuggestions = JSON.parse(localStorage.getItem('approvedSuggestions') || '[]');
    const count = approvedSuggestions.length;

    // Update counter in suggestions section
    const counterElement = document.getElementById('approved-suggestions-count');
    if (counterElement) {
        counterElement.textContent = count;
    }

    // Update summary at bottom
    const summaryElement = document.getElementById('approved-suggestions-summary');
    if (summaryElement) {
        summaryElement.textContent = `${count} expert suggestion${count !== 1 ? 's' : ''} approved`;
    }
}

// Navigation function for next page
function proceedToNextPage() {
    const approvedSuggestions = JSON.parse(localStorage.getItem('approvedSuggestions') || '[]');

    // Store current analysis data for next page
    const analysisData = {
        expertAnalysis: expertAnalysisData,
        approvedSuggestions: approvedSuggestions,
        sessionId: currentExpertSessionId,
        timestamp: new Date().toISOString()
    };

    localStorage.setItem('analysisComplete', JSON.stringify(analysisData));
    sessionStorage.setItem('proceedingToLearningMap', 'true');

    console.log('üöÄ Proceeding to personalized learning map with real AI analysis data');
    console.log('üìä Session ID:', currentExpertSessionId);
    console.log('‚úÖ Approved suggestions:', approvedSuggestions.length);

    // Navigate to domain/sector detection page with real analysis data
    window.location.href = '../content_analysis_results/code.html?sessionId=' + currentExpertSessionId + '&from=analysis';
}

// Download analysis report function
function downloadAnalysisReport() {
    const analysisData = expertAnalysisData;
    const approvedSuggestions = JSON.parse(localStorage.getItem('approvedSuggestions') || '[]');

    if (!analysisData) {
        alert('No analysis data available to download');
        return;
    }

    // Create comprehensive PDF-style report content
    const timestamp = new Date();
    const reportContent = `
DR. ELENA RODRIGUEZ - PROFESSIONAL INSTRUCTIONAL DESIGN ANALYSIS
${'='.repeat(80)}

Generated: ${timestamp.toLocaleDateString()} ${timestamp.toLocaleTimeString()}
Analyst: Dr. Elena Rodriguez (20+ Years Experience)
Session ID: ${currentExpertSessionId || 'N/A'}

${'='.repeat(80)}
EXECUTIVE SUMMARY
${'='.repeat(80)}

Domain: ${analysisData.domainClassification?.primaryDomain || 'Unknown'}
Complexity Level: ${analysisData.complexityAssessment?.level || 'Unknown'}
Overall Quality Score: ${analysisData.qualityAssessment?.overallScore || 0}/100
Suitability Rating: ${analysisData.suitabilityAssessment?.level || 'Good'} (${analysisData.suitabilityAssessment?.score || 0}/100)

Dr. Elena's Assessment: ${analysisData.justification?.line1 || 'Professional analysis completed'}
${analysisData.justification?.line2 || ''}

${'='.repeat(80)}
DETAILED QUALITY ASSESSMENT
${'='.repeat(80)}

üìä CLARITY SCORE: ${analysisData.qualityAssessment?.clarityScore || 0}/100
Reasoning: ${analysisData.qualityAssessment?.clarityReasoning || 'Not provided'}

üìä COMPLETENESS SCORE: ${analysisData.qualityAssessment?.completenessScore || 0}/100
Reasoning: ${analysisData.qualityAssessment?.completenessReasoning || 'Not provided'}

üìä ENGAGEMENT SCORE: ${analysisData.qualityAssessment?.engagementScore || 0}/100
Reasoning: ${analysisData.qualityAssessment?.engagementReasoning || 'Not provided'}

üìä CURRENCY SCORE: ${analysisData.qualityAssessment?.currencyScore || 0}/100
Reasoning: ${analysisData.qualityAssessment?.currencyReasoning || 'Not provided'}

${'='.repeat(80)}
IDENTIFIED IMPROVEMENT AREAS
${'='.repeat(80)}

${analysisData.gapAnalysis?.identifiedGaps?.map((gap, index) => {
    return `${index + 1}. ${gap.type?.toUpperCase() || 'IMPROVEMENT AREA'} [${gap.severity || 'Medium'} Priority]
   Description: ${gap.description || 'Not provided'}
   Impact: ${gap.impact || 'Not provided'}
   Recommendation: ${gap.recommendation || 'Not provided'}
   Category: ${gap.category || 'General'}`;
}).join('

') || 'No specific gaps identified'}

${'='.repeat(80)}
EXPERT RECOMMENDATIONS
${'='.repeat(80)}

üéØ KEY RECOMMENDATION:
${analysisData.expertSuggestions?.keyRecommendation || 'Focus on structured content organization and interactive elements'}

üí° INTERACTIVE SUGGESTIONS:
${analysisData.expertSuggestions?.interactiveSuggestions?.map((suggestion, index) => {
    return `${index + 1}. ${suggestion}`;
}).join('
') || 'Add interactive elements to enhance engagement'}

${'='.repeat(80)}
APPROVED SUGGESTIONS (${approvedSuggestions.length})
${'='.repeat(80)}

${approvedSuggestions.length > 0 ?
    approvedSuggestions.map((item, index) => {
        return `${index + 1}. ${item.suggestion}\n   Status: APPROVED\n   Implementation: ${item.implementation || 'To be determined'}\n   Approved: ${new Date(item.timestamp).toLocaleDateString()}`;
    }).join('

') : 'No suggestions have been approved yet'}

${'='.repeat(80)}
SME INTERVIEW QUESTIONS
${'='.repeat(80)}

${analysisData.contentSpecificSMEQuestions?.map((questionObj, index) => {
    return `${index + 1}. ${questionObj.question || questionObj}`;
}).join('
') || 'No content-specific SME questions generated'}

${'='.repeat(80)}
NEXT STEPS
${'='.repeat(80)}

1. Review and approve relevant expert suggestions
2. Proceed to SME (Subject Matter Expert) interview phase
3. Implement approved enhancements
4. Develop structured e-learning modules
5. Conduct pilot testing with target audience

${'='.repeat(80)}
TECHNICAL DETAILS
${'='.repeat(80)}

Confidence Level: ${analysisData.domainClassification?.confidence || 85}%
Domain Reasoning: ${analysisData.domainClassification?.domainReasoning || 'Based on content analysis'}
Complexity Reasoning: ${analysisData.domainClassification?.complexityReasoning || 'Assessed based on content depth'}

${'='.repeat(80)}
GENERATED BY COURSECRAFT AI - DR. ELENA RODRIGUEZ ANALYSIS SYSTEM
Powered by GPT-4o-mini | Professional Instructional Design Analysis
For questions or support: coursecraft.ai
${'='.repeat(80)}
    `;

    // Create and download as text file (PDF-like formatted)
    const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Dr-Elena-Analysis-Report-${timestamp.getFullYear()}${String(timestamp.getMonth()+1).padStart(2,'0')}${String(timestamp.getDate()).padStart(2,'0')}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    console.log('üìÑ Professional analysis report downloaded successfully');

    console.log('üìÑ Analysis report downloaded successfully');
}

// Expert system ready
console.log('‚úÖ Dr. Elena Rodriguez AI Expert System Ready!');
console.log('üë©‚Äçüè´ Expert: Dr. Elena Rodriguez');
console.log('üéì Experience: 20+ years in instructional design');
console.log('üéØ Accuracy: 95%+ professional analysis');
console.log('üß† Capabilities: Real content analysis, domain classification, expert recommendations');
console.log('üîß Backend URL:', BACKEND_URL);
console.log('üöÄ Ready for REAL expert instructional design analysis!');
// 1. Enhanced Quality Assessment
function displayEnhancedQualityAssessment(qualityData) {
  const qualityElement = document.getElementById('quality-assessment');
  const scoreReasons = qualityData.scoreReasons || {};

  qualityElement.innerHTML = `
    <div class="enhanced-quality-card">
      <div class="quality-header">
        <h3>Dr. Elena's Quality Assessment</h3>
        <div class="overall-score">${qualityData.overallScore}%</div>
      </div>
      <div class="chatgpt-explanation">
        <h4>üìä ChatGPT-4 Analysis:</h4>
        <p class="expert-explanation">${qualityData.chatGPTAnalysis}</p>
      </div>
      <div class="score-breakdown">
        <div class="score-item">
          <div class="score-header">
            <span class="score-name">Clarity</span>
            <span class="score-value">${qualityData.clarityScore}%</span>
          </div>
          <p class="score-reason">${scoreReasons.clarity.reason}</p>
          <div class="score-examples">
            <strong>Examples:</strong>
            <ul>${scoreReasons.clarity.examples.map(ex => `<li>${ex}</li>`).join('')}</ul>
          </div>
          <div class="score-improvements">
            <strong>Improvements:</strong>
            <ul>${scoreReasons.clarity.improvements.map(im => `<li>${im}</li>`).join('')}</ul>
          </div>
        </div>
        <div class="score-item">
          <div class="score-header">
            <span class="score-name">Completeness</span>
            <span class="score-value">${qualityData.completenessScore}%</span>
          </div>
          <p class="score-reason">${scoreReasons.completeness.reason}</p>
        </div>
        <div class="score-item">
          <div class="score-header">
            <span class="score-name">Engagement</span>
            <span class="score-value">${qualityData.engagementScore}%</span>
          </div>
          <p class="score-reason">${scoreReasons.engagement.reason}</p>
        </div>
        <div class="score-item">
          <div class="score-header">
            <span class="score-name">Currency</span>
            <span class="score-value">${qualityData.currencyScore}%</span>
          </div>
          <p class="score-reason">${scoreReasons.currency.reason}</p>
        </div>
      </div>
      <div class="improvement-suggestions">
        <h4>üí° Improvement Suggestions:</h4>
        <ul>${qualityData.improvementSuggestions.map(s => `<li>${s}</li>`).join('')}</ul>
      </div>
      <div class="expert-recommendation">
        <h4>üéØ Expert Recommendation:</h4>
        <p>${qualityData.expertRecommendation}</p>
      </div>
    </div>
  `;
}

// 2. Enhanced Gap Analysis
function displayEnhancedGapAnalysis(gapData) {
  const gapsElement = document.getElementById('gap-analysis');
  const gapReasons = gapData.gapReasons || {};

  if (gapData.identifiedGaps.length === 0) {
    gapsElement.innerHTML = `
      <div class="no-gaps">
        <span>‚úÖ</span>
        <h3>No Critical Gaps Identified</h3>
        <p>${gapData.chatGPTAnalysis}</p>
      </div>
    `;
    return;
  }

  gapsElement.innerHTML = `
    <div class="enhanced-gap-analysis">
      <div class="gap-header">
        <h3>Dr. Elena's Gap Analysis</h3>
      </div>
      <div class="chatgpt-gap-analysis">
        <h4>üß† ChatGPT-4 Analysis:</h4>
        <p>${gapData.chatGPTAnalysis}</p>
      </div>
      ${gapData.identifiedGaps.map((gap, i) => {
        const reason = gapReasons[`gap_${i}`];
        return `
          <div class="gap-item-detailed ${gap.severity.toLowerCase()}">
            <h4>${gap.type} (${gap.severity})</h4>
            <h5>üîç Why Identified:</h5>
            <p>${reason.whyIdentified}</p>
            <h5>üìÑ Evidence:</h5>
            <p>${reason.contentEvidence}</p>
            <h5>‚ö†Ô∏è Impact:</h5>
            <p>${reason.impactExplanation}</p>
            <h5>üí° Solution:</h5>
            <p>${reason.specificSolution}</p>
          </div>
        `;
      }).join('')}
      <div class="actionable-recommendations">
        <h4>üéØ Actionable Recommendations:</h4>
        <ul>${gapData.actionableRecommendations.map(r => `<li>${r}</li>`).join('')}</ul>
      </div>
      <div class="expert-advice">
        <h4>üë©‚Äçüè´ Expert Advice:</h4>
        <p>${gapData.expertAdvice}</p>
      </div>
    </div>
  `;
}

// 3. Enhanced Suitability Assessment
function displayEnhancedSuitabilityAssessment(suitabilityData) {
  const suitabilityElement = document.getElementById('suitability-assessment');
  const sb = suitabilityData.scoreBreakdown || {};
  const ip = suitabilityData.improvementPath || {};

  suitabilityElement.innerHTML = `
    <div class="enhanced-suitability-card">
      <h3>Dr. Elena's Suitability Assessment</h3>
      <div class="overall-score">${suitabilityData.score}% (${suitabilityData.level})</div>
      <div class="chatgpt-suitability-analysis">
        <h4>üß† ChatGPT-4 Analysis:</h4>
        <p>${suitabilityData.chatGPTAnalysis}</p>
      </div>
      ${Object.entries(sb).map(([k,v]) => `
        <div class="breakdown-item">
          <h5>${k}</h5>
          <p>${v.explanation}</p>
          ${v.contentSpecificReason ? `<p><strong>For this content:</strong> ${v.contentSpecificReason}</p>` : ''}
          ${v.recommendation ? `<p><strong>Recommendation:</strong> ${v.recommendation}</p>` : ''}
        </div>
      `).join('')}
      <div class="improvement-path">
        <h4>üõ§Ô∏è Improvement Path:</h4>
        <div>
          <h5>‚ö° Immediate Actions:</h5>
          <ul>${ip.immediateActions.map(a=>`<li>${a}</li>`).join('')}</ul>
        </div>
        ${ip.mediumTermGoals ? `<div><h5>üìà Medium-Term Goals:</h5><ul>${ip.mediumTermGoals.map(g=>`<li>${g}</li>`).join('')}</ul></div>` : ''}
        ${ip.longTermVision ? `<div><h5>üéØ Long-Term Vision:</h5><ul>${ip.longTermVision.map(v=>`<li>${v}</li>`).join('')}</ul></div>` : ''}
      </div>
      <div class="expert-recommendation">
        <h4>üéØ Recommendation:</h4>
        <p>${suitabilityData.expertRecommendation}</p>
      </div>
    </div>
  `;
}
</script>



<!-- Add Universal Comment Widget - Expert can click anywhere to add feedback -->
<script>
window.commentWidgetConfig = {
    apiBase: "https://clamshell-backend-k1197ddd8-mohammed-asrafs-projects.vercel.app",
    position: "top-right"
};
</script>
<script src="./comment-widget-hybrid.js"></script>

<script>
function showBackendError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.id = 'backend-error-overlay';
    errorDiv.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50';
    errorDiv.innerHTML = `
        <div class="bg-red-900 text-white p-8 rounded-lg max-w-2xl">
            <h2 class="text-2xl font-bold mb-4">‚ö†Ô∏è AI Backend Required</h2>
            <p class="mb-4">${message}</p>
            <p class="text-sm opacity-80">Backend must be running at https://clamshell-backend-k1197ddd8-mohammed-asrafs-projects.vercel.app</p>
            <button onclick="location.reload()" class="mt-4 bg-white text-red-900 px-6 py-2 rounded font-bold">Retry</button>
        </div>
    `;
    document.body.appendChild(errorDiv);
}
</script>

</body>
</html>